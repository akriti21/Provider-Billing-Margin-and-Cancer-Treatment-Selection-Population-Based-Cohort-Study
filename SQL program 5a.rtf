{\rtf1\adeflang1025\ansi\ansicpg1252\uc1\adeff31507\deff0\stshfdbch31505\stshfloch31506\stshfhich31506\stshfbi31507\deflang1033\deflangfe1033\themelang1033\themelangfe0\themelangcs0{\fonttbl{\f0\fbidi \froman\fcharset0\fprq2{\*\panose 02020603050405020304}Times New Roman;}{\f4\fbidi \fswiss\fcharset0\fprq2{\*\panose 020b0604020202020204}Helvetica;}
{\f34\fbidi \froman\fcharset0\fprq2{\*\panose 02040503050406030204}Cambria Math;}{\f43\fbidi \fswiss\fcharset0\fprq2 Aptos;}{\flomajor\f31500\fbidi \froman\fcharset0\fprq2{\*\panose 02020603050405020304}Times New Roman;}
{\fdbmajor\f31501\fbidi \froman\fcharset0\fprq2{\*\panose 02020603050405020304}Times New Roman;}{\fhimajor\f31502\fbidi \fswiss\fcharset0\fprq2 Aptos Display;}{\fbimajor\f31503\fbidi \froman\fcharset0\fprq2{\*\panose 02020603050405020304}Times New Roman;}
{\flominor\f31504\fbidi \froman\fcharset0\fprq2{\*\panose 02020603050405020304}Times New Roman;}{\fdbminor\f31505\fbidi \froman\fcharset0\fprq2{\*\panose 02020603050405020304}Times New Roman;}{\fhiminor\f31506\fbidi \fswiss\fcharset0\fprq2 Aptos;}
{\fbiminor\f31507\fbidi \froman\fcharset0\fprq2{\*\panose 02020603050405020304}Times New Roman;}{\f46\fbidi \froman\fcharset238\fprq2 Times New Roman CE;}{\f47\fbidi \froman\fcharset204\fprq2 Times New Roman Cyr;}
{\f49\fbidi \froman\fcharset161\fprq2 Times New Roman Greek;}{\f50\fbidi \froman\fcharset162\fprq2 Times New Roman Tur;}{\f51\fbidi \froman\fcharset177\fprq2 Times New Roman (Hebrew);}{\f52\fbidi \froman\fcharset178\fprq2 Times New Roman (Arabic);}
{\f53\fbidi \froman\fcharset186\fprq2 Times New Roman Baltic;}{\f54\fbidi \froman\fcharset163\fprq2 Times New Roman (Vietnamese);}{\f86\fbidi \fswiss\fcharset238\fprq2 Helvetica CE;}{\f87\fbidi \fswiss\fcharset204\fprq2 Helvetica Cyr;}
{\f89\fbidi \fswiss\fcharset161\fprq2 Helvetica Greek;}{\f90\fbidi \fswiss\fcharset162\fprq2 Helvetica Tur;}{\f91\fbidi \fswiss\fcharset177\fprq2 Helvetica (Hebrew);}{\f92\fbidi \fswiss\fcharset178\fprq2 Helvetica (Arabic);}
{\f93\fbidi \fswiss\fcharset186\fprq2 Helvetica Baltic;}{\f94\fbidi \fswiss\fcharset163\fprq2 Helvetica (Vietnamese);}{\f386\fbidi \froman\fcharset238\fprq2 Cambria Math CE;}{\f387\fbidi \froman\fcharset204\fprq2 Cambria Math Cyr;}
{\f389\fbidi \froman\fcharset161\fprq2 Cambria Math Greek;}{\f390\fbidi \froman\fcharset162\fprq2 Cambria Math Tur;}{\f393\fbidi \froman\fcharset186\fprq2 Cambria Math Baltic;}{\f394\fbidi \froman\fcharset163\fprq2 Cambria Math (Vietnamese);}
{\f476\fbidi \fswiss\fcharset238\fprq2 Aptos CE;}{\f477\fbidi \fswiss\fcharset204\fprq2 Aptos Cyr;}{\f479\fbidi \fswiss\fcharset161\fprq2 Aptos Greek;}{\f480\fbidi \fswiss\fcharset162\fprq2 Aptos Tur;}{\f483\fbidi \fswiss\fcharset186\fprq2 Aptos Baltic;}
{\f484\fbidi \fswiss\fcharset163\fprq2 Aptos (Vietnamese);}{\flomajor\f31508\fbidi \froman\fcharset238\fprq2 Times New Roman CE;}{\flomajor\f31509\fbidi \froman\fcharset204\fprq2 Times New Roman Cyr;}
{\flomajor\f31511\fbidi \froman\fcharset161\fprq2 Times New Roman Greek;}{\flomajor\f31512\fbidi \froman\fcharset162\fprq2 Times New Roman Tur;}{\flomajor\f31513\fbidi \froman\fcharset177\fprq2 Times New Roman (Hebrew);}
{\flomajor\f31514\fbidi \froman\fcharset178\fprq2 Times New Roman (Arabic);}{\flomajor\f31515\fbidi \froman\fcharset186\fprq2 Times New Roman Baltic;}{\flomajor\f31516\fbidi \froman\fcharset163\fprq2 Times New Roman (Vietnamese);}
{\fdbmajor\f31518\fbidi \froman\fcharset238\fprq2 Times New Roman CE;}{\fdbmajor\f31519\fbidi \froman\fcharset204\fprq2 Times New Roman Cyr;}{\fdbmajor\f31521\fbidi \froman\fcharset161\fprq2 Times New Roman Greek;}
{\fdbmajor\f31522\fbidi \froman\fcharset162\fprq2 Times New Roman Tur;}{\fdbmajor\f31523\fbidi \froman\fcharset177\fprq2 Times New Roman (Hebrew);}{\fdbmajor\f31524\fbidi \froman\fcharset178\fprq2 Times New Roman (Arabic);}
{\fdbmajor\f31525\fbidi \froman\fcharset186\fprq2 Times New Roman Baltic;}{\fdbmajor\f31526\fbidi \froman\fcharset163\fprq2 Times New Roman (Vietnamese);}{\fhimajor\f31528\fbidi \fswiss\fcharset238\fprq2 Aptos Display CE;}
{\fhimajor\f31529\fbidi \fswiss\fcharset204\fprq2 Aptos Display Cyr;}{\fhimajor\f31531\fbidi \fswiss\fcharset161\fprq2 Aptos Display Greek;}{\fhimajor\f31532\fbidi \fswiss\fcharset162\fprq2 Aptos Display Tur;}
{\fhimajor\f31535\fbidi \fswiss\fcharset186\fprq2 Aptos Display Baltic;}{\fhimajor\f31536\fbidi \fswiss\fcharset163\fprq2 Aptos Display (Vietnamese);}{\fbimajor\f31538\fbidi \froman\fcharset238\fprq2 Times New Roman CE;}
{\fbimajor\f31539\fbidi \froman\fcharset204\fprq2 Times New Roman Cyr;}{\fbimajor\f31541\fbidi \froman\fcharset161\fprq2 Times New Roman Greek;}{\fbimajor\f31542\fbidi \froman\fcharset162\fprq2 Times New Roman Tur;}
{\fbimajor\f31543\fbidi \froman\fcharset177\fprq2 Times New Roman (Hebrew);}{\fbimajor\f31544\fbidi \froman\fcharset178\fprq2 Times New Roman (Arabic);}{\fbimajor\f31545\fbidi \froman\fcharset186\fprq2 Times New Roman Baltic;}
{\fbimajor\f31546\fbidi \froman\fcharset163\fprq2 Times New Roman (Vietnamese);}{\flominor\f31548\fbidi \froman\fcharset238\fprq2 Times New Roman CE;}{\flominor\f31549\fbidi \froman\fcharset204\fprq2 Times New Roman Cyr;}
{\flominor\f31551\fbidi \froman\fcharset161\fprq2 Times New Roman Greek;}{\flominor\f31552\fbidi \froman\fcharset162\fprq2 Times New Roman Tur;}{\flominor\f31553\fbidi \froman\fcharset177\fprq2 Times New Roman (Hebrew);}
{\flominor\f31554\fbidi \froman\fcharset178\fprq2 Times New Roman (Arabic);}{\flominor\f31555\fbidi \froman\fcharset186\fprq2 Times New Roman Baltic;}{\flominor\f31556\fbidi \froman\fcharset163\fprq2 Times New Roman (Vietnamese);}
{\fdbminor\f31558\fbidi \froman\fcharset238\fprq2 Times New Roman CE;}{\fdbminor\f31559\fbidi \froman\fcharset204\fprq2 Times New Roman Cyr;}{\fdbminor\f31561\fbidi \froman\fcharset161\fprq2 Times New Roman Greek;}
{\fdbminor\f31562\fbidi \froman\fcharset162\fprq2 Times New Roman Tur;}{\fdbminor\f31563\fbidi \froman\fcharset177\fprq2 Times New Roman (Hebrew);}{\fdbminor\f31564\fbidi \froman\fcharset178\fprq2 Times New Roman (Arabic);}
{\fdbminor\f31565\fbidi \froman\fcharset186\fprq2 Times New Roman Baltic;}{\fdbminor\f31566\fbidi \froman\fcharset163\fprq2 Times New Roman (Vietnamese);}{\fhiminor\f31568\fbidi \fswiss\fcharset238\fprq2 Aptos CE;}
{\fhiminor\f31569\fbidi \fswiss\fcharset204\fprq2 Aptos Cyr;}{\fhiminor\f31571\fbidi \fswiss\fcharset161\fprq2 Aptos Greek;}{\fhiminor\f31572\fbidi \fswiss\fcharset162\fprq2 Aptos Tur;}{\fhiminor\f31575\fbidi \fswiss\fcharset186\fprq2 Aptos Baltic;}
{\fhiminor\f31576\fbidi \fswiss\fcharset163\fprq2 Aptos (Vietnamese);}{\fbiminor\f31578\fbidi \froman\fcharset238\fprq2 Times New Roman CE;}{\fbiminor\f31579\fbidi \froman\fcharset204\fprq2 Times New Roman Cyr;}
{\fbiminor\f31581\fbidi \froman\fcharset161\fprq2 Times New Roman Greek;}{\fbiminor\f31582\fbidi \froman\fcharset162\fprq2 Times New Roman Tur;}{\fbiminor\f31583\fbidi \froman\fcharset177\fprq2 Times New Roman (Hebrew);}
{\fbiminor\f31584\fbidi \froman\fcharset178\fprq2 Times New Roman (Arabic);}{\fbiminor\f31585\fbidi \froman\fcharset186\fprq2 Times New Roman Baltic;}{\fbiminor\f31586\fbidi \froman\fcharset163\fprq2 Times New Roman (Vietnamese);}}
{\colortbl;\red0\green0\blue0;\red0\green0\blue255;\red0\green255\blue255;\red0\green255\blue0;\red255\green0\blue255;\red255\green0\blue0;\red255\green255\blue0;\red255\green255\blue255;\red0\green0\blue128;\red0\green128\blue128;\red0\green128\blue0;
\red128\green0\blue128;\red128\green0\blue0;\red128\green128\blue0;\red128\green128\blue128;\red192\green192\blue192;\red0\green0\blue0;\red0\green0\blue0;}{\*\defchp \fs24\kerning2\loch\af31506\hich\af31506\dbch\af31505 }{\*\defpap 
\ql \li0\ri0\sa160\sl278\slmult1\widctlpar\wrapdefault\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0 }\noqfpromote {\stylesheet{\ql \li0\ri0\sa160\sl278\slmult1\widctlpar\wrapdefault\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0 \rtlch\fcs1 
\af31507\afs24\alang1025 \ltrch\fcs0 \fs24\lang1033\langfe1033\kerning2\loch\f31506\hich\af31506\dbch\af31505\cgrid\langnp1033\langfenp1033 \snext0 \sqformat \spriority0 Normal;}{\*\cs10 \additive \ssemihidden \sunhideused \spriority1 
Default Paragraph Font;}{\*\ts11\tsrowd\trftsWidthB3\trpaddl108\trpaddr108\trpaddfl3\trpaddft3\trpaddfb3\trpaddfr3\trcbpat1\trcfpat1\tblind0\tblindtype3\tsvertalt\tsbrdrt\tsbrdrl\tsbrdrb\tsbrdrr\tsbrdrdgl\tsbrdrdgr\tsbrdrh\tsbrdrv 
\ql \li0\ri0\sa160\sl278\slmult1\widctlpar\wrapdefault\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0 \rtlch\fcs1 \af31507\afs24\alang1025 \ltrch\fcs0 
\fs24\lang1033\langfe1033\kerning2\loch\f31506\hich\af31506\dbch\af31505\cgrid\langnp1033\langfenp1033 \snext11 \ssemihidden \sunhideused Normal Table;}}{\*\revtbl {Unknown;}}{\*\rsidtbl \rsid3742477\rsid4483225\rsid6620941\rsid14816201\rsid15294609}{\mmathPr\mmathFont34
\mbrkBin0\mbrkBinSub0\msmallFrac0\mdispDef1\mlMargin0\mrMargin0\mdefJc1\mwrapIndent1440\mintLim0\mnaryLim1}{\info{\operator Mishra, Akriti}{\creatim\yr2025\mo8\dy1\hr13\min2}{\revtim\yr2025\mo8\dy1\hr14\min5}{\version3}{\edmins63}{\nofpages49}
{\nofwords15341}{\nofchars87446}{\nofcharsws102582}{\vern103}}{\*\xmlnstbl {\xmlns1 http://schemas.microsoft.com/office/word/2003/wordml}}\paperw12240\paperh15840\margl1440\margr1440\margt1440\margb1440\gutter0\ltrsect 
\widowctrl\ftnbj\aenddoc\trackmoves0\trackformatting1\donotembedsysfont0\relyonvml0\donotembedlingdata1\grfdocevents0\validatexml0\showplaceholdtext0\ignoremixedcontent0\saveinvalidxml0\showxmlerrors0\horzdoc\dghspace120\dgvspace120\dghorigin1701
\dgvorigin1984\dghshow0\dgvshow3\jcompress\viewkind1\viewscale100\rsidroot3742477 \fet0{\*\wgrffmtfilter 2450}\ilfomacatclnup0\ltrpar \sectd \ltrsect\linex0\sectdefaultcl\sftnbj {\*\pnseclvl1\pnucrm\pnstart1\pnindent720\pnhang {\pntxta .}}{\*\pnseclvl2
\pnucltr\pnstart1\pnindent720\pnhang {\pntxta .}}{\*\pnseclvl3\pndec\pnstart1\pnindent720\pnhang {\pntxta .}}{\*\pnseclvl4\pnlcltr\pnstart1\pnindent720\pnhang {\pntxta )}}{\*\pnseclvl5\pndec\pnstart1\pnindent720\pnhang {\pntxtb (}{\pntxta )}}{\*\pnseclvl6
\pnlcltr\pnstart1\pnindent720\pnhang {\pntxtb (}{\pntxta )}}{\*\pnseclvl7\pnlcrm\pnstart1\pnindent720\pnhang {\pntxtb (}{\pntxta )}}{\*\pnseclvl8\pnlcltr\pnstart1\pnindent720\pnhang {\pntxtb (}{\pntxta )}}{\*\pnseclvl9\pnlcrm\pnstart1\pnindent720\pnhang 
{\pntxtb (}{\pntxta )}}\pard\plain \ltrpar\ql \li0\ri0\nowidctlpar\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\wrapdefault\faauto\rin0\lin0\itap0\pararsid3742477 \rtlch\fcs1 \af31507\afs24\alang1025 \ltrch\fcs0 
\fs24\lang1033\langfe1033\kerning2\loch\af31506\hich\af31506\dbch\af31505\cgrid\langnp1033\langfenp1033 {\rtlch\fcs1 \af4 \ltrch\fcs0 \f4\kerning0\insrsid3742477\charrsid9071162 \hich\af4\dbch\af31505\loch\f4 
/************************************************************************************
\par 
\par \hich\af4\dbch\af31505\loch\f4 SQL program }{\rtlch\fcs1 \af4 \ltrch\fcs0 \f4\kerning0\insrsid3742477 \hich\af4\dbch\af31505\loch\f4 5a}{\rtlch\fcs1 \af4 \ltrch\fcs0 \f4\kerning0\insrsid3742477\charrsid9071162 \hich\af4\dbch\af31505\loch\f4  \hich\f4 
\endash \loch\f4  
\par \hich\af4\dbch\af31505\loch\f4 Written to}{\rtlch\fcs1 \af4 \ltrch\fcs0 \f4\kerning0\insrsid3742477 \hich\af4\dbch\af31505\loch\f4  do family A analyses. }{\rtlch\fcs1 \af4 \ltrch\fcs0 \f4\kerning0\insrsid15294609 
\par 
\par \hich\af4\dbch\af31505\loch\f4 F\hich\af4\dbch\af31505\loch\f4 o\hich\af4\dbch\af31505\loch\f4 r each s\hich\af4\dbch\af31505\loch\f4 cenario \loch\af4\dbch\af31505\hich\f4 \endash \hich\af4\dbch\af31505\loch\f4  we \hich\af4\dbch\af31505\loch\f4 f}{
\rtlch\fcs1 \af4 \ltrch\fcs0 \f4\kerning0\insrsid3742477 \hich\af4\dbch\af31505\loch\f4 irst }{\rtlch\fcs1 \af4 \ltrch\fcs0 \f4\kerning0\insrsid15294609 \hich\af4\dbch\af31505\loch\f4 fit a \hich\af4\dbch\af31505\loch\f4 multinomial 
\hich\af4\dbch\af31505\loch\f4 model }{\rtlch\fcs1 \af4 \ltrch\fcs0 \f4\kerning0\insrsid14816201 \hich\af4\dbch\af31505\loch\f4 using \hich\af4\dbch\af31505\loch\f4 all the patient and p\hich\af4\dbch\af31505\loch\f4 r\hich\af4\dbch\af31505\loch\f4 
ovider charact\hich\af4\dbch\af31505\loch\f4 eristics}{\rtlch\fcs1 \af4 \ltrch\fcs0 \f4\kerning0\insrsid14816201 \hich\af4\dbch\af31505\loch\f4  }{\rtlch\fcs1 \af4 \ltrch\fcs0 \f4\kerning0\insrsid15294609 \hich\af4\dbch\af31505\loch\f4 to}{\rtlch\fcs1 
\af4 \ltrch\fcs0 \f4\kerning0\insrsid3742477 \hich\af4\dbch\af31505\loch\f4  \hich\af4\dbch\af31505\loch\f4 calculate\hich\af4\dbch\af31505\loch\f4  \hich\af4\dbch\af31505\loch\f4 the pro}{\rtlch\fcs1 \af4 \ltrch\fcs0 \f4\kerning0\insrsid15294609 
\hich\af4\dbch\af31505\loch\f4 babili}{\rtlch\fcs1 \af4 \ltrch\fcs0 \f4\kerning0\insrsid3742477 \hich\af4\dbch\af31505\loch\f4 ty of \hich\af4\dbch\af31505\loch\f4 receiving\hich\af4\dbch\af31505\loch\f4  }{\rtlch\fcs1 \af4 \ltrch\fcs0 
\f4\kerning0\insrsid15294609 \hich\af4\dbch\af31505\loch\f4 a treatment regim\hich\af4\dbch\af31505\loch\f4 en.}{\rtlch\fcs1 \af4 \ltrch\fcs0 \f4\kerning0\insrsid3742477 
\par }{\rtlch\fcs1 \af4 \ltrch\fcs0 \f4\kerning0\insrsid15294609 \hich\af4\dbch\af31505\loch\f4 A\hich\af4\dbch\af31505\loch\f4 nd }{\rtlch\fcs1 \af4 \ltrch\fcs0 \f4\kerning0\insrsid14816201 \hich\af4\dbch\af31505\loch\f4 in next stage, }{\rtlch\fcs1 \af4 
\ltrch\fcs0 \f4\kerning0\insrsid15294609 \hich\af4\dbch\af31505\loch\f4 we \hich\af4\dbch\af31505\loch\f4 fit a mcf\hich\af4\dbch\af31505\loch\f4 adden model using the physician margin and fr\hich\af4\dbch\af31505\loch\f4 actional rank variables. 
\hich\af4\dbch\af31505\loch\f4 W\hich\af4\dbch\af31505\loch\f4 e \hich\af4\dbch\af31505\loch\f4 use a weighted approach where weights are calculated using ratio of \hich\af4\dbch\af31505\loch\f4 t\hich\af4\dbch\af31505\loch\f4 he 
\hich\af4\dbch\af31505\loch\f4 preval\hich\af4\dbch\af31505\loch\f4 e\hich\af4\dbch\af31505\loch\f4 nce\hich\af4\dbch\af31505\loch\f4  \hich\af4\dbch\af31505\loch\f4 (of that treatment in the co\hich\af4\dbch\af31505\loch\f4 hort) a
\hich\af4\dbch\af31505\loch\f4 nd predicted probability from the multinomial model}{\rtlch\fcs1 \af4 \ltrch\fcs0 \f4\kerning0\insrsid14816201 \hich\af4\dbch\af31505\loch\f4  described before this}{\rtlch\fcs1 \af4 \ltrch\fcs0 \f4\kerning0\insrsid15294609 
.}{\rtlch\fcs1 \af4 \ltrch\fcs0 \f4\kerning0\insrsid14816201 \hich\af4\dbch\af31505\loch\f4  \hich\af4\dbch\af31505\loch\f4 W\hich\af4\dbch\af31505\loch\f4 eights \hich\af4\dbch\af31505\loch\f4 were \hich\af4\dbch\af31505\loch\f4 win
\hich\af4\dbch\af31505\loch\f4 s\hich\af4\dbch\af31505\loch\f4 orized at the \hich\af4\dbch\af31505\loch\f4 5}{\rtlch\fcs1 \af4 \ltrch\fcs0 \f4\super\kerning0\insrsid14816201\charrsid14816201 \hich\af4\dbch\af31505\loch\f4 th}{\rtlch\fcs1 \af4 
\ltrch\fcs0 \f4\kerning0\insrsid14816201 \hich\af4\dbch\af31505\loch\f4  \hich\af4\dbch\af31505\loch\f4 and 95}{\rtlch\fcs1 \af4 \ltrch\fcs0 \f4\super\kerning0\insrsid14816201\charrsid14816201 \hich\af4\dbch\af31505\loch\f4 th}{\rtlch\fcs1 \af4 
\ltrch\fcs0 \f4\kerning0\insrsid14816201 \hich\af4\dbch\af31505\loch\f4  \hich\af4\dbch\af31505\loch\f4 percentile\hich\af4\dbch\af31505\loch\f4 s.}{\rtlch\fcs1 \af4 \ltrch\fcs0 \f4\kerning0\insrsid15294609 \hich\af4\dbch\af31505\loch\f4  }{\rtlch\fcs1 
\af4 \ltrch\fcs0 \f4\kerning0\insrsid3742477\charrsid9071162 
\par \hich\af4\dbch\af31505\loch\f4 *\hich\af4\dbch\af31505\loch\f4 ***********************************************************************************/}{\rtlch\fcs1 \af4 \ltrch\fcs0 \f4\kerning0\insrsid3742477 
\par }\pard \ltrpar\ql \li0\ri0\nowidctlpar\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\wrapdefault\faauto\rin0\lin0\itap0 {\rtlch\fcs1 \af4 \ltrch\fcs0 \f4\kerning0\insrsid6620941 
\par 
\par \hich\af4\dbch\af31505\loch\f4 ---- s1 models same for all scenarios. however, for br scenarios, exclude gender var as all benes are females
\par \hich\af4\dbch\af31505\loch\f4 ---- if a regimen is offered }{\rtlch\fcs1 \af4 \ltrch\fcs0 \f4\kerning0\insrsid14816201 \hich\af4\dbch\af31505\loch\f4 to}{\rtlch\fcs1 \af4 \ltrch\fcs0 \f4\kerning0\insrsid6620941 \hich\af4\dbch\af31505\loch\f4  <19}{
\rtlch\fcs1 \af4 \ltrch\fcs0 \f4\kerning0\insrsid14816201 \hich\af4\dbch\af31505\loch\f4  pati\hich\af4\dbch\af31505\loch\f4 e\hich\af4\dbch\af31505\loch\f4 nts, we \hich\af4\dbch\af31505\loch\f4 exclude \hich\af4\dbch\af31505\loch\f4 that 
\hich\af4\dbch\af31505\loch\f4 regimen\hich\af4\dbch\af31505\loch\f4  \hich\af4\dbch\af31505\loch\f4 and patients who receive it.}{\rtlch\fcs1 \af4 \ltrch\fcs0 \f4\kerning0\insrsid6620941 
\par }{\rtlch\fcs1 \af4 \ltrch\fcs0 \f4\kerning0\insrsid14816201 
\par }{\rtlch\fcs1 \af4 \ltrch\fcs0 \f4\kerning0\insrsid6620941 \hich\af4\dbch\af31505\loch\f4 select distinct cancer_scen, trtreg, count(distinct bene) from IN_aim1_modeldt where choice = 1
\par \hich\af4\dbch\af31505\loch\f4 group by cancer_scen, trtreg order by cancer_scen, trtreg
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 *******************************;
\par \hich\af4\dbch\af31505\loch\f4 *************br6 **************;
\par \hich\af4\dbch\af31505\loch\f4 *******************************;
\par 
\par \hich\af4\dbch\af31505\loch\f4 ********* get table for stage1 - can call disease risk group modeling;
\par \hich\af4\dbch\af31505\loch\f4 drop table IN_aim1_modeldt_br6_sm
\par \hich\af4\dbch\af31505\loch\f4 Create table Medicare.dbo.IN_aim1_modeldt_br6_sm (
\par \hich\af4\dbch\af31505\loch\f4             BENE_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL, year_diag varchar(4), geo\hich\af4\dbch\af31505\loch\f4  varchar(10), metro varchar(1), 
\par \hich\af4\dbch\af31505\loch\f4             trtreg int, guideline_dt date, choice bit,  total_physician_margin_hm int, nci_index float, frail_score float, 
\par \hich\af4\dbch\af31505\loch\f4             age int,  BENE_RACE_CD int, --RTI_RACE_CD int, 
\par \hich\af4\dbch\af31505\loch\f4             race_4cat varchar(15),  SEX_IDENT_CD varchar(1), LIS_status varchar(25), med_cats varchar(16), pov_cat varchar(30),
\par \hich\af4\dbch\af31505\loch\f4             spec varchar (200), QUARTILE_pnpi varchar(1), npigndr varchar (1), npigrd_yr int, npi_cats varchar(14),
\par \hich\af4\dbch\af31505\loch\f4             spec_2cat varchar (200), LIS_status_2ca\hich\af4\dbch\af31505\loch\f4 t varchar(25), SNo int, trtreg_bin int -- only 2 regimens remain in scenario so make var for logsc reg
\par \hich\af4\dbch\af31505\loch\f4 );
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX pcharsml ON IN_aim1_modeldt_br6_sm;
\par 
\par \hich\af4\dbch\af31505\loch\f4 with reg_benes as (select distinct trtreg, count (distinct bene_ID) as benes from IN_aim1_modeldt 
\par \hich\af4\dbch\af31505\loch\f4                    where cancer_scen = 'br6' and choice = 1 group by trtreg)
\par \hich\af4\dbch\af31505\loch\f4     ,foreligreg as (select distinct a.*, b.benes from
\par \hich\af4\dbch\af31505\loch\f4                    IN_aim1_modeldt a inner join r\hich\af4\dbch\af31505\loch\f4 eg_benes b on a.trtreg = b.trtreg where a.cancer_scen = 'br6')
\par \hich\af4\dbch\af31505\loch\f4 --keep regimens if > 20 benes receive that regimen
\par \hich\af4\dbch\af31505\loch\f4     ,elig_reg as (select * from foreligreg where benes >20)
\par \hich\af4\dbch\af31505\loch\f4 --keep benes if they have 2 levels for choice variable once we drop regimens with few benes
\par \hich\af4\dbch\af31505\loch\f4     ,fl as (select distinct bene_ID, count(distinct choice) as fl from elig_reg group by bene_ID)
\par \hich\af4\dbch\af31505\loch\f4     ,foreligbene as (select distinct a.*, b.fl from
\par \hich\af4\dbch\af31505\loch\f4                       elig_reg a left join fl b on a.BENE_ID = b.bene_ID)               
\par \hich\af4\dbch\af31505\loch\f4 --selec\hich\af4\dbch\af31505\loch\f4 t count(*), count(distinct bene_ID) as benes from foreligbene where fl =2
\par \hich\af4\dbch\af31505\loch\f4     insert into IN_aim1_modeldt_br6_sm --IN_aim1 as (
\par \hich\af4\dbch\af31505\loch\f4         select BENE_ID, year_diag, geo, metro, trtreg, guideline_dt, choice, total_physician_margin_hm, 
\par \hich\af4\dbch\af31505\loch\f4         nci_index, frail_score, age, bene_race_cd, --RTI_RACE_CD, 
\par \hich\af4\dbch\af31505\loch\f4         race_4cat, SEX_IDENT_CD, LIS_status, med_cats, pov_cat, spec, QUARTILE_pnpi, npigndr, npigrd_yr, npi_cats,
\par \hich\af4\dbch\af31505\loch\f4         spec_2cat, LIS_status_2cat,
\par \hich\af4\dbch\af31505\loch\f4         ROW_NUMBER() OVER(ORDER BY (bene_ID)) AS SNo, 
\par \hich\af4\dbch\af31505\loch\f4       \hich\af4\dbch\af31505\loch\f4   (case when trtreg = 14102 then 0 else 1 end) as trtreg_bin from foreligbene where fl = 2 and choice = 1
\par \hich\af4\dbch\af31505\loch\f4 --select count(distinct bene_ID) as benes, count(distinct trtreg) as regs from IN_aim1_modeldt_br6_sm
\par 
\par \hich\af4\dbch\af31505\loch\f4 -- confirms ordered by bene ids
\par \hich\af4\dbch\af31505\loch\f4 --select bene_ID, sno  from IN_aim1_modeldt_br6_sm
\par 
\par \hich\af4\dbch\af31505\loch\f4 --select distinct trtreg from IN_aim1_modeldt_br6_sm order by trtreg
\par \hich\af4\dbch\af31505\loch\f4 drop table IN_aim1_modeldt_br6_sm_4s2
\par \hich\af4\dbch\af31505\loch\f4 Create table Medicare.dbo.IN_aim1_modeldt_br6_sm_4s2 (
\par \hich\af4\dbch\af31505\loch\f4             BENE_ID varchar(15) COLLATE SQL_Latin1_Genera\hich\af4\dbch\af31505\loch\f4 l_CP1_CS_AS NULL, 
\par \hich\af4\dbch\af31505\loch\f4             --[14102] float, 
\par \hich\af4\dbch\af31505\loch\f4             [14103] float);
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX pcharsml ON IN_aim1_modeldt_br6_sm_4s2;
\par 
\par \hich\af4\dbch\af31505\loch\f4 insert into IN_aim1_modeldt_br6_sm_4s2
\par \hich\af4\dbch\af31505\loch\f4 EXEC sp_execute_external_script
\par \hich\af4\dbch\af31505\loch\f4 @language =N'R',
\par \hich\af4\dbch\af31505\loch\f4 @script=N'
\par \hich\af4\dbch\af31505\loch\f4     library(nnet)
\par \hich\af4\dbch\af31505\loch\f4     library(stats)
\par \hich\af4\dbch\af31505\loch\f4     rownames(inputdata) <- inputdata$BENE_ID
\par \hich\af4\dbch\af31505\loch\f4     inputdata$trtreg_bin <- factor(inputdata$trtreg_bin)
\par \hich\af4\dbch\af31505\loch\f4     #print(levels(inputdata$trtreg_bin))
\par \hich\af4\dbch\af31505\loch\f4     test <- glm(trtreg_bin ~ year_diag  + race_4cat + LIS_status_2cat + metro +  med_cats + pov_cat + geo + 
\par \hich\af4\dbch\af31505\loch\f4                          age + frail_score + nci_index + spec_2cat + QUARTILE_pnpi + npigndr + npi_cats, 
\par \hich\af4\dbch\af31505\loch\f4                          data = inputdata, family="binomi\hich\af4\dbch\af31505\loch\f4 al")    
\par \hich\af4\dbch\af31505\loch\f4     inputdata$regpredprob <- predict(test, type="response")
\par \hich\af4\dbch\af31505\loch\f4     #print(head(inputdata$regpredprob ))
\par \hich\af4\dbch\af31505\loch\f4     coeff_out <-data.frame(inputdata$regpredprob);
\par \hich\af4\dbch\af31505\loch\f4     #print(head(coeff_out))
\par \hich\af4\dbch\af31505\loch\f4     outputdata <- cbind(row.names(coeff_out),coeff_out);'
\par \hich\af4\dbch\af31505\loch\f4     , @input_data_1 = N'select * from Medicare.dbo.IN_aim1_modeldt_br6_sm order by bene_ID'
\par \hich\af4\dbch\af31505\loch\f4     , @input_data_1_name = N'inputdata'
\par \hich\af4\dbch\af31505\loch\f4     , @output_data_1_name = N'outputdata'
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 --    inputdata$regpredprob <- predict(test, newdata = inputdata, "probs")
\par \hich\af4\dbch\af31505\loch\f4     #print(head(inputdata$regpredprob ))
\par \hich\af4\dbch\af31505\loch\f4 --    coeff_out <-data.frame(inputdata$regpredprob);
\par \hich\af4\dbch\af31505\loch\f4     #print(head(coeff_out))
\par \hich\af4\dbch\af31505\loch\f4 --    outputdata <- cbind(row.names(coeff_out),coeff_out);'
\par 
\par \hich\af4\dbch\af31505\loch\f4 **************** get data for stage 2 model ******************;
\par \hich\af4\dbch\af31505\loch\f4 **************** min regprob is 0 so division 2 get st_wts does not work here. revisit this scenario;
\par \hich\af4\dbch\af31505\loch\f4     Drop table Medicare.dbo.IN_aim1_model_br6_s2 
\par \hich\af4\dbch\af31505\loch\f4     Create table Medicare.dbo.IN_aim1_\hich\af4\dbch\af31505\loch\f4 model_br6_s2 (
\par \hich\af4\dbch\af31505\loch\f4             BENE_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL,trtreg int,cancer_scen varchar(200),
\par \hich\af4\dbch\af31505\loch\f4 total_physician_margin_hm float,  total_physician_margin_hm_100d float, 
\par \hich\af4\dbch\af31505\loch\f4 total_physician_margin_lm float,  total_physician_margin_lm_100d float,
\par \hich\af4\dbch\af31505\loch\f4 guideline_dt date null, guideline_dt2 date null, regimen_type int, preferred int,   
\par \hich\af4\dbch\af31505\loch\f4 ESQC int, wtd_esqc1 float, wtd_esqc2 float, wtd_esqc3 float, wtd_esqc4 float,   
\par \hich\af4\dbch\af31505\loch\f4 rank int,   total_trt int,   fr_rank float, fr_rank_revrs float, 
\par \hich\af4\dbch\af31505\loch\f4 --trtgive\hich\af4\dbch\af31505\loch\f4 n 
\par \hich\af4\dbch\af31505\loch\f4 choice bit,trtinit_dt date null,  regprob float, st_wts float, wins_st_wts float--, quar_prob int
\par \hich\af4\dbch\af31505\loch\f4 );
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX pchars ON IN_aim1_model_br6_s2;
\par 
\par \hich\af4\dbch\af31505\loch\f4 with mrgd as (select distinct a.*, 
\par \hich\af4\dbch\af31505\loch\f4             (1 - [14103]) as [14102], [14103]  from
\par \hich\af4\dbch\af31505\loch\f4 IN_aim1_modeldt_br6_sm a left join IN_aim1_modeldt_br6_sm_4s2 b on a.SNo--bene_ID 
\par \hich\af4\dbch\af31505\loch\f4 = b.BENE_ID)
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,regspec as (
\par \hich\af4\dbch\af31505\loch\f4  select distinct bene_ID, trtreg, [14102] as regprob, 14102 as reg from mrgd union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [14103] as regprob, 14103 as reg from mrgd) )   
\par 
\par \hich\af4\dbch\af31505\loch\f4 , regsspec_f as (select distinct bene_ID, reg, regprob from regspec) --where trtreg = reg)
\par \hich\af4\dbch\af31505\loch\f4 --select top 50 * from regsspec_f order by bene_id
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,br6 as (select distinct BENE_ID, trtreg, cancer_scen, total_physician_margin_hm, (total_physician_margin_hm/100) as total_physician_margin_hm_100d , 
\par \hich\af4\dbch\af31505\loch\f4     total_physician_margin_lm, (total_physician_mar\hich\af4\dbch\af31505\loch\f4 
gin_lm/100) as total_physician_margin_lm_100d , guideline_dt, guideline_dt2, regimen_type, preferred, ESQC, wtd_esqc1, wtd_esqc2, wtd_esqc3, wtd_esqc4,   
\par \hich\af4\dbch\af31505\loch\f4     rank, total_trt, fr_rank, fr_rank_revrs, choice,trtinit_dt from 
\par \hich\af4\dbch\af31505\loch\f4 IN_aim1_modeldt where cancer_scen = 'br6') 
\par 
\par \hich\af4\dbch\af31505\loch\f4 , br6_f as (select distinct a.*, b.regprob from 
\par \hich\af4\dbch\af31505\loch\f4 br6 a inner join regsspec_f b on a.bene_ID = b.bene_ID and a.trtreg = b.reg) 
\par 
\par \hich\af4\dbch\af31505\loch\f4 , br6_f2 as (select distinct *, 
\par \hich\af4\dbch\af31505\loch\f4 (case when trtreg = 14102  then (0.538 /regprob)
\par \hich\af4\dbch\af31505\loch\f4       when trtreg = 14103  then (\hich\af4\dbch\af31505\loch\f4 0.462 /regprob) end) as st_wts
\par \hich\af4\dbch\af31505\loch\f4 from br6_f)
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,prcnls as (SELECT trtreg--trtreg, st_wts, PERCENT_RANK() OVER(PARTITION BY trtreg ORDER BY st_wts) AS Pctst_wts,
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.05) WITHIN GROUP (ORDER BY st_wts) OVER (PARTITION BY trtreg) as p5
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.94) WITHIN GROUP (ORDER BY st_wts) OVER (PARTITION BY trtreg) as p94
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.95) WITHIN GROUP (ORDER BY st_wts) OVER (PARTITION BY trtreg) as p95
\par \hich\af4\dbch\af31505\loch\f4   FROM br6_f2)
\par 
\par \hich\af4\dbch\af31505\loch\f4 -- select distinct trtreg, p5, p94, p95 from prcnls 
\par \hich\af4\dbch\af31505\loch\f4 ,br6_f3 as (select distinct a.*, b.p5, b.p95 from
\par \hich\af4\dbch\af31505\loch\f4               br6_f2 a left join prcnls b on a.trtreg = b.trtreg)
\par \hich\af4\dbch\af31505\loch\f4 -- select top 50 * from l10_f3 order by bene_ID
\par \hich\af4\dbch\af31505\loch\f4 ,br6_f4 as (select *, (case when st_wts >= p95 then p95
\par \hich\af4\dbch\af31505\loch\f4                             when st_wts <= p5  then p5
\par \hich\af4\dbch\af31505\loch\f4                             else st_wts end) as wins_st_wts from br6\hich\af4\dbch\af31505\loch\f4 _f3)
\par 
\par \hich\af4\dbch\af31505\loch\f4 --select count(*) from br6_f4
\par \hich\af4\dbch\af31505\loch\f4 insert into IN_aim1_model_br6_s2
\par \hich\af4\dbch\af31505\loch\f4 select top 260 BENE_ID, trtreg, cancer_scen, total_physician_margin_hm, total_physician_margin_hm_100d , 
\par \hich\af4\dbch\af31505\loch\f4     total_physician_margin_lm, total_physician_margin_lm_100d , guideline_dt, guideline_dt2, regimen_type, preferred, ESQC, wtd_esqc1, wtd_esqc2, wtd_esqc3, wtd_esqc4,   
\par \hich\af4\dbch\af31505\loch\f4     rank, total_trt, fr_rank, fr_rank_revrs, choice,trtinit_dt, regprob, st_wts, wins_st_wts 
\par \hich\af4\dbch\af31505\loch\f4     from br6_f4 order by BENE_ID
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 *************************************\hich\af4\dbch\af31505\loch\f4 ****************************;
\par \hich\af4\dbch\af31505\loch\f4 *************************  S2 model *****************************;
\par \hich\af4\dbch\af31505\loch\f4 *****************************************************************;
\par 
\par \hich\af4\dbch\af31505\loch\f4 EXEC sp_execute_external_script
\par \hich\af4\dbch\af31505\loch\f4 @language =N'R',
\par \hich\af4\dbch\af31505\loch\f4 @script=N'
\par \hich\af4\dbch\af31505\loch\f4     library(mlogit)
\par \hich\af4\dbch\af31505\loch\f4     library(dplyr)
\par \hich\af4\dbch\af31505\loch\f4     library(Formula)
\par \hich\af4\dbch\af31505\loch\f4     TM <- dfidx(inputdata, idx=c("BENE_ID","trtreg"), alt.var = "trtreg", pkg = "mlogit")
\par \hich\af4\dbch\af31505\loch\f4     m1 <- mlogit(choice ~ total_physician_margin_hm_100d | 1 , weights = wins_st_wts, TM)
\par \hich\af4\dbch\af31505\loch\f4     print( summary(m1)) 
\par \hich\af4\dbch\af31505\loch\f4     print(confint(m1));'
\par \hich\af4\dbch\af31505\loch\f4         , @input_data_1 = N'select * from Medicare.dbo.IN_aim1_model_br6_s2'
\par \hich\af4\dbch\af31505\loch\f4         , @input_data_1_name = N'inputdata';
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 *******************************;
\par \hich\af4\dbch\af31505\loch\f4 *************l10 **************;
\par \hich\af4\dbch\af31505\loch\f4 *******************************;
\par 
\par \hich\af4\dbch\af31505\loch\f4 ********* get table for stage1 - can call disease risk group modeling;
\par \hich\af4\dbch\af31505\loch\f4 drop table IN_aim1_modeldt_l10_sm
\par \hich\af4\dbch\af31505\loch\f4 Create table Medicare.dbo.IN_aim1_modeldt_l10_sm (
\par \hich\af4\dbch\af31505\loch\f4             BENE_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL, year_diag varchar(4), geo varchar(10), metro varchar(1), 
\par \hich\af4\dbch\af31505\loch\f4             trtreg int, guideline_dt date, choice bit,  total_physician_margin_hm int, nci_index float, frail_score float, 
\par \hich\af4\dbch\af31505\loch\f4             age int,  BENE_RACE_CD int, --RTI_RACE_CD int, 
\par \hich\af4\dbch\af31505\loch\f4             race_4cat varchar(15),  S\hich\af4\dbch\af31505\loch\f4 EX_IDENT_CD varchar(1), LIS_status varchar(25), med_cats varchar(16), pov_cat varchar(30),
\par \hich\af4\dbch\af31505\loch\f4             spec varchar (200), QUARTILE_pnpi varchar(1), npigndr varchar (1), npigrd_yr int, npi_cats varchar(14),
\par \hich\af4\dbch\af31505\loch\f4             spec_2cat varchar (200), LIS_status_2cat varchar(25), SNo int,
\par \hich\af4\dbch\af31505\loch\f4 );
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX pcharsml ON IN_aim1_modeldt_l10_sm;
\par 
\par \hich\af4\dbch\af31505\loch\f4 with reg_benes as (select distinct trtreg, count (distinct bene_ID) as benes from IN_aim1_modeldt 
\par \hich\af4\dbch\af31505\loch\f4                    where cancer_scen = 'l10' and choice = 1 group by trtreg)
\par \hich\af4\dbch\af31505\loch\f4     ,foreligreg as (select distinct a.*, b.benes from
\par \hich\af4\dbch\af31505\loch\f4                    IN_aim1_modeldt a inner join reg_benes b on a.trtreg = b.trtreg where a.cancer_scen = 'l10')
\par \hich\af4\dbch\af31505\loch\f4 --keep regimens if > 20 benes receive that regimen
\par \hich\af4\dbch\af31505\loch\f4     ,elig_reg as (select * from foreligreg where benes >20)
\par \hich\af4\dbch\af31505\loch\f4 --keep benes if they have 2 levels for choice variable once\hich\af4\dbch\af31505\loch\f4  we drop regimens with few benes
\par \hich\af4\dbch\af31505\loch\f4     ,fl as (select distinct bene_ID, count(distinct choice) as fl from elig_reg group by bene_ID)
\par \hich\af4\dbch\af31505\loch\f4     ,foreligbene as (select distinct a.*, b.fl from
\par \hich\af4\dbch\af31505\loch\f4                       elig_reg a left join fl b on a.BENE_ID = b.bene_ID)               
\par \hich\af4\dbch\af31505\loch\f4 --select count(*), count(distinct bene_ID) as benes from foreligbene where fl =2
\par \hich\af4\dbch\af31505\loch\f4     insert into IN_aim1_modeldt_l10_sm --IN_aim1 as (
\par \hich\af4\dbch\af31505\loch\f4         select BENE_ID, year_diag, geo, metro, trtreg, guideline_dt, choice, total_physician_margin_hm, 
\par \hich\af4\dbch\af31505\loch\f4         nci_index, frail_score, age, bene_race_cd, --RTI_RACE_CD, 
\par \hich\af4\dbch\af31505\loch\f4         race_4cat, SEX_IDENT_CD, LIS_status, med_cats, pov_cat, spec, QUARTILE_pnpi, npigndr, npigrd_yr, npi_cats,
\par \hich\af4\dbch\af31505\loch\f4         spec_2cat, LIS_status_2cat,
\par \hich\af4\dbch\af31505\loch\f4         ROW_NUMBER() OVER(ORDER BY (bene_ID)) AS SNo from foreligbene where fl = 2 and choice = 1
\par \hich\af4\dbch\af31505\loch\f4 --select count(distinct bene_ID) as benes, count(distinct trtreg) as regs from IN_aim1_modeldt_l10_sm
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 --select distinct trtreg from IN_aim1_modeldt_l10_sm order by trtreg
\par \hich\af4\dbch\af31505\loch\f4 drop table IN_aim1_mode\hich\af4\dbch\af31505\loch\f4 ldt_l10_sm_4s2
\par \hich\af4\dbch\af31505\loch\f4 Create table Medicare.dbo.IN_aim1_modeldt_l10_sm_4s2 (
\par \hich\af4\dbch\af31505\loch\f4             BENE_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL,
\par \hich\af4\dbch\af31505\loch\f4 [28001] float, [28003] float, [28005] float, );
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX pcharsml ON IN_aim1_modeldt_l10_sm_4s2;
\par 
\par \hich\af4\dbch\af31505\loch\f4 insert into IN_aim1_modeldt_l10_sm_4s2
\par \hich\af4\dbch\af31505\loch\f4 --select distinct bene_ID from IN_aim1_modeldt_l10_sm
\par \hich\af4\dbch\af31505\loch\f4 EXEC sp_execute_external_script
\par \hich\af4\dbch\af31505\loch\f4 @language =N'R',
\par \hich\af4\dbch\af31505\loch\f4 @script=N'
\par \hich\af4\dbch\af31505\loch\f4     library(nnet)
\par \hich\af4\dbch\af31505\loch\f4     library(stats)
\par \hich\af4\dbch\af31505\loch\f4     rownames(inputdata) <- inputdata$BENE_ID
\par \hich\af4\dbch\af31505\loch\f4     test <- multinom(trtreg ~ year_diag + SEX_IDENT_CD + race_4cat + LIS_status_2cat + metro +  med_cats + pov_cat + geo + 
\par \hich\af4\dbch\af31505\loch\f4                                age + frail_score + nci_index + spec_2cat \hich\af4\dbch\af31505\loch\f4 + QUARTILE_pnpi + npigndr + npi_cats, data = inputdata)    
\par \hich\af4\dbch\af31505\loch\f4     inputdata$regpredprob <- predict(test, newdata = inputdata, "probs")
\par \hich\af4\dbch\af31505\loch\f4     #print(head(inputdata$regpredprob ))
\par \hich\af4\dbch\af31505\loch\f4     coeff_out <-data.frame(inputdata$regpredprob);
\par \hich\af4\dbch\af31505\loch\f4     #print(head(coeff_out))
\par \hich\af4\dbch\af31505\loch\f4     outputdata <- cbind(row.names(coeff_out),coeff_out);'
\par \hich\af4\dbch\af31505\loch\f4     , @input_data_1 = N'select * from Medicare.dbo.IN_aim1_modeldt_l10_sm'
\par \hich\af4\dbch\af31505\loch\f4     , @input_data_1_name = N'inputdata'
\par \hich\af4\dbch\af31505\loch\f4     , @output_data_1_name = N'outputdata'
\par 
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 **************** get data for stage 2 model ******************;
\par \hich\af4\dbch\af31505\loch\f4     Drop table Medicare.dbo.IN_aim1_model_l10_s2 
\par \hich\af4\dbch\af31505\loch\f4     Create table Medicare.dbo.IN_aim1_model_l10_s2 (
\par \hich\af4\dbch\af31505\loch\f4             BENE_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL,trtreg int,cancer_scen varchar(200),
\par \hich\af4\dbch\af31505\loch\f4 total_physician_margin_hm float,  total_physician_margin_hm_100d float, 
\par \hich\af4\dbch\af31505\loch\f4 total_physician_margin_lm float,  total_physician_margin_lm_100d float,
\par \hich\af4\dbch\af31505\loch\f4 guideline_dt date null, guideline_dt2 date null, regimen_type int, preferred int,   
\par \hich\af4\dbch\af31505\loch\f4 ESQC\hich\af4\dbch\af31505\loch\f4  int, wtd_esqc1 float, wtd_esqc2 float, wtd_esqc3 float, wtd_esqc4 float,   
\par \hich\af4\dbch\af31505\loch\f4 rank int,   total_trt int,   fr_rank float, fr_rank_revrs float, 
\par \hich\af4\dbch\af31505\loch\f4 --trtgiven 
\par \hich\af4\dbch\af31505\loch\f4 choice bit,trtinit_dt date null,  regprob float, st_wts float, wins_st_wts float--, quar_prob int
\par \hich\af4\dbch\af31505\loch\f4 );
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX pchars ON IN_aim1_model_l10_s2;
\par 
\par \hich\af4\dbch\af31505\loch\f4 --select distinct trtreg, count(distinct bene_ID) as benes from IN_aim1_modeldt_l10_sm group by trtreg order by trtreg
\par \hich\af4\dbch\af31505\loch\f4 with mrgd as (select distinct a.*, 
\par \hich\af4\dbch\af31505\loch\f4              [28001], [28003]\hich\af4\dbch\af31505\loch\f4 , [28005]  from
\par \hich\af4\dbch\af31505\loch\f4 IN_aim1_modeldt_l10_sm a left join IN_aim1_modeldt_l10_sm_4s2 b on a.bene_ID = b.BENE_ID)
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,regspec as (
\par \hich\af4\dbch\af31505\loch\f4  select distinct bene_ID, trtreg, [28001] as regprob, 28001 as reg from mrgd union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [28003] as regprob, 28003 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [28005] as regprob, 28005 as reg from mrgd) 
\par \hich\af4\dbch\af31505\loch\f4 )   
\par 
\par \hich\af4\dbch\af31505\loch\f4 , regsspec_f as (select distinct bene_ID, reg, regprob from regspec) --where trtreg = reg)
\par \hich\af4\dbch\af31505\loch\f4 --select top 50 * from regsspec_f order by bene_id
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,l10 as (select distinct BENE_ID, trtreg, cancer_scen, total_physician_margin_hm, (total_physician_margin_hm/100) as total_physician_margin_hm_100d , 
\par \hich\af4\dbch\af31505\loch\f4     total_physician_margin_lm, (total_physician_margin_lm/100) as total_physician_margin_lm_100d , guideline_dt, guideline_dt2, regimen_type, preferred, ESQC, wtd_esqc1, wtd_esqc2, wtd_esqc3, wtd_esqc4,   
\par \hich\af4\dbch\af31505\loch\f4     rank, to\hich\af4\dbch\af31505\loch\f4 tal_trt, fr_rank, fr_rank_revrs, choice,trtinit_dt from 
\par \hich\af4\dbch\af31505\loch\f4 IN_aim1_modeldt where cancer_scen = 'l10' ) 
\par 
\par \hich\af4\dbch\af31505\loch\f4 , l10_f as (select distinct a.*, b.regprob from 
\par \hich\af4\dbch\af31505\loch\f4 l10 a inner join regsspec_f b on a.bene_ID = b.bene_ID and a.trtreg = b.reg) 
\par 
\par \hich\af4\dbch\af31505\loch\f4 , l10_f2 as (select distinct *, 
\par \hich\af4\dbch\af31505\loch\f4 (case when trtreg = 28001  then (0.154 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 28003  then (0.415 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 28005  then (0.431 /regprob) end) as st_wts
\par \hich\af4\dbch\af31505\loch\f4 from l10_f)
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,prcnls as (SELECT trtreg--trtreg, st_wts, PERCENT_RANK() OVER(PARTITION BY trtreg OR\hich\af4\dbch\af31505\loch\f4 DER BY st_wts) AS Pctst_wts,
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.05) WITHIN GROUP (ORDER BY st_wts) OVER (PARTITION BY trtreg) as p5
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.94) WITHIN GROUP (ORDER BY st_wts) OVER (PARTITION BY trtreg) as p94
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.95) WITHIN GROUP (ORDER BY st_wts) OVER (PARTITION BY trtreg) as p95
\par \hich\af4\dbch\af31505\loch\f4   FROM l10_f2)
\par \hich\af4\dbch\af31505\loch\f4 -- select distinct trtreg, p5, p94, p95 from prcnls 
\par \hich\af4\dbch\af31505\loch\f4 ,l10_f3 as (select distinct a.*, b.p5, b.p95 from
\par \hich\af4\dbch\af31505\loch\f4               l10_f2 a left join prcnls b on a.trtreg = b.trtreg)
\par \hich\af4\dbch\af31505\loch\f4 -- select top 50 * from l10_f3 order by bene_ID
\par \hich\af4\dbch\af31505\loch\f4 ,l10_f4 as (select *, (case when st_wts >= p95 then p95
\par \hich\af4\dbch\af31505\loch\f4                             when st_wts <= p5  then p5
\par \hich\af4\dbch\af31505\loch\f4                             else st_wts end) as wins_st_wts from l10_f3)
\par \hich\af4\dbch\af31505\loch\f4 --select count(*) from l10_f4
\par \hich\af4\dbch\af31505\loch\f4 insert into IN_aim1_model_l10_s2
\par \hich\af4\dbch\af31505\loch\f4 select top 1411 BENE_ID, trtreg, cancer_scen, total_physician_margin_hm, total_physician_margin_hm_100d , 
\par \hich\af4\dbch\af31505\loch\f4     total_physician_margin_lm, total_physici\hich\af4\dbch\af31505\loch\f4 an_margin_lm_100d , guideline_dt, guideline_dt2, regimen_type, preferred, ESQC, wtd_esqc1, wtd_esqc2, wtd_esqc3, wtd_esqc4,   
\par \hich\af4\dbch\af31505\loch\f4     rank, total_trt, fr_rank, fr_rank_revrs, choice,trtinit_dt, regprob, st_wts, wins_st_wts 
\par \hich\af4\dbch\af31505\loch\f4     from l10_f4 order by BENE_ID
\par 
\par \hich\af4\dbch\af31505\loch\f4 -- 95th percentile is too high, 6 digits
\par 
\par \hich\af4\dbch\af31505\loch\f4 *****************************************************************;
\par \hich\af4\dbch\af31505\loch\f4 *************************  S2 model *****************************;
\par \hich\af4\dbch\af31505\loch\f4 *****************************************************************;
\par 
\par \hich\af4\dbch\af31505\loch\f4 EXEC sp_execu\hich\af4\dbch\af31505\loch\f4 te_external_script
\par \hich\af4\dbch\af31505\loch\f4 @language =N'R',
\par \hich\af4\dbch\af31505\loch\f4 @script=N'
\par \hich\af4\dbch\af31505\loch\f4     library(mlogit)
\par \hich\af4\dbch\af31505\loch\f4     library(dplyr)
\par \hich\af4\dbch\af31505\loch\f4     library(Formula)
\par \hich\af4\dbch\af31505\loch\f4     TM <- dfidx(inputdata, idx=c("BENE_ID","trtreg"), alt.var = "trtreg", pkg = "mlogit")
\par \hich\af4\dbch\af31505\loch\f4     m1 <- mlogit(choice ~ fr_rank_revrs| 1 , weights = wins_st_wts, TM)
\par \hich\af4\dbch\af31505\loch\f4     print( summary(m1)) 
\par \hich\af4\dbch\af31505\loch\f4     print(confint(m1));'
\par \hich\af4\dbch\af31505\loch\f4         , @input_data_1 = N'select * from Medicare.dbo.IN_aim1_model_l10_s2'
\par \hich\af4\dbch\af31505\loch\f4         , @input_data_1_name = N'inputdata';
\par 
\par \hich\af4\dbch\af31505\loch\f4 -- cannot put margin in model as it is always 0 across our study time for analytical cohort
\par \hich\af4\dbch\af31505\loch\f4 --total_physician_margin_hm_100d + 
\par 
\par \hich\af4\dbch\af31505\loch\f4 *******************************;
\par \hich\af4\dbch\af31505\loch\f4 *************rectum1 **********;
\par \hich\af4\dbch\af31505\loch\f4 *******************************;
\par 
\par \hich\af4\dbch\af31505\loch\f4 ********* get table for stage1 - can c\hich\af4\dbch\af31505\loch\f4 all disease risk group modeling;
\par \hich\af4\dbch\af31505\loch\f4 drop table IN_aim1_modeldt_rectum1_sm
\par \hich\af4\dbch\af31505\loch\f4 Create table Medicare.dbo.IN_aim1_modeldt_rectum1_sm (
\par \hich\af4\dbch\af31505\loch\f4             BENE_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL, year_diag varchar(4), geo varchar(10), metro varchar(1), 
\par \hich\af4\dbch\af31505\loch\f4             trtreg int, guideline_dt date, choice bit,  total_physician_margin_hm int, nci_index float, frail_score float, 
\par \hich\af4\dbch\af31505\loch\f4             age int,  BENE_RACE_CD int, --RTI_RACE_CD int, 
\par \hich\af4\dbch\af31505\loch\f4             race_4cat varchar(15),  SEX_IDENT_CD varchar(1), LIS_stat\hich\af4\dbch\af31505\loch\f4 us varchar(25), med_cats varchar(16), pov_cat varchar(30),
\par \hich\af4\dbch\af31505\loch\f4             spec varchar (200), QUARTILE_pnpi varchar(1), npigndr varchar (1), npigrd_yr int, npi_cats varchar(14),
\par \hich\af4\dbch\af31505\loch\f4             spec_2cat varchar (200), LIS_status_2cat varchar(25), SNo int,
\par 
\par \hich\af4\dbch\af31505\loch\f4 );
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX pcharsml ON IN_aim1_modeldt_rectum1_sm;
\par 
\par \hich\af4\dbch\af31505\loch\f4 with reg_benes as (select distinct trtreg, count (distinct bene_ID) as benes from IN_aim1_modeldt 
\par \hich\af4\dbch\af31505\loch\f4                    where cancer_scen = 'rectum1' and choice = 1 group by trtreg)
\par \hich\af4\dbch\af31505\loch\f4     ,foreligreg as (select distinct a.*, b.benes from
\par \hich\af4\dbch\af31505\loch\f4                    IN_aim1_modeldt a inner join reg_benes b on a.trtreg = b.trtreg where a.cancer_scen = 'rectum1')
\par \hich\af4\dbch\af31505\loch\f4 --keep regimens if > 20 benes receive that regimen
\par \hich\af4\dbch\af31505\loch\f4     ,elig_reg as (select * from foreligreg where benes >20)
\par \hich\af4\dbch\af31505\loch\f4 --keep benes if they have 2 levels for choice variable once we drop regimens with few benes
\par \hich\af4\dbch\af31505\loch\f4     ,fl as (select distinct bene_ID, count(distinct choice\hich\af4\dbch\af31505\loch\f4 ) as fl from elig_reg group by bene_ID)
\par \hich\af4\dbch\af31505\loch\f4     ,foreligbene as (select distinct a.*, b.fl from
\par \hich\af4\dbch\af31505\loch\f4                       elig_reg a left join fl b on a.BENE_ID = b.bene_ID)               
\par \hich\af4\dbch\af31505\loch\f4 --select count(*), count(distinct bene_ID) as benes from foreligbene where fl =2
\par \hich\af4\dbch\af31505\loch\f4     insert into IN_aim1_modeldt_rectum1_sm --IN_aim1 as (
\par \hich\af4\dbch\af31505\loch\f4         select BENE_ID, year_diag, geo, metro, trtreg, guideline_dt, choice, total_physician_margin_hm, 
\par \hich\af4\dbch\af31505\loch\f4         nci_index, frail_score, age, bene_race_cd, --RTI_RACE_CD, 
\par \hich\af4\dbch\af31505\loch\f4         race_4cat, S\hich\af4\dbch\af31505\loch\f4 EX_IDENT_CD, LIS_status, med_cats, pov_cat, spec, QUARTILE_pnpi, npigndr, npigrd_yr, npi_cats,
\par \hich\af4\dbch\af31505\loch\f4         spec_2cat, LIS_status_2cat,
\par \hich\af4\dbch\af31505\loch\f4         ROW_NUMBER() OVER(ORDER BY (bene_ID)) AS SNo from foreligbene where fl = 2 and choice = 1
\par \hich\af4\dbch\af31505\loch\f4 --select count(distinct bene_ID) as benes, count(distinct trtreg) as regs from IN_aim1_modeldt_rectum1_sm
\par 
\par \hich\af4\dbch\af31505\loch\f4 --select distinct trtreg from IN_aim1_modeldt_rectum1_sm order by trtreg
\par \hich\af4\dbch\af31505\loch\f4 drop table IN_aim1_modeldt_rectum1_sm_4s2
\par \hich\af4\dbch\af31505\loch\f4 Create table Medicare.dbo.IN_aim1_modeldt_rectum1_sm_4s2 (
\par \hich\af4\dbch\af31505\loch\f4   \hich\af4\dbch\af31505\loch\f4           BENE_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL,
\par \hich\af4\dbch\af31505\loch\f4 [32080] float,  [32081] float,  [32084] float,  [32086] float,  [32088] float,  [32094] float);
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX pcharsml ON IN_aim1_modeldt_rectum1_sm_4s2;
\par 
\par \hich\af4\dbch\af31505\loch\f4 insert into IN_aim1_modeldt_rectum1_sm_4s2
\par \hich\af4\dbch\af31505\loch\f4 --select distinct bene_ID from IN_aim1_modeldt_rectum1_sm
\par \hich\af4\dbch\af31505\loch\f4 EXEC sp_execute_external_script
\par \hich\af4\dbch\af31505\loch\f4 @language =N'R',
\par \hich\af4\dbch\af31505\loch\f4 @script=N'
\par \hich\af4\dbch\af31505\loch\f4     library(nnet)
\par \hich\af4\dbch\af31505\loch\f4     library(stats)
\par \hich\af4\dbch\af31505\loch\f4     rownames(inputdata) <- inputdata$BENE_ID
\par \hich\af4\dbch\af31505\loch\f4     test <- multinom(trtreg ~ year_diag + SEX_IDENT_CD + race_4cat + LIS_status_2cat + metro +  med_cats + pov_cat + geo + 
\par \hich\af4\dbch\af31505\loch\f4                                age + frail_score + nci_index \hich\af4\dbch\af31505\loch\f4 + spec_2cat + QUARTILE_pnpi + npigndr + npi_cats, data = inputdata)    
\par \hich\af4\dbch\af31505\loch\f4     inputdata$regpredprob <- predict(test, newdata = inputdata, "probs")
\par \hich\af4\dbch\af31505\loch\f4     #print(head(inputdata$regpredprob ))
\par \hich\af4\dbch\af31505\loch\f4     coeff_out <-data.frame(inputdata$regpredprob);
\par \hich\af4\dbch\af31505\loch\f4     #print(head(coeff_out))
\par \hich\af4\dbch\af31505\loch\f4     outputdata <- cbind(row.names(coeff_out),coeff_out);'
\par \hich\af4\dbch\af31505\loch\f4     , @input_data_1 = N'select * from Medicare.dbo.IN_aim1_modeldt_rectum1_sm'
\par \hich\af4\dbch\af31505\loch\f4     , @input_data_1_name = N'inputdata'
\par \hich\af4\dbch\af31505\loch\f4     , @output_data_1_name = N'outputdata'
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 **************** get data \hich\af4\dbch\af31505\loch\f4 for stage 2 model ******************;
\par \hich\af4\dbch\af31505\loch\f4     Drop table Medicare.dbo.IN_aim1_model_rectum1_s2 
\par \hich\af4\dbch\af31505\loch\f4     Create table Medicare.dbo.IN_aim1_model_rectum1_s2 (
\par \hich\af4\dbch\af31505\loch\f4             BENE_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL,trtreg int,cancer_scen varchar(200),
\par \hich\af4\dbch\af31505\loch\f4 total_physician_margin_hm float,  total_physician_margin_hm_100d float, 
\par \hich\af4\dbch\af31505\loch\f4 total_physician_margin_lm float,  total_physician_margin_lm_100d float,
\par \hich\af4\dbch\af31505\loch\f4 guideline_dt date null, guideline_dt2 date null, regimen_type int, preferred int,   
\par \hich\af4\dbch\af31505\loch\f4 ESQC int, wtd_esqc1 float, wtd_esqc2 float, wtd_esqc3 float, wtd_esqc4 float,   
\par \hich\af4\dbch\af31505\loch\f4 rank int,   total_trt int,   fr_rank float, fr_rank_revrs float, 
\par \hich\af4\dbch\af31505\loch\f4 --trtgiven 
\par \hich\af4\dbch\af31505\loch\f4 choice bit,t\hich\af4\dbch\af31505\loch\f4 rtinit_dt date null,  regprob float, st_wts float, wins_st_wts float--, quar_prob int
\par \hich\af4\dbch\af31505\loch\f4 );
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX pchars ON IN_aim1_model_rectum1_s2;
\par 
\par \hich\af4\dbch\af31505\loch\f4 --select distinct trtreg, count(distinct bene_ID) as benes from IN_aim1_modeldt_rectum1_sm group by trtreg order by trtreg
\par \hich\af4\dbch\af31505\loch\f4 with mrgd as (select distinct a.*, 
\par \hich\af4\dbch\af31505\loch\f4 [32080],    [32081],    [32084],    [32086],    [32088],    [32094] from
\par \hich\af4\dbch\af31505\loch\f4 IN_aim1_modeldt_rectum1_sm a left join IN_aim1_modeldt_rectum1_sm_4s2 b on a.bene_ID = b.BENE_ID)
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,regspec as (
\par \hich\af4\dbch\af31505\loch\f4 se\hich\af4\dbch\af31505\loch\f4 lect distinct bene_ID, trtreg, [32080] as regprob, 32080 as reg from mrgd union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [32081] as regprob, 32081 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [32084] as regprob, 32084 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [32086] as regprob, 32086 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [32088] as regprob, 32088 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [32094] as regprob, 32094 as reg from mrgd))   
\par 
\par \hich\af4\dbch\af31505\loch\f4 , regsspec_f \hich\af4\dbch\af31505\loch\f4 as (select distinct bene_ID, reg, regprob from regspec) --where trtreg = reg)
\par \hich\af4\dbch\af31505\loch\f4 --select top 50 * from regsspec_f order by bene_id
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,rectum1 as (select distinct BENE_ID, trtreg, cancer_scen, total_physician_margin_hm, (total_physician_margin_hm/100) as total_physician_margin_hm_100d , 
\par \hich\af4\dbch\af31505\loch\f4     total_physician_margin_lm, (total_physician_margin_lm/100) as total_physician_margin_lm_100d , guideline_dt, guideline_dt2, regimen_type, preferred, ESQC, wtd_esqc1, wtd_esqc2, wtd_esqc3, wtd_esqc4,   
\par \hich\af4\dbch\af31505\loch\f4     rank, total_trt, fr_rank, fr_rank_revrs, choice,trtinit_dt from 
\par \hich\af4\dbch\af31505\loch\f4 IN_aim1_modeldt where cancer_scen = 'rectum1' ) 
\par 
\par \hich\af4\dbch\af31505\loch\f4 , rectum1_f as (select distinct \hich\af4\dbch\af31505\loch\f4 a.*, b.regprob from 
\par \hich\af4\dbch\af31505\loch\f4 rectum1 a inner join regsspec_f b on a.bene_ID = b.bene_ID and a.trtreg = b.reg) 
\par 
\par \hich\af4\dbch\af31505\loch\f4 , rectum1_f2 as (select distinct *, 
\par \hich\af4\dbch\af31505\loch\f4 (case when trtreg = 32080  then (0.342 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 32081  then (0.325 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 32084  then (0.041 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 32086  then (0.072 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 32088  then (0.053 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 32094  then (0.167 /regprob) end) as st_wts
\par \hich\af4\dbch\af31505\loch\f4 from rectum1_f)
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,prcnls as (SELECT trtreg--trtreg, st_wts, PERCENT_RANK() OVER(PARTITION BY\hich\af4\dbch\af31505\loch\f4  trtreg ORDER BY st_wts) AS Pctst_wts,
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.05) WITHIN GROUP (ORDER BY st_wts) OVER (PARTITION BY trtreg) as p5
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.94) WITHIN GROUP (ORDER BY st_wts) OVER (PARTITION BY trtreg) as p94
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.95) WITHIN GROUP (ORDER BY st_wts) OVER (PARTITION BY trtreg) as p95
\par \hich\af4\dbch\af31505\loch\f4   FROM rectum1_f2)
\par \hich\af4\dbch\af31505\loch\f4 -- select distinct trtreg, p5, p94, p95 from prcnls 
\par \hich\af4\dbch\af31505\loch\f4 ,rectum1_f3 as (select distinct a.*, b.p5, b.p95 from
\par \hich\af4\dbch\af31505\loch\f4               rectum1_f2 a left join prcnls b on a.trtreg = b.trtreg)
\par \hich\af4\dbch\af31505\loch\f4 -- select top 50 * from rectum1_f3 order by bene_ID
\par \hich\af4\dbch\af31505\loch\f4 ,rectum1_f4 as (select *, (case when st_wts >= p95 then p95
\par \hich\af4\dbch\af31505\loch\f4                             when st_wts <= p5  then p5
\par \hich\af4\dbch\af31505\loch\f4                             else st_wts end) as wins_st_wts from rectum1_f3)
\par \hich\af4\dbch\af31505\loch\f4 --select count(*) from rectum1_f4
\par \hich\af4\dbch\af31505\loch\f4 insert into IN_aim1_model_rectum1_s2
\par \hich\af4\dbch\af31505\loch\f4 select top 3084 BENE_ID, trtreg, cancer_scen, total_physician_margin_hm, \hich\af4\dbch\af31505\loch\f4 total_physician_margin_hm_100d , 
\par \hich\af4\dbch\af31505\loch\f4     total_physician_margin_lm, total_physician_margin_lm_100d , guideline_dt, guideline_dt2, regimen_type, preferred, ESQC, wtd_esqc1, wtd_esqc2, wtd_esqc3, wtd_esqc4,   
\par \hich\af4\dbch\af31505\loch\f4     rank, total_trt, fr_rank, fr_rank_revrs, choice,trtinit_dt, regprob, st_wts, wins_st_wts 
\par \hich\af4\dbch\af31505\loch\f4     from rectum1_f4 order by BENE_ID
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 *****************************************************************;
\par \hich\af4\dbch\af31505\loch\f4 *************************  S2 model *****************************;
\par \hich\af4\dbch\af31505\loch\f4 ****************************************\hich\af4\dbch\af31505\loch\f4 *************************;
\par 
\par \hich\af4\dbch\af31505\loch\f4 EXEC sp_execute_external_script
\par \hich\af4\dbch\af31505\loch\f4 @language =N'R',
\par \hich\af4\dbch\af31505\loch\f4 @script=N'
\par \hich\af4\dbch\af31505\loch\f4     library(mlogit)
\par \hich\af4\dbch\af31505\loch\f4     library(dplyr)
\par \hich\af4\dbch\af31505\loch\f4     library(Formula)
\par \hich\af4\dbch\af31505\loch\f4     TM <- dfidx(inputdata, idx=c("BENE_ID","trtreg"), alt.var = "trtreg", pkg = "mlogit")
\par \hich\af4\dbch\af31505\loch\f4     m1 <- mlogit(choice ~ total_physician_margin_hm_100d + fr_rank_revrs| 1 , weights = wins_st_wts, TM)
\par \hich\af4\dbch\af31505\loch\f4     print( summary(m1)) 
\par \hich\af4\dbch\af31505\loch\f4     print(confint(m1));'
\par \hich\af4\dbch\af31505\loch\f4         , @input_data_1 = N'select * from Medicare.dbo.IN_aim1_model_rectum1_s2'
\par \hich\af4\dbch\af31505\loch\f4         , @input_data_1_name = N'inputdata';
\par 
\par 
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 *******************************;
\par \hich\af4\dbch\af31505\loch\f4 *************cll **************;
\par \hich\af4\dbch\af31505\loch\f4 *******************************;
\par 
\par \hich\af4\dbch\af31505\loch\f4 ********* get table for stage1 - can call disease risk group modeling;
\par \hich\af4\dbch\af31505\loch\f4 drop table IN_aim1_modeldt_cll_sm
\par \hich\af4\dbch\af31505\loch\f4 Create table Medicare.\hich\af4\dbch\af31505\loch\f4 dbo.IN_aim1_modeldt_cll_sm (
\par \hich\af4\dbch\af31505\loch\f4             BENE_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL, year_diag varchar(4), geo varchar(10), metro varchar(1), 
\par \hich\af4\dbch\af31505\loch\f4             trtreg int, guideline_dt date, choice bit,  total_physician_margin_hm int, nci_index float, frail_score float, 
\par \hich\af4\dbch\af31505\loch\f4             age int,  BENE_RACE_CD int, --RTI_RACE_CD int, 
\par \hich\af4\dbch\af31505\loch\f4             race_4cat varchar(15),  SEX_IDENT_CD varchar(1), LIS_status varchar(25), med_cats varchar(16), pov_cat varchar(30),
\par \hich\af4\dbch\af31505\loch\f4             spec varchar (200), QUARTI\hich\af4\dbch\af31505\loch\f4 LE_pnpi varchar(1), npigndr varchar (1), npigrd_yr int, npi_cats varchar(14),
\par \hich\af4\dbch\af31505\loch\f4             spec_2cat varchar (200), LIS_status_2cat varchar(25), SNo int,
\par 
\par \hich\af4\dbch\af31505\loch\f4 );
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX pcharsml ON IN_aim1_modeldt_cll_sm;
\par 
\par \hich\af4\dbch\af31505\loch\f4 with reg_benes as (select distinct trtreg, count (distinct bene_ID) as benes from IN_aim1_modeldt 
\par \hich\af4\dbch\af31505\loch\f4                    where cancer_scen = 'cll' and choice = 1 group by trtreg)
\par \hich\af4\dbch\af31505\loch\f4     ,foreligreg as (select distinct a.*, b.benes from
\par \hich\af4\dbch\af31505\loch\f4                    IN_aim1_modeldt a inner join reg_benes b on a.trtreg = b.trtreg where a.cancer_scen = 'cll')
\par \hich\af4\dbch\af31505\loch\f4     ,elig_reg as (select * from foreligreg where benes >20)
\par \hich\af4\dbch\af31505\loch\f4     ,fl as (select distinct bene_ID, count(distinct choice) as fl from elig_reg group by bene_ID)
\par \hich\af4\dbch\af31505\loch\f4     ,forelig\hich\af4\dbch\af31505\loch\f4 bene as (select distinct a.*, b.fl from
\par \hich\af4\dbch\af31505\loch\f4                       elig_reg a left join fl b on a.BENE_ID = b.bene_ID)               
\par \hich\af4\dbch\af31505\loch\f4 --select count(*), count(distinct bene_ID) as benes from foreligbene where fl =2
\par \hich\af4\dbch\af31505\loch\f4     insert into IN_aim1_modeldt_cll_sm --IN_aim1 as (
\par \hich\af4\dbch\af31505\loch\f4         select BENE_ID, year_diag, geo, metro, trtreg, guideline_dt, choice, total_physician_margin_hm, 
\par \hich\af4\dbch\af31505\loch\f4         nci_index, frail_score, age, bene_race_cd, --RTI_RACE_CD, 
\par \hich\af4\dbch\af31505\loch\f4         race_4cat, SEX_IDENT_CD, LIS_status, med_cats, pov_cat, spec, QUARTI\hich\af4\dbch\af31505\loch\f4 LE_pnpi, npigndr, npigrd_yr, npi_cats,
\par \hich\af4\dbch\af31505\loch\f4         spec_2cat, LIS_status_2cat,
\par \hich\af4\dbch\af31505\loch\f4         ROW_NUMBER() OVER(ORDER BY (bene_ID)) AS SNo from foreligbene where fl = 2 and choice = 1
\par \hich\af4\dbch\af31505\loch\f4 --select count(distinct bene_ID), count(distinct trtreg) from IN_aim1_modeldt_cll_sm
\par 
\par \hich\af4\dbch\af31505\loch\f4 --select distinct trtreg from IN_aim1_modeldt_cll_sm order by trtreg
\par \hich\af4\dbch\af31505\loch\f4 drop table IN_aim1_modeldt_cll_sm_4s2
\par \hich\af4\dbch\af31505\loch\f4 Create table Medicare.dbo.IN_aim1_modeldt_cll_sm_4s2 (
\par \hich\af4\dbch\af31505\loch\f4             BENE_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL,
\par \hich\af4\dbch\af31505\loch\f4 [17001] float,  \hich\af4\dbch\af31505\loch\f4 [17005] float,  [17006] float,  [17011] float,  [17013] float);
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX pcharsml ON IN_aim1_modeldt_cll_sm_4s2;
\par 
\par \hich\af4\dbch\af31505\loch\f4 insert into IN_aim1_modeldt_cll_sm_4s2
\par \hich\af4\dbch\af31505\loch\f4 --select distinct bene_ID from IN_aim1_modeldt_cll_sm
\par \hich\af4\dbch\af31505\loch\f4 EXEC sp_execute_external_script
\par \hich\af4\dbch\af31505\loch\f4 @language =N'R',
\par \hich\af4\dbch\af31505\loch\f4 @script=N'
\par \hich\af4\dbch\af31505\loch\f4     library(nnet)
\par \hich\af4\dbch\af31505\loch\f4     library(stats)
\par \hich\af4\dbch\af31505\loch\f4     rownames(inputdata) <- inputdata$BENE_ID
\par \hich\af4\dbch\af31505\loch\f4     test <- multinom(trtreg ~ year_diag + SEX_IDENT_CD + race_4cat + LIS_status_2cat + metro +  med_cats + pov_cat + geo + 
\par \hich\af4\dbch\af31505\loch\f4                                age + frail_score + nci_index + spec_2cat + QUARTILE_pnpi + npigndr + npi_cats, data = inputdata)    
\par \hich\af4\dbch\af31505\loch\f4     inputdata$regpredprob <- predict(test, newdata = inputd\hich\af4\dbch\af31505\loch\f4 ata, "probs")
\par \hich\af4\dbch\af31505\loch\f4     #print(head(inputdata$regpredprob ))
\par \hich\af4\dbch\af31505\loch\f4     coeff_out <-data.frame(inputdata$regpredprob);
\par \hich\af4\dbch\af31505\loch\f4     #print(head(coeff_out))
\par \hich\af4\dbch\af31505\loch\f4     outputdata <- cbind(row.names(coeff_out),coeff_out);'
\par \hich\af4\dbch\af31505\loch\f4     , @input_data_1 = N'select * from Medicare.dbo.IN_aim1_modeldt_cll_sm'
\par \hich\af4\dbch\af31505\loch\f4     , @input_data_1_name = N'inputdata'
\par \hich\af4\dbch\af31505\loch\f4     , @output_data_1_name = N'outputdata'
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 **************** get data for stage 2 model ******************;
\par \hich\af4\dbch\af31505\loch\f4     Drop table Medicare.dbo.IN_aim1_model_cll_s2 
\par \hich\af4\dbch\af31505\loch\f4     Create table Medicare.dbo.IN_aim1_model_cll\hich\af4\dbch\af31505\loch\f4 _s2 (
\par \hich\af4\dbch\af31505\loch\f4             BENE_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL,trtreg int,cancer_scen varchar(200),
\par \hich\af4\dbch\af31505\loch\f4 total_physician_margin_hm float,  total_physician_margin_hm_100d float, 
\par \hich\af4\dbch\af31505\loch\f4 total_physician_margin_lm float,  total_physician_margin_lm_100d float,
\par \hich\af4\dbch\af31505\loch\f4 guideline_dt date null, guideline_dt2 date null, regimen_type int, preferred int,   
\par \hich\af4\dbch\af31505\loch\f4 ESQC int, wtd_esqc1 float, wtd_esqc2 float, wtd_esqc3 float, wtd_esqc4 float,   
\par \hich\af4\dbch\af31505\loch\f4 rank int,   total_trt int,   fr_rank float, fr_rank_revrs float, 
\par \hich\af4\dbch\af31505\loch\f4 --trtgiven 
\par \hich\af4\dbch\af31505\loch\f4 choice bit,trtinit_dt date null,  regprob float, st_wts float, wins_st_wts float--, quar_prob int
\par \hich\af4\dbch\af31505\loch\f4 );
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX pchars ON IN_aim1_model_cll_s2;
\par 
\par \hich\af4\dbch\af31505\loch\f4 --select distinct trtre\hich\af4\dbch\af31505\loch\f4 g, count(distinct bene_ID) as benes from IN_aim1_modeldt_cll_sm group by trtreg order by trtreg
\par \hich\af4\dbch\af31505\loch\f4 with mrgd as (select distinct a.*, 
\par \hich\af4\dbch\af31505\loch\f4 [17001],    [17005],    [17006],    [17011],    [17013] from
\par \hich\af4\dbch\af31505\loch\f4 IN_aim1_modeldt_cll_sm a left join IN_aim1_modeldt_cll_sm_4s2 b on a.bene_ID = b.BENE_ID)
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,regspec as (
\par \hich\af4\dbch\af31505\loch\f4 select distinct bene_ID, trtreg, [17001] as regprob, 17001 as reg from mrgd union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [17005] as regprob, 17005 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [17006] as reg\hich\af4\dbch\af31505\loch\f4 prob, 17006 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [17011] as regprob, 17011 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [17013] as regprob, 17013 as reg from mrgd))   
\par 
\par \hich\af4\dbch\af31505\loch\f4 , regsspec_f as (select distinct bene_ID, reg, regprob from regspec) --where trtreg = reg)
\par \hich\af4\dbch\af31505\loch\f4 --select top 50 * from regsspec_f order by bene_id
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,cll as (select distinct BENE_ID, trtreg, cancer_scen, total_physician_margin_hm, (total_physician_margin_hm/100) as total_physician_margin_hm_100d , 
\par \hich\af4\dbch\af31505\loch\f4     total_physician_margin_lm, (total_physician_margin_lm/100) as total_physician_margin_lm_100d , guideline_dt, guideline_dt2, regimen_type, preferred, ESQC, wtd_esqc1, wtd_esqc2, wtd_esqc3, wtd_esqc4,   
\par \hich\af4\dbch\af31505\loch\f4     rank, total_trt, fr_rank, fr_rank_revrs, choice,trtinit_dt from 
\par \hich\af4\dbch\af31505\loch\f4 IN_aim1_modeldt where cancer_scen = 'cll' ) 
\par 
\par \hich\af4\dbch\af31505\loch\f4 , cll_f as (select distinct a.*, b.regprob from 
\par \hich\af4\dbch\af31505\loch\f4 cll a inner join regsspec_f b on a.bene_ID = b.bene_ID and a.trtreg = b.reg) 
\par 
\par \hich\af4\dbch\af31505\loch\f4 , cll_f2 as (select distinct *, 
\par \hich\af4\dbch\af31505\loch\f4 (case when trtreg = 17001  the\hich\af4\dbch\af31505\loch\f4 n (0.527 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 17005  then (0.174 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 17006  then (0.077 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 17011  then (0.059 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 17013  then (0.164 /regprob) end) as st_wts
\par \hich\af4\dbch\af31505\loch\f4 from cll_f)
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,prcnls as (SELECT trtreg--trtreg, st_wts, PERCENT_RANK() OVER(PARTITION BY trtreg ORDER BY st_wts) AS Pctst_wts,
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.05) WITHIN GROUP (ORDER BY st_wts) OVER (PARTITION BY trtreg) as p5
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.94) WITHIN GROUP (ORDER BY st_wts) OVER (PARTITIO\hich\af4\dbch\af31505\loch\f4 N BY trtreg) as p94
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.95) WITHIN GROUP (ORDER BY st_wts) OVER (PARTITION BY trtreg) as p95
\par \hich\af4\dbch\af31505\loch\f4   FROM cll_f2)
\par \hich\af4\dbch\af31505\loch\f4 -- select distinct trtreg, p5, p94, p95 from prcnls 
\par \hich\af4\dbch\af31505\loch\f4 ,cll_f3 as (select distinct a.*, b.p5, b.p95 from
\par \hich\af4\dbch\af31505\loch\f4               cll_f2 a left join prcnls b on a.trtreg = b.trtreg)
\par \hich\af4\dbch\af31505\loch\f4 -- select top 50 * from cll_f3 order by bene_ID
\par \hich\af4\dbch\af31505\loch\f4 ,cll_f4 as (select *, (case when st_wts >= p95 then p95
\par \hich\af4\dbch\af31505\loch\f4                             when st_wts <= p5  then p5
\par \hich\af4\dbch\af31505\loch\f4                             else st_wts end) as wins_st_wts from cll_f3)
\par \hich\af4\dbch\af31505\loch\f4 --select count(*) from cll_f4
\par \hich\af4\dbch\af31505\loch\f4 insert into IN_aim1_model_cll_s2
\par \hich\af4\dbch\af31505\loch\f4 select top 2990 BENE_ID, trtreg, cancer_scen, total_physician_margin_hm, total_physician_margin_hm_100d , 
\par \hich\af4\dbch\af31505\loch\f4     total_physician_margin_lm, total_physician_margin_lm_100d , guideline_dt, guideline_dt2, regimen_type, preferred, ESQC, wtd_esqc1, wtd_esqc2, wtd_esqc3, wtd_esqc4,   
\par \hich\af4\dbch\af31505\loch\f4     rank, total_trt, fr_rank, fr_rank_revrs\hich\af4\dbch\af31505\loch\f4 , choice,trtinit_dt, regprob, st_wts, wins_st_wts 
\par \hich\af4\dbch\af31505\loch\f4     from cll_f4 order by BENE_ID
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 *****************************************************************;
\par \hich\af4\dbch\af31505\loch\f4 *************************  S2 model *****************************;
\par \hich\af4\dbch\af31505\loch\f4 *****************************************************************;
\par 
\par \hich\af4\dbch\af31505\loch\f4 EXEC sp_execute_external_script
\par \hich\af4\dbch\af31505\loch\f4 @language =N'R',
\par \hich\af4\dbch\af31505\loch\f4 @script=N'
\par \hich\af4\dbch\af31505\loch\f4     library(mlogit)
\par \hich\af4\dbch\af31505\loch\f4     library(dplyr)
\par \hich\af4\dbch\af31505\loch\f4     library(Formula)
\par \hich\af4\dbch\af31505\loch\f4     TM <- dfidx(inputdata, idx=c("BENE_ID","trtreg"), alt.var = "trtreg", pkg = "mlogit")
\par \hich\af4\dbch\af31505\loch\f4     m1 <- mlog\hich\af4\dbch\af31505\loch\f4 it(choice ~ total_physician_margin_hm_100d + fr_rank_revrs| 1 , weights = wins_st_wts, TM)
\par \hich\af4\dbch\af31505\loch\f4     print( summary(m1)) 
\par \hich\af4\dbch\af31505\loch\f4     print(confint(m1));'
\par \hich\af4\dbch\af31505\loch\f4         , @input_data_1 = N'select * from Medicare.dbo.IN_aim1_model_cll_s2'
\par \hich\af4\dbch\af31505\loch\f4         , @input_data_1_name = N'inputdata';
\par 
\par 
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 *******************************;
\par \hich\af4\dbch\af31505\loch\f4 ************* colon1 **********;
\par \hich\af4\dbch\af31505\loch\f4 *******************************;
\par 
\par \hich\af4\dbch\af31505\loch\f4 ********* get table for stage1 - can call disease risk group modeling;
\par \hich\af4\dbch\af31505\loch\f4 drop table IN_aim1_modeldt_colon1_sm
\par \hich\af4\dbch\af31505\loch\f4 Create table Medicare.dbo.IN_aim1_modeldt_colon1_sm (
\par \hich\af4\dbch\af31505\loch\f4             BENE_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL, year_diag varchar(4), geo varchar(10), metro varchar(1), 
\par \hich\af4\dbch\af31505\loch\f4             trtreg int, guideline_dt date, choice bit,  total_physic\hich\af4\dbch\af31505\loch\f4 ian_margin_hm int, nci_index float, frail_score float, 
\par \hich\af4\dbch\af31505\loch\f4             age int,  BENE_RACE_CD int, --RTI_RACE_CD int, 
\par \hich\af4\dbch\af31505\loch\f4             race_4cat varchar(15),  SEX_IDENT_CD varchar(1), LIS_status varchar(25), med_cats varchar(16), pov_cat varchar(30),
\par \hich\af4\dbch\af31505\loch\f4             spec varchar (200), QUARTILE_pnpi varchar(1), npigndr varchar (1), npigrd_yr int, npi_cats varchar(14),
\par \hich\af4\dbch\af31505\loch\f4             spec_2cat varchar (200), LIS_status_2cat varchar(25), SNo int,
\par 
\par \hich\af4\dbch\af31505\loch\f4 );
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX pcharsml ON IN_aim1_modeldt_colon1\hich\af4\dbch\af31505\loch\f4 _sm;
\par 
\par \hich\af4\dbch\af31505\loch\f4 with reg_benes as (select distinct trtreg, count (distinct bene_ID) as benes from IN_aim1_modeldt 
\par \hich\af4\dbch\af31505\loch\f4                    where cancer_scen = 'colon1' and choice = 1 group by trtreg)
\par \hich\af4\dbch\af31505\loch\f4     ,foreligreg as (select distinct a.*, b.benes from
\par \hich\af4\dbch\af31505\loch\f4                    IN_aim1_modeldt a inner join reg_benes b on a.trtreg = b.trtreg where a.cancer_scen = 'colon1')
\par \hich\af4\dbch\af31505\loch\f4     ,elig_reg as (select * from foreligreg where benes >20)
\par \hich\af4\dbch\af31505\loch\f4     ,fl as (select distinct bene_ID, count(distinct choice) as fl from elig_reg group by bene_ID)
\par \hich\af4\dbch\af31505\loch\f4     ,foreligbene as (select distinct a.*, b.fl from
\par \hich\af4\dbch\af31505\loch\f4                       elig_reg a left join fl b on a.BENE_ID = b.bene_ID)               
\par \hich\af4\dbch\af31505\loch\f4 --select count(*), count(distinct bene_ID) as benes from foreligbene where fl =2
\par \hich\af4\dbch\af31505\loch\f4     insert into I\hich\af4\dbch\af31505\loch\f4 N_aim1_modeldt_colon1_sm --IN_aim1 as (
\par \hich\af4\dbch\af31505\loch\f4         select BENE_ID, year_diag, geo, metro, trtreg, guideline_dt, choice, total_physician_margin_hm, 
\par \hich\af4\dbch\af31505\loch\f4         nci_index, frail_score, age, bene_race_cd, --RTI_RACE_CD, 
\par \hich\af4\dbch\af31505\loch\f4         race_4cat, SEX_IDENT_CD, LIS_status, med_cats, pov_cat, spec, QUARTILE_pnpi, npigndr, npigrd_yr, npi_cats,
\par \hich\af4\dbch\af31505\loch\f4         spec_2cat, LIS_status_2cat,
\par \hich\af4\dbch\af31505\loch\f4         ROW_NUMBER() OVER(ORDER BY (bene_ID)) AS SNo from foreligbene where fl = 2 and choice = 1
\par \hich\af4\dbch\af31505\loch\f4 --select count(distinct bene_ID), count(distinct tr\hich\af4\dbch\af31505\loch\f4 treg) from IN_aim1_modeldt_colon1_sm
\par 
\par \hich\af4\dbch\af31505\loch\f4 --select distinct trtreg from IN_aim1_modeldt_colon1_sm order by trtreg
\par \hich\af4\dbch\af31505\loch\f4 drop table IN_aim1_modeldt_colon1_sm_4s2
\par \hich\af4\dbch\af31505\loch\f4 Create table Medicare.dbo.IN_aim1_modeldt_colon1_sm_4s2 (
\par \hich\af4\dbch\af31505\loch\f4             BENE_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL,
\par \hich\af4\dbch\af31505\loch\f4 [19050] float,  [19051] float,  [19053] float,  [19054] float,  [19055] float,  [19056] float,  [19057] float,  
\par \hich\af4\dbch\af31505\loch\f4 [19058] float,  [19063] float,  [19064] float,  [19065] float);
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX pcharsml ON \hich\af4\dbch\af31505\loch\f4 IN_aim1_modeldt_colon1_sm_4s2;
\par 
\par \hich\af4\dbch\af31505\loch\f4 insert into IN_aim1_modeldt_colon1_sm_4s2
\par \hich\af4\dbch\af31505\loch\f4 --select distinct bene_ID from IN_aim1_modeldt_colon1_sm
\par \hich\af4\dbch\af31505\loch\f4 EXEC sp_execute_external_script
\par \hich\af4\dbch\af31505\loch\f4 @language =N'R',
\par \hich\af4\dbch\af31505\loch\f4 @script=N'
\par \hich\af4\dbch\af31505\loch\f4     library(nnet)
\par \hich\af4\dbch\af31505\loch\f4     library(stats)
\par \hich\af4\dbch\af31505\loch\f4     rownames(inputdata) <- inputdata$BENE_ID
\par \hich\af4\dbch\af31505\loch\f4     test <- multinom(trtreg ~ year_diag + SEX_IDENT_CD + race_4cat + LIS_status_2cat + metro +  med_cats + pov_cat + geo + 
\par \hich\af4\dbch\af31505\loch\f4                                age + frail_score + nci_index + spec_2cat + QUARTILE_pnpi + npigndr + npi_cats, data = inputdata)    
\par \hich\af4\dbch\af31505\loch\f4     inputdata$regpredprob <- predict(test, newdata = inputdata, "probs")
\par \hich\af4\dbch\af31505\loch\f4     #print(head(inputdata$regpredprob ))
\par \hich\af4\dbch\af31505\loch\f4     coeff_out <-data.frame(inputdata$regpredprob);
\par \hich\af4\dbch\af31505\loch\f4     #print(head(coeff_out))
\par \hich\af4\dbch\af31505\loch\f4     outputdata <-\hich\af4\dbch\af31505\loch\f4  cbind(row.names(coeff_out),coeff_out);'
\par \hich\af4\dbch\af31505\loch\f4     , @input_data_1 = N'select * from Medicare.dbo.IN_aim1_modeldt_colon1_sm'
\par \hich\af4\dbch\af31505\loch\f4     , @input_data_1_name = N'inputdata'
\par \hich\af4\dbch\af31505\loch\f4     , @output_data_1_name = N'outputdata'
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 **************** get data for stage 2 model ******************;
\par \hich\af4\dbch\af31505\loch\f4     Drop table Medicare.dbo.IN_aim1_model_colon1_s2 
\par \hich\af4\dbch\af31505\loch\f4     Create table Medicare.dbo.IN_aim1_model_colon1_s2 (
\par \hich\af4\dbch\af31505\loch\f4             BENE_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL,trtreg int,cancer_scen varchar(200),
\par \hich\af4\dbch\af31505\loch\f4 total_physician_margin_hm\hich\af4\dbch\af31505\loch\f4  float,  total_physician_margin_hm_100d float, 
\par \hich\af4\dbch\af31505\loch\f4 total_physician_margin_lm float,  total_physician_margin_lm_100d float,
\par \hich\af4\dbch\af31505\loch\f4 guideline_dt date null, guideline_dt2 date null, regimen_type int, preferred int,   
\par \hich\af4\dbch\af31505\loch\f4 ESQC int, wtd_esqc1 float, wtd_esqc2 float, wtd_esqc3 float, wtd_esqc4 float,   
\par \hich\af4\dbch\af31505\loch\f4 rank int,   total_trt int,   fr_rank float, fr_rank_revrs float, 
\par \hich\af4\dbch\af31505\loch\f4 --trtgiven 
\par \hich\af4\dbch\af31505\loch\f4 choice bit,trtinit_dt date null,  regprob float, st_wts float, wins_st_wts float--, quar_prob int
\par \hich\af4\dbch\af31505\loch\f4 );
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX pchars ON IN_aim1_model_colon1_s2;
\par 
\par \hich\af4\dbch\af31505\loch\f4 --select distinct trtreg, count(distinct bene_ID) as benes from IN_aim1_modeldt_colon1_sm group by trtreg order by trtreg
\par \hich\af4\dbch\af31505\loch\f4 with mrgd as (select distinct a.*, 
\par \hich\af4\dbch\af31505\loch\f4 [19050],    [19051],    [19053],    [19054],    [19055],    [19056],    [19057],    [19058],    
\par \hich\af4\dbch\af31505\loch\f4 [19063],    [19064],    [19065] from
\par \hich\af4\dbch\af31505\loch\f4 IN_aim1_modeldt_colon1_sm a left join IN_aim\hich\af4\dbch\af31505\loch\f4 1_modeldt_colon1_sm_4s2 b on a.bene_ID = b.BENE_ID)
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,regspec as (
\par \hich\af4\dbch\af31505\loch\f4 select distinct bene_ID, trtreg, [19050] as regprob, 19050 as reg from mrgd union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [19051] as regprob, 19051 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [19053] as regprob, 19053 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [19054] as regprob, 19054 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [19055] as regprob, 19055 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, t\hich\af4\dbch\af31505\loch\f4 rtreg, [19056] as regprob, 19056 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [19057] as regprob, 19057 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [19058] as regprob, 19058 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [19063] as regprob, 19063 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [19064] as regprob, 19064 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [19065] as regprob, 19065 as reg from mrgd))   
\par 
\par \hich\af4\dbch\af31505\loch\f4 , regsspec_f as (select distinct bene_ID, reg, regprob from regspec) --where trtreg = reg)
\par \hich\af4\dbch\af31505\loch\f4 --select top 50 * from regsspec_f order by bene_id
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,colon1 as (select distinct BENE_ID, trtreg, cancer_scen, total_physician_margin_hm, (total_physician_margin_hm/100) as total_physician_margin_hm_100d , 
\par \hich\af4\dbch\af31505\loch\f4     total_physician_margin_lm, (total_physician_margin_lm/100) as total_physician_margin_lm_100d , guideline_dt, guideline_dt2, regimen_type, preferred, ESQC, wtd_esqc1, wtd_esqc2, wtd_esqc3, wtd_esqc4,   
\par \hich\af4\dbch\af31505\loch\f4     rank,\hich\af4\dbch\af31505\loch\f4  total_trt, fr_rank, fr_rank_revrs, choice,trtinit_dt from 
\par \hich\af4\dbch\af31505\loch\f4 IN_aim1_modeldt where cancer_scen = 'colon1' ) 
\par 
\par \hich\af4\dbch\af31505\loch\f4 , colon1_f as (select distinct a.*, b.regprob from 
\par \hich\af4\dbch\af31505\loch\f4 colon1 a inner join regsspec_f b on a.bene_ID = b.bene_ID and a.trtreg = b.reg) 
\par 
\par \hich\af4\dbch\af31505\loch\f4 , colon1_f2 as (select distinct *, 
\par \hich\af4\dbch\af31505\loch\f4 (case when trtreg = 19050  then (0.281 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 19051  then (0.38 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 19053  then (0.023 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 19054  then (0.033 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 19055  then (0.024 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg =\hich\af4\dbch\af31505\loch\f4  19056  then (0.038 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 19057  then (0.028 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 19058  then (0.056 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 19063  then (0.022 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 19064  then (0.094 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 19065  then (0.02 /regprob) end) as st_wts
\par \hich\af4\dbch\af31505\loch\f4 from colon1_f)
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,prcnls as (SELECT trtreg--trtreg, st_wts, PERCENT_RANK() OVER(PARTITION BY trtreg ORDER BY st_wts) AS Pctst_wts,
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.05) WITHIN GROUP (ORDER BY st_wts) OVER (PARTITION BY trtreg) as p5
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.94) WITHIN GROUP (ORDER BY st_wts) OVER (PARTITION BY trtreg) as p94
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.95) WITHIN GROUP (ORDER BY st_wts) OVER (PARTITION BY trtreg) as p95
\par \hich\af4\dbch\af31505\loch\f4   FROM colon1_f2)
\par \hich\af4\dbch\af31505\loch\f4 -- select distinct trtreg, p5, p94, p95 from prcnls 
\par \hich\af4\dbch\af31505\loch\f4 ,colon1_f3 as (select distinct a.*, b.p5, b.p95 from
\par \hich\af4\dbch\af31505\loch\f4               colon1_f2 a left join prcnls b on a.trtreg = b.trtreg)
\par \hich\af4\dbch\af31505\loch\f4 -- select top 50 * f\hich\af4\dbch\af31505\loch\f4 rom colon1_f3 order by bene_ID
\par \hich\af4\dbch\af31505\loch\f4 ,colon1_f4 as (select *, (case when st_wts >= p95 then p95
\par \hich\af4\dbch\af31505\loch\f4                             when st_wts <= p5  then p5
\par \hich\af4\dbch\af31505\loch\f4                             else st_wts end) as wins_st_wts from colon1_f3)
\par \hich\af4\dbch\af31505\loch\f4 --select count(*) from colon1_f4
\par \hich\af4\dbch\af31505\loch\f4 insert into IN_aim1_model_colon1_s2
\par \hich\af4\dbch\af31505\loch\f4 select top 15147 BENE_ID, trtreg, cancer_scen, total_physician_margin_hm, total_physician_margin_hm_100d , 
\par \hich\af4\dbch\af31505\loch\f4     total_physician_margin_lm, total_physician_margin_lm_100d , guideline_dt, guideline_dt2, regimen_type, preferr\hich\af4\dbch\af31505\loch\f4 ed, ESQC, wtd_esqc1, wtd_esqc2, wtd_esqc3, wtd_esqc4,   
\par \hich\af4\dbch\af31505\loch\f4     rank, total_trt, fr_rank, fr_rank_revrs, choice,trtinit_dt, regprob, st_wts, wins_st_wts 
\par \hich\af4\dbch\af31505\loch\f4     from colon1_f4 order by BENE_ID
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 *****************************************************************;
\par \hich\af4\dbch\af31505\loch\f4 *************************  S2 model *****************************;
\par \hich\af4\dbch\af31505\loch\f4 *****************************************************************;
\par 
\par \hich\af4\dbch\af31505\loch\f4 EXEC sp_execute_external_script
\par \hich\af4\dbch\af31505\loch\f4 @language =N'R',
\par \hich\af4\dbch\af31505\loch\f4 @script=N'
\par \hich\af4\dbch\af31505\loch\f4     library(mlogit)
\par \hich\af4\dbch\af31505\loch\f4     library(dplyr)
\par \hich\af4\dbch\af31505\loch\f4     library(Formula)
\par \hich\af4\dbch\af31505\loch\f4     TM <- dfidx(inputdata, idx=c("BENE_ID","trtreg"), alt.var = "trtreg", pkg = "mlogit")
\par \hich\af4\dbch\af31505\loch\f4     m1 <- mlogit(choice ~ total_physician_margin_hm_100d + fr_rank_revrs| 1 , weights = wins_st_wts, TM)
\par \hich\af4\dbch\af31505\loch\f4     print( summary(m1)) 
\par \hich\af4\dbch\af31505\loch\f4     print(confint(m1));'
\par \hich\af4\dbch\af31505\loch\f4         , @input_data_1 = N'select * from Medicare.dbo.IN_aim1_model_colon1_s2'
\par \hich\af4\dbch\af31505\loch\f4         , @input_data_1_name = N'inputdata';
\par 
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 *******************************;
\par \hich\af4\dbch\af31505\loch\f4 *************panc1 ***********;
\par \hich\af4\dbch\af31505\loch\f4 *******************************;
\par 
\par \hich\af4\dbch\af31505\loch\f4 ********* get table\hich\af4\dbch\af31505\loch\f4  for stage1 - can call disease risk group modeling;
\par \hich\af4\dbch\af31505\loch\f4 drop table IN_aim1_modeldt_panc1_sm
\par \hich\af4\dbch\af31505\loch\f4 Create table Medicare.dbo.IN_aim1_modeldt_panc1_sm (
\par \hich\af4\dbch\af31505\loch\f4             BENE_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL, year_diag varchar(4), geo varchar(10), metro varchar(1), 
\par \hich\af4\dbch\af31505\loch\f4             trtreg int, guideline_dt date, choice bit,  total_physician_margin_hm int, nci_index float, frail_score float, 
\par \hich\af4\dbch\af31505\loch\f4             age int,  BENE_RACE_CD int, --RTI_RACE_CD int, 
\par \hich\af4\dbch\af31505\loch\f4             race_4cat varchar(15),  SEX_IDENT_CD varch\hich\af4\dbch\af31505\loch\f4 ar(1), LIS_status varchar(25), med_cats varchar(16), pov_cat varchar(30),
\par \hich\af4\dbch\af31505\loch\f4             spec varchar (200), QUARTILE_pnpi varchar(1), npigndr varchar (1), npigrd_yr int, npi_cats varchar(14),
\par \hich\af4\dbch\af31505\loch\f4             spec_2cat varchar (200), LIS_status_2cat varchar(25), SNo int,
\par 
\par \hich\af4\dbch\af31505\loch\f4 );
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX pcharsml ON IN_aim1_modeldt_panc1_sm;
\par 
\par \hich\af4\dbch\af31505\loch\f4 with reg_benes as (select distinct trtreg, count (distinct bene_ID) as benes from IN_aim1_modeldt 
\par \hich\af4\dbch\af31505\loch\f4                    where cancer_scen = 'panc1' and choice = 1 group by trtreg)
\par \hich\af4\dbch\af31505\loch\f4     ,foreligreg as (select distinct a.*, b.benes from
\par \hich\af4\dbch\af31505\loch\f4        \hich\af4\dbch\af31505\loch\f4             IN_aim1_modeldt a inner join reg_benes b on a.trtreg = b.trtreg where a.cancer_scen = 'panc1')
\par \hich\af4\dbch\af31505\loch\f4     ,elig_reg as (select * from foreligreg where benes >20)
\par \hich\af4\dbch\af31505\loch\f4     ,fl as (select distinct bene_ID, count(distinct choice) as fl from elig_reg group by bene_ID)
\par \hich\af4\dbch\af31505\loch\f4     ,foreligbene as (select distinct a.*, b.fl from
\par \hich\af4\dbch\af31505\loch\f4                       elig_reg a left join fl b on a.BENE_ID = b.bene_ID)               
\par \hich\af4\dbch\af31505\loch\f4 --select count(*), count(distinct bene_ID) as benes from foreligbene where fl =2
\par \hich\af4\dbch\af31505\loch\f4     insert into IN_aim1_m\hich\af4\dbch\af31505\loch\f4 odeldt_panc1_sm --IN_aim1 as (
\par \hich\af4\dbch\af31505\loch\f4         select BENE_ID, year_diag, geo, metro, trtreg, guideline_dt, choice, total_physician_margin_hm, 
\par \hich\af4\dbch\af31505\loch\f4         nci_index, frail_score, age, bene_race_cd, --RTI_RACE_CD, 
\par \hich\af4\dbch\af31505\loch\f4         race_4cat, SEX_IDENT_CD, LIS_status, med_cats, pov_cat, spec, QUARTILE_pnpi, npigndr, npigrd_yr, npi_cats,
\par \hich\af4\dbch\af31505\loch\f4         spec_2cat, LIS_status_2cat,
\par \hich\af4\dbch\af31505\loch\f4         ROW_NUMBER() OVER(ORDER BY (bene_ID)) AS SNo from foreligbene where fl = 2 and choice = 1
\par \hich\af4\dbch\af31505\loch\f4 --select count(distinct bene_ID), count(distinct trtreg) fro\hich\af4\dbch\af31505\loch\f4 m IN_aim1_modeldt_panc1_sm
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 --select distinct trtreg from IN_aim1_modeldt_panc1_sm order by trtreg
\par \hich\af4\dbch\af31505\loch\f4 drop table IN_aim1_modeldt_panc1_sm_4s2
\par \hich\af4\dbch\af31505\loch\f4 Create table Medicare.dbo.IN_aim1_modeldt_panc1_sm_4s2 (
\par \hich\af4\dbch\af31505\loch\f4             BENE_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL,
\par \hich\af4\dbch\af31505\loch\f4 [30023] float,  [30025] float,  [30028] float,  [30031] float);
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX pcharsml ON IN_aim1_modeldt_panc1_sm_4s2;
\par 
\par \hich\af4\dbch\af31505\loch\f4 insert into IN_aim1_modeldt_panc1_sm_4s2
\par \hich\af4\dbch\af31505\loch\f4 --select distinct bene_ID from IN_aim1_modeldt_panc1_sm
\par \hich\af4\dbch\af31505\loch\f4 EXEC sp_execute_external_script
\par \hich\af4\dbch\af31505\loch\f4 @language =N'R',
\par \hich\af4\dbch\af31505\loch\f4 @script=N'
\par \hich\af4\dbch\af31505\loch\f4     library(nnet)
\par \hich\af4\dbch\af31505\loch\f4     library(stats)
\par \hich\af4\dbch\af31505\loch\f4     rownames(inputdata) <- inputdata$BENE_ID
\par \hich\af4\dbch\af31505\loch\f4     test <- multinom(trtreg ~ year_diag + SEX_IDENT_\hich\af4\dbch\af31505\loch\f4 CD + race_4cat + LIS_status_2cat + metro +  med_cats + pov_cat + geo + 
\par \hich\af4\dbch\af31505\loch\f4                                age + frail_score + nci_index + spec_2cat + QUARTILE_pnpi + npigndr + npi_cats, data = inputdata)    
\par \hich\af4\dbch\af31505\loch\f4     inputdata$regpredprob <- predict(test, newdata = inputdata, "probs")
\par \hich\af4\dbch\af31505\loch\f4     #print(head(inputdata$regpredprob ))
\par \hich\af4\dbch\af31505\loch\f4     coeff_out <-data.frame(inputdata$regpredprob);
\par \hich\af4\dbch\af31505\loch\f4     #print(head(coeff_out))
\par \hich\af4\dbch\af31505\loch\f4     outputdata <- cbind(row.names(coeff_out),coeff_out);'
\par \hich\af4\dbch\af31505\loch\f4     , @input_data_1 = N'select * from Medicare.dbo.IN_ai\hich\af4\dbch\af31505\loch\f4 m1_modeldt_panc1_sm'
\par \hich\af4\dbch\af31505\loch\f4     , @input_data_1_name = N'inputdata'
\par \hich\af4\dbch\af31505\loch\f4     , @output_data_1_name = N'outputdata'
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 **************** get data for stage 2 model ******************;
\par \hich\af4\dbch\af31505\loch\f4     Drop table Medicare.dbo.IN_aim1_model_panc1_s2 
\par \hich\af4\dbch\af31505\loch\f4     Create table Medicare.dbo.IN_aim1_model_panc1_s2 (
\par \hich\af4\dbch\af31505\loch\f4             BENE_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL,trtreg int,cancer_scen varchar(200),
\par \hich\af4\dbch\af31505\loch\f4 total_physician_margin_hm float,  total_physician_margin_hm_100d float, 
\par \hich\af4\dbch\af31505\loch\f4 total_physician_margin_lm float,  total_physician_margin_lm_100d float,
\par \hich\af4\dbch\af31505\loch\f4 guideline_dt date null, guideline_dt2 date null, regimen_type int, preferred int,   
\par \hich\af4\dbch\af31505\loch\f4 ESQC int, wtd_esqc1 float, wtd_esqc2 float, wtd_esqc3 float, wtd\hich\af4\dbch\af31505\loch\f4 _esqc4 float,   
\par \hich\af4\dbch\af31505\loch\f4 rank int,   total_trt int,   fr_rank float, fr_rank_revrs float, 
\par \hich\af4\dbch\af31505\loch\f4 --trtgiven 
\par \hich\af4\dbch\af31505\loch\f4 choice bit,trtinit_dt date null,  regprob float, st_wts float, wins_st_wts float--, quar_prob int
\par \hich\af4\dbch\af31505\loch\f4 );
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX pchars ON IN_aim1_model_panc1_s2;
\par 
\par \hich\af4\dbch\af31505\loch\f4 --select distinct trtreg, count(distinct bene_ID) as benes from IN_aim1_modeldt_panc1_sm group by trtreg order by trtreg
\par \hich\af4\dbch\af31505\loch\f4 with mrgd as (select distinct a.*, 
\par \hich\af4\dbch\af31505\loch\f4 [30023],    [30025],    [30028],    [30031] from
\par \hich\af4\dbch\af31505\loch\f4 IN_aim1_modeldt_panc1_sm a left join\hich\af4\dbch\af31505\loch\f4  IN_aim1_modeldt_panc1_sm_4s2 b on a.bene_ID = b.BENE_ID)
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,regspec as (
\par \hich\af4\dbch\af31505\loch\f4 select distinct bene_ID, trtreg, [30023] as regprob, 30023 as reg from mrgd union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [30025] as regprob, 30025 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [30028] as regprob, 30028 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [30031] as regprob, 30031 as reg from mrgd))   
\par 
\par \hich\af4\dbch\af31505\loch\f4 , regsspec_f as (select distinct bene_ID, reg, regprob from regspec) --where trtreg = reg)
\par \hich\af4\dbch\af31505\loch\f4 --select top 50 * from regsspec_f order by bene_id
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,panc1 as (select distinct BENE_ID, trtreg, cancer_scen, total_physician_margin_hm, (total_physician_margin_hm/100) as total_physician_margin_hm_100d , 
\par \hich\af4\dbch\af31505\loch\f4     total_physician_margin_lm, (total_physician_margin_lm/100) as total_physician_margin_lm_100d , guideline_dt, guideline_dt2, regimen_type, preferred, ESQC, wtd_esqc1, wtd_esqc2, wtd_esqc3, wtd_esqc4,   
\par \hich\af4\dbch\af31505\loch\f4     rank, \hich\af4\dbch\af31505\loch\f4 total_trt, fr_rank, fr_rank_revrs, choice,trtinit_dt from 
\par \hich\af4\dbch\af31505\loch\f4 IN_aim1_modeldt where cancer_scen = 'panc1' ) 
\par 
\par \hich\af4\dbch\af31505\loch\f4 , panc1_f as (select distinct a.*, b.regprob from 
\par \hich\af4\dbch\af31505\loch\f4 panc1 a inner join regsspec_f b on a.bene_ID = b.bene_ID and a.trtreg = b.reg) 
\par 
\par \hich\af4\dbch\af31505\loch\f4 , panc1_f2 as (select distinct *, 
\par \hich\af4\dbch\af31505\loch\f4 (case when trtreg = 30023  then (0.246 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 30025  then (0.565 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 30028  then (0.142 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 30031  then (0.047 /regprob) end) as st_wts
\par \hich\af4\dbch\af31505\loch\f4 from panc1_f)
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,prcnls as (SELECT trtreg--trt\hich\af4\dbch\af31505\loch\f4 reg, st_wts, PERCENT_RANK() OVER(PARTITION BY trtreg ORDER BY st_wts) AS Pctst_wts,
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.05) WITHIN GROUP (ORDER BY st_wts) OVER (PARTITION BY trtreg) as p5
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.94) WITHIN GROUP (ORDER BY st_wts) OVER (PARTITION BY trtreg) as p94
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.95) WITHIN GROUP (ORDER BY st_wts) OVER (PARTITION BY trtreg) as p95
\par \hich\af4\dbch\af31505\loch\f4   FROM panc1_f2)
\par \hich\af4\dbch\af31505\loch\f4 -- select distinct trtreg, p5, p94, p95 from prcnls 
\par \hich\af4\dbch\af31505\loch\f4 ,panc1_f3 as (select distinct a.*, b.p5, b.p95 from
\par \hich\af4\dbch\af31505\loch\f4               panc1_f2 a left join prcnls b on a.trtreg = b.trtreg)
\par \hich\af4\dbch\af31505\loch\f4 -- select top 50 * from panc1_f3 order by bene_ID
\par \hich\af4\dbch\af31505\loch\f4 ,panc1_f4 as (select *, (case when st_wts >= p95 then p95
\par \hich\af4\dbch\af31505\loch\f4                             when st_wts <= p5  then p5
\par \hich\af4\dbch\af31505\loch\f4                             else st_wts end) as wins_st_wts from panc1_f3)
\par \hich\af4\dbch\af31505\loch\f4 --select count(*) from panc1_f4
\par \hich\af4\dbch\af31505\loch\f4 insert into IN_aim1_model_panc1_s2
\par \hich\af4\dbch\af31505\loch\f4 select top 5960 BENE_ID, trtreg, cancer_scen, total_physician_margin_hm, total_physicia\hich\af4\dbch\af31505\loch\f4 n_margin_hm_100d , 
\par \hich\af4\dbch\af31505\loch\f4     total_physician_margin_lm, total_physician_margin_lm_100d , guideline_dt, guideline_dt2, regimen_type, preferred, ESQC, wtd_esqc1, wtd_esqc2, wtd_esqc3, wtd_esqc4,   
\par \hich\af4\dbch\af31505\loch\f4     rank, total_trt, fr_rank, fr_rank_revrs, choice,trtinit_dt, regprob, st_wts, wins_st_wts 
\par \hich\af4\dbch\af31505\loch\f4     from panc1_f4 order by BENE_ID
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 *****************************************************************;
\par \hich\af4\dbch\af31505\loch\f4 *************************  S2 model *****************************;
\par \hich\af4\dbch\af31505\loch\f4 ********************************************************\hich\af4\dbch\af31505\loch\f4 *********;
\par 
\par \hich\af4\dbch\af31505\loch\f4 EXEC sp_execute_external_script
\par \hich\af4\dbch\af31505\loch\f4 @language =N'R',
\par \hich\af4\dbch\af31505\loch\f4 @script=N'
\par \hich\af4\dbch\af31505\loch\f4     library(mlogit)
\par \hich\af4\dbch\af31505\loch\f4     library(dplyr)
\par \hich\af4\dbch\af31505\loch\f4     library(Formula)
\par \hich\af4\dbch\af31505\loch\f4     TM <- dfidx(inputdata, idx=c("BENE_ID","trtreg"), alt.var = "trtreg", pkg = "mlogit")
\par \hich\af4\dbch\af31505\loch\f4     m1 <- mlogit(choice ~ total_physician_margin_hm_100d + fr_rank_revrs| 1 , weights = wins_st_wts, TM)
\par \hich\af4\dbch\af31505\loch\f4     print( summary(m1)) 
\par \hich\af4\dbch\af31505\loch\f4     print(confint(m1));'
\par \hich\af4\dbch\af31505\loch\f4         , @input_data_1 = N'select * from Medicare.dbo.IN_aim1_model_panc1_s2'
\par \hich\af4\dbch\af31505\loch\f4         , @input_data_1_name = N'inputdata';
\par 
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 ******* model w/o intercept - FINAL;
\par \hich\af4\dbch\af31505\loch\f4 EXEC sp_execute_external_script
\par \hich\af4\dbch\af31505\loch\f4 @language =N'R',
\par \hich\af4\dbch\af31505\loch\f4 @script=N'
\par \hich\af4\dbch\af31505\loch\f4     library(mlogit)
\par \hich\af4\dbch\af31505\loch\f4     library(dplyr)
\par \hich\af4\dbch\af31505\loch\f4     library(Formula)
\par \hich\af4\dbch\af31505\loch\f4     TM <- dfidx(inputdata, idx=c("BENE_ID","trtreg"), alt.var = "trtreg",\hich\af4\dbch\af31505\loch\f4  pkg = "mlogit")
\par \hich\af4\dbch\af31505\loch\f4     m1 <- mlogit(choice ~ total_physician_margin_hm_100d + fr_rank_revrs| 0 , weights = wins_st_wts, TM)
\par \hich\af4\dbch\af31505\loch\f4     print( summary(m1)) 
\par \hich\af4\dbch\af31505\loch\f4     print(confint(m1));'
\par \hich\af4\dbch\af31505\loch\f4         , @input_data_1 = N'select * from Medicare.dbo.IN_aim1_model_panc1_s2'
\par \hich\af4\dbch\af31505\loch\f4         , @input_data_1_name = N'inputdata';
\par 
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 *******************************;
\par \hich\af4\dbch\af31505\loch\f4 *************ocavp2 ***********;
\par \hich\af4\dbch\af31505\loch\f4 *******************************;
\par 
\par \hich\af4\dbch\af31505\loch\f4 ********* get t\hich\af4\dbch\af31505\loch\f4 able for stage1 - can call disease risk group modeling;
\par \hich\af4\dbch\af31505\loch\f4 drop table IN_aim1_modeldt_ocavp2_sm
\par \hich\af4\dbch\af31505\loch\f4 Create table Medicare.dbo.IN_aim1_modeldt_ocavp2_sm (
\par \hich\af4\dbch\af31505\loch\f4             BENE_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL, year_diag varchar(4), geo varchar(10), metro varchar(1), 
\par \hich\af4\dbch\af31505\loch\f4             trtreg int, guideline_dt date, choice bit,  total_physician_margin_hm int, nci_index float, frail_score float, 
\par \hich\af4\dbch\af31505\loch\f4             age int,  BENE_RACE_CD int, --RTI_RACE_CD int, 
\par \hich\af4\dbch\af31505\loch\f4             race_4cat varchar(15),  SEX_IDENT_CD\hich\af4\dbch\af31505\loch\f4  varchar(1), LIS_status varchar(25), med_cats varchar(16), pov_cat varchar(30),
\par \hich\af4\dbch\af31505\loch\f4             spec varchar (200), QUARTILE_pnpi varchar(1), npigndr varchar (1), npigrd_yr int, npi_cats varchar(14),
\par \hich\af4\dbch\af31505\loch\f4             spec_2cat varchar (200), LIS_status_2cat varchar(25), SNo int,
\par 
\par \hich\af4\dbch\af31505\loch\f4 );
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX pcharsml ON IN_aim1_modeldt_ocavp2_sm;
\par 
\par \hich\af4\dbch\af31505\loch\f4 with reg_benes as (select distinct trtreg, count (distinct bene_ID) as benes from IN_aim1_modeldt 
\par \hich\af4\dbch\af31505\loch\f4                    where cancer_scen = 'ocavp2' and choice \hich\af4\dbch\af31505\loch\f4 = 1 group by trtreg)
\par \hich\af4\dbch\af31505\loch\f4     ,foreligreg as (select distinct a.*, b.benes from
\par \hich\af4\dbch\af31505\loch\f4                    IN_aim1_modeldt a inner join reg_benes b on a.trtreg = b.trtreg where a.cancer_scen = 'ocavp2')
\par \hich\af4\dbch\af31505\loch\f4     ,elig_reg as (select * from foreligreg where benes >20)
\par \hich\af4\dbch\af31505\loch\f4     ,fl as (select distinct bene_ID, count(distinct choice) as fl from elig_reg group by bene_ID)
\par \hich\af4\dbch\af31505\loch\f4     ,foreligbene as (select distinct a.*, b.fl from
\par \hich\af4\dbch\af31505\loch\f4                       elig_reg a left join fl b on a.BENE_ID = b.bene_ID)               
\par \hich\af4\dbch\af31505\loch\f4 --select count(*), coun\hich\af4\dbch\af31505\loch\f4 t(distinct bene_ID) as benes from foreligbene where fl =2
\par \hich\af4\dbch\af31505\loch\f4     insert into IN_aim1_modeldt_ocavp2_sm --IN_aim1 as (
\par \hich\af4\dbch\af31505\loch\f4         select BENE_ID, year_diag, geo, metro, trtreg, guideline_dt, choice, total_physician_margin_hm, 
\par \hich\af4\dbch\af31505\loch\f4         nci_index, frail_score, age, bene_race_cd, --RTI_RACE_CD, 
\par \hich\af4\dbch\af31505\loch\f4         race_4cat, SEX_IDENT_CD, LIS_status, med_cats, pov_cat, spec, QUARTILE_pnpi, npigndr, npigrd_yr, npi_cats,
\par \hich\af4\dbch\af31505\loch\f4         spec_2cat, LIS_status_2cat,
\par \hich\af4\dbch\af31505\loch\f4         ROW_NUMBER() OVER(ORDER BY (bene_ID)) AS SNo from foreligbene where fl = 2 and choice = 1
\par \hich\af4\dbch\af31505\loch\f4 --select count(distinct bene_ID), count(distinct trtreg) from IN_aim1_modeldt_ocavp2_sm
\par 
\par 
\par -\hich\af4\dbch\af31505\loch\f4 -select distinct trtreg from IN_aim1_modeldt_ocavp2_sm order by trtreg
\par \hich\af4\dbch\af31505\loch\f4 drop table IN_aim1_modeldt_ocavp2_sm_4s2
\par \hich\af4\dbch\af31505\loch\f4 Create table Medicare.dbo.IN_aim1_modeldt_ocavp2_sm_4s2 (
\par \hich\af4\dbch\af31505\loch\f4             BENE_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL,
\par \hich\af4\dbch\af31505\loch\f4 [23003] float,  [23004] float,  [23005] float,  [23009] float,  [23010] float);
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX pcharsml ON IN_aim1_modeldt_ocavp2_sm_4s2;
\par 
\par \hich\af4\dbch\af31505\loch\f4 insert into IN_aim1_modeldt_ocavp2_sm_4s2
\par \hich\af4\dbch\af31505\loch\f4 --select distinct bene_ID from IN_aim1_modeldt_ocavp2_sm
\par \hich\af4\dbch\af31505\loch\f4 EXEC \hich\af4\dbch\af31505\loch\f4 sp_execute_external_script
\par \hich\af4\dbch\af31505\loch\f4 @language =N'R',
\par \hich\af4\dbch\af31505\loch\f4 @script=N'
\par \hich\af4\dbch\af31505\loch\f4     library(nnet)
\par \hich\af4\dbch\af31505\loch\f4     library(stats)
\par \hich\af4\dbch\af31505\loch\f4     rownames(inputdata) <- inputdata$BENE_ID
\par \hich\af4\dbch\af31505\loch\f4     test <- multinom(trtreg ~ year_diag + SEX_IDENT_CD + race_4cat + LIS_status_2cat + metro +  med_cats + pov_cat + geo + 
\par \hich\af4\dbch\af31505\loch\f4                                age + frail_score + nci_index + spec_2cat + QUARTILE_pnpi + npigndr + npi_cats, data = inputdata)    
\par \hich\af4\dbch\af31505\loch\f4     inputdata$regpredprob <- predict(test, newdata = inputdata, "probs")
\par \hich\af4\dbch\af31505\loch\f4     #print(head(inputdata$regpredprob ))
\par \hich\af4\dbch\af31505\loch\f4     coeff_out <-data.frame(inputdata$regpredprob);
\par \hich\af4\dbch\af31505\loch\f4     #print(head(coeff_out))
\par \hich\af4\dbch\af31505\loch\f4     outputdata <- cbind(row.names(coeff_out),coeff_out);'
\par \hich\af4\dbch\af31505\loch\f4     , @input_data_1 = N'select * from Medicare.dbo.IN_aim1_modeldt_ocavp2_sm'
\par \hich\af4\dbch\af31505\loch\f4     , @input_data_1_name = N'inputdata'
\par \hich\af4\dbch\af31505\loch\f4     , @output_data_1_name = N'outputdata'
\par 
\par \hich\af4\dbch\af31505\loch\f4 --drop table IN_aim1_modeldt_ocavp2_sm_4s2;
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 **************** get data for stage 2 model **********\hich\af4\dbch\af31505\loch\f4 ********;
\par \hich\af4\dbch\af31505\loch\f4     Drop table Medicare.dbo.IN_aim1_model_ocavp2_s2 
\par \hich\af4\dbch\af31505\loch\f4     Create table Medicare.dbo.IN_aim1_model_ocavp2_s2 (
\par \hich\af4\dbch\af31505\loch\f4             BENE_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL,trtreg int,cancer_scen varchar(200),
\par \hich\af4\dbch\af31505\loch\f4 total_physician_margin_hm float,  total_physician_margin_hm_100d float, 
\par \hich\af4\dbch\af31505\loch\f4 total_physician_margin_lm float,  total_physician_margin_lm_100d float,
\par \hich\af4\dbch\af31505\loch\f4 guideline_dt date null, guideline_dt2 date null, regimen_type int, preferred int,   
\par \hich\af4\dbch\af31505\loch\f4 ESQC int, wtd_esqc1 float, wtd_esqc2 float, wtd_esqc\hich\af4\dbch\af31505\loch\f4 3 float, wtd_esqc4 float,   
\par \hich\af4\dbch\af31505\loch\f4 rank int,   total_trt int,   fr_rank float, fr_rank_revrs float, 
\par \hich\af4\dbch\af31505\loch\f4 --trtgiven 
\par \hich\af4\dbch\af31505\loch\f4 choice bit,trtinit_dt date null,  regprob float, st_wts float, wins_st_wts float--, quar_prob int
\par \hich\af4\dbch\af31505\loch\f4 );
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX pchars ON IN_aim1_model_ocavp2_s2;
\par 
\par \hich\af4\dbch\af31505\loch\f4 --select distinct trtreg, count(distinct bene_ID) as benes from IN_aim1_modeldt_ocavp2_sm group by trtreg order by trtreg
\par \hich\af4\dbch\af31505\loch\f4 with mrgd as (select distinct a.*, 
\par \hich\af4\dbch\af31505\loch\f4 [23003],    [23004],    [23005],    [23009],    [23010] from
\par \hich\af4\dbch\af31505\loch\f4 IN_aim1_modeldt_ocavp2_sm a left join IN_aim1_modeldt_ocavp2_sm_4s2 b on a.bene_ID = b.BENE_ID)
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,regspec as (
\par \hich\af4\dbch\af31505\loch\f4 select distinct bene_ID, trtreg, [23003] as regprob, 23003 as reg from mrgd union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID,\hich\af4\dbch\af31505\loch\f4  trtreg, [23004] as regprob, 23004 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [23005] as regprob, 23005 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [23009] as regprob, 23009 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [23010] as regprob, 23010 as reg from mrgd))   
\par 
\par \hich\af4\dbch\af31505\loch\f4 , regsspec_f as (select distinct bene_ID, reg, regprob from regspec) --where trtreg = reg)
\par \hich\af4\dbch\af31505\loch\f4 --select top 50 * from regsspec_f order by bene_id
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,ocavp2 as (select distinct BENE_ID, trtreg, cancer_scen, t\hich\af4\dbch\af31505\loch\f4 otal_physician_margin_hm, (total_physician_margin_hm/100) as total_physician_margin_hm_100d , 
\par \hich\af4\dbch\af31505\loch\f4     total_physician_margin_lm, (total_physician_margin_lm/100) as total_physician_margin_lm_100d , guideline_dt, guideline_dt2, regimen_type, preferred, ESQC, wtd_esqc1, wtd_esqc2, wtd_esqc3, wtd_esqc4,   
\par \hich\af4\dbch\af31505\loch\f4     rank, total_trt, fr_rank, fr_rank_revrs, choice,trtinit_dt from 
\par \hich\af4\dbch\af31505\loch\f4 IN_aim1_modeldt where cancer_scen = 'ocavp2' ) 
\par 
\par \hich\af4\dbch\af31505\loch\f4 , ocavp2_f as (select distinct a.*, b.regprob from 
\par \hich\af4\dbch\af31505\loch\f4 ocavp2 a inner join regsspec_f b on a.ben\hich\af4\dbch\af31505\loch\f4 e_ID = b.bene_ID and a.trtreg = b.reg) 
\par 
\par \hich\af4\dbch\af31505\loch\f4 , ocavp2_f2 as (select distinct *, 
\par \hich\af4\dbch\af31505\loch\f4 (case when trtreg = 23003  then (0.094 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 23004  then (0.088 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 23005  then (0.133 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 23009  then (0.186 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 23010  then (0.498 /regprob) end) as st_wts
\par \hich\af4\dbch\af31505\loch\f4 from ocavp2_f)
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,prcnls as (SELECT trtreg--trtreg, st_wts, PERCENT_RANK() OVER(PARTITION BY trtreg ORDER BY st_wts) AS Pctst_wts,
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.05) WITHIN GROUP (ORDER BY st_wts) OVER (PARTITION BY trtreg) as p5
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.94) WITHIN GROUP (ORDER BY st_wts) OVER (PARTITION BY trtreg) as p94
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.95) WITHIN GROUP (ORDER BY st_wts) OVER (PARTITION \hich\af4\dbch\af31505\loch\f4 BY trtreg) as p95
\par \hich\af4\dbch\af31505\loch\f4   FROM ocavp2_f2)
\par \hich\af4\dbch\af31505\loch\f4 -- select distinct trtreg, p5, p94, p95 from prcnls 
\par \hich\af4\dbch\af31505\loch\f4 ,ocavp2_f3 as (select distinct a.*, b.p5, b.p95 from
\par \hich\af4\dbch\af31505\loch\f4               ocavp2_f2 a left join prcnls b on a.trtreg = b.trtreg)
\par \hich\af4\dbch\af31505\loch\f4 -- select top 50 * from ocavp2_f3 order by bene_ID
\par \hich\af4\dbch\af31505\loch\f4 ,ocavp2_f4 as (select *, (case when st_wts >= p95 then p95
\par \hich\af4\dbch\af31505\loch\f4                             when st_wts <= p5  then p5
\par \hich\af4\dbch\af31505\loch\f4                             else st_wts end) as wins_st_wts from ocavp2_f3)
\par \hich\af4\dbch\af31505\loch\f4 --select count(*) from ocavp2_f4
\par \hich\af4\dbch\af31505\loch\f4 insert into IN_aim1_model_o\hich\af4\dbch\af31505\loch\f4 cavp2_s2
\par \hich\af4\dbch\af31505\loch\f4 select top 7515 BENE_ID, trtreg, cancer_scen, total_physician_margin_hm, total_physician_margin_hm_100d , 
\par \hich\af4\dbch\af31505\loch\f4     total_physician_margin_lm, total_physician_margin_lm_100d , guideline_dt, guideline_dt2, regimen_type, preferred, ESQC, wtd_esqc1, wtd_esqc2, wtd_esqc3, wtd_esqc4,   
\par \hich\af4\dbch\af31505\loch\f4     rank, total_trt, fr_rank, fr_rank_revrs, choice,trtinit_dt, regprob, st_wts, wins_st_wts 
\par \hich\af4\dbch\af31505\loch\f4     from ocavp2_f4 order by BENE_ID
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 *****************************************************************;
\par \hich\af4\dbch\af31505\loch\f4 *************************  S2 model *****************************;
\par \hich\af4\dbch\af31505\loch\f4 *****************************************************************;
\par 
\par \hich\af4\dbch\af31505\loch\f4 EXEC sp_execute_external_script
\par \hich\af4\dbch\af31505\loch\f4 @language =N'R',
\par \hich\af4\dbch\af31505\loch\f4 @script=N'
\par \hich\af4\dbch\af31505\loch\f4     library(mlogit)
\par \hich\af4\dbch\af31505\loch\f4     library(dplyr)
\par \hich\af4\dbch\af31505\loch\f4     library(Formula)
\par \hich\af4\dbch\af31505\loch\f4     TM <- dfidx(inputdata, idx=c("BENE_ID","trtreg"), alt.var = "trtreg", pkg = "mlogit")
\par \hich\af4\dbch\af31505\loch\f4     m1 <- mlogit(choice ~ total_physician_margin_hm_100d + fr_rank_revrs| 1 , weights = wins_st_wts,\hich\af4\dbch\af31505\loch\f4  TM)
\par \hich\af4\dbch\af31505\loch\f4     print( summary(m1)) 
\par \hich\af4\dbch\af31505\loch\f4     print(confint(m1));'
\par \hich\af4\dbch\af31505\loch\f4         , @input_data_1 = N'select * from Medicare.dbo.IN_aim1_model_ocavp2_s2'
\par \hich\af4\dbch\af31505\loch\f4         , @input_data_1_name = N'inputdata';
\par 
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 *******************************;
\par \hich\af4\dbch\af31505\loch\f4 *************br7 **************;
\par \hich\af4\dbch\af31505\loch\f4 *******************************;
\par 
\par \hich\af4\dbch\af31505\loch\f4 ********* get table for stage1 - can call disease risk group modeling;
\par \hich\af4\dbch\af31505\loch\f4 drop table IN_aim1_modeldt_br7_sm
\par \hich\af4\dbch\af31505\loch\f4 Create table Medicare.dbo.IN_aim1_modeldt_br7_sm (
\par \hich\af4\dbch\af31505\loch\f4             BENE_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL, year_diag varchar(4), geo varchar(10), metro varchar(1), 
\par \hich\af4\dbch\af31505\loch\f4             trtreg int, guideline_dt date, choice bit,  total_physician_margin_hm int, nci_index float, frail_score float, 
\par \hich\af4\dbch\af31505\loch\f4             age int,  BENE_RACE_CD int, --RTI_RACE_CD int, 
\par \hich\af4\dbch\af31505\loch\f4             race_4cat varchar(15),  SEX_IDENT_CD varchar(1), LIS_status varchar(25), med_cats varchar(16), pov_cat varchar(30),
\par \hich\af4\dbch\af31505\loch\f4             spec varchar (200), QUARTILE_pnpi varchar(1), npigndr v\hich\af4\dbch\af31505\loch\f4 archar (1), npigrd_yr int, npi_cats varchar(14),
\par \hich\af4\dbch\af31505\loch\f4             spec_2cat varchar (200), LIS_status_2cat varchar(25), SNo int,
\par 
\par \hich\af4\dbch\af31505\loch\f4 );
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX pcharsml ON IN_aim1_modeldt_br7_sm;
\par 
\par \hich\af4\dbch\af31505\loch\f4 with reg_benes as (select distinct trtreg, count (distinct bene_ID) as benes from IN_aim1_modeldt 
\par \hich\af4\dbch\af31505\loch\f4                    where cancer_scen = 'br7' and choice = 1 group by trtreg)
\par \hich\af4\dbch\af31505\loch\f4     ,foreligreg as (select distinct a.*, b.benes from
\par \hich\af4\dbch\af31505\loch\f4                    IN_aim1_modeldt a inner join reg_benes b on a.trtreg = b.tr\hich\af4\dbch\af31505\loch\f4 treg where a.cancer_scen = 'br7')
\par \hich\af4\dbch\af31505\loch\f4     ,elig_reg as (select * from foreligreg where benes >20)
\par \hich\af4\dbch\af31505\loch\f4     ,fl as (select distinct bene_ID, count(distinct choice) as fl from elig_reg group by bene_ID)
\par \hich\af4\dbch\af31505\loch\f4     ,foreligbene as (select distinct a.*, b.fl from
\par \hich\af4\dbch\af31505\loch\f4                       elig_reg a left join fl b on a.BENE_ID = b.bene_ID)               
\par \hich\af4\dbch\af31505\loch\f4 --select count(*), count(distinct bene_ID) as benes from foreligbene where fl =2
\par \hich\af4\dbch\af31505\loch\f4     insert into IN_aim1_modeldt_br7_sm --IN_aim1 as (
\par \hich\af4\dbch\af31505\loch\f4         select BENE_ID, year_diag, geo, metr\hich\af4\dbch\af31505\loch\f4 o, trtreg, guideline_dt, choice, total_physician_margin_hm, 
\par \hich\af4\dbch\af31505\loch\f4         nci_index, frail_score, age, bene_race_cd, --RTI_RACE_CD, 
\par \hich\af4\dbch\af31505\loch\f4         race_4cat, SEX_IDENT_CD, LIS_status, med_cats, pov_cat, spec, QUARTILE_pnpi, npigndr, npigrd_yr, npi_cats,
\par \hich\af4\dbch\af31505\loch\f4         spec_2cat, LIS_status_2cat,
\par \hich\af4\dbch\af31505\loch\f4         ROW_NUMBER() OVER(ORDER BY (bene_ID)) AS SNo from foreligbene where fl = 2 and choice = 1
\par \hich\af4\dbch\af31505\loch\f4 --select count(distinct bene_ID), count(distinct trtreg) from IN_aim1_modeldt_br7_sm
\par 
\par \hich\af4\dbch\af31505\loch\f4 --select distinct trtreg from IN_aim1_modeldt_br7_sm order by trtreg
\par \hich\af4\dbch\af31505\loch\f4 drop table IN_aim1_modeldt_br7_sm_4s2
\par \hich\af4\dbch\af31505\loch\f4 Create table Medicare.dbo.IN_aim1_modeldt_br7_sm_4s2 (
\par \hich\af4\dbch\af31505\loch\f4             BEN\hich\af4\dbch\af31505\loch\f4 E_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL,
\par \hich\af4\dbch\af31505\loch\f4 [14001] float,  [14002] float,  [14003] float,  [14004] float,  [14005] float,  [14006] float,  [14007] float,  
\par \hich\af4\dbch\af31505\loch\f4 [14010] float,  [14112] float,  [14113] float);
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX pcharsml ON IN_aim1_modeldt_br7_sm_4s2;
\par 
\par \hich\af4\dbch\af31505\loch\f4 insert into IN_aim1_modeldt_br7_sm_4s2
\par \hich\af4\dbch\af31505\loch\f4 --select distinct bene_ID from IN_aim1_modeldt_br7_sm
\par \hich\af4\dbch\af31505\loch\f4 EXEC sp_execute_external_script
\par \hich\af4\dbch\af31505\loch\f4 @language =N'R',
\par \hich\af4\dbch\af31505\loch\f4 @script=N'
\par \hich\af4\dbch\af31505\loch\f4     library(nnet)
\par \hich\af4\dbch\af31505\loch\f4     library(stats)
\par \hich\af4\dbch\af31505\loch\f4     rownames(inputdat\hich\af4\dbch\af31505\loch\f4 a) <- inputdata$BENE_ID
\par \hich\af4\dbch\af31505\loch\f4     test <- multinom(trtreg ~ year_diag + race_4cat + LIS_status_2cat + metro +  med_cats + pov_cat + geo + 
\par \hich\af4\dbch\af31505\loch\f4                                age + frail_score + nci_index + spec_2cat + QUARTILE_pnpi + npigndr + npi_cats, data = inputdata)    
\par \hich\af4\dbch\af31505\loch\f4     inputdata$regpredprob <- predict(test, newdata = inputdata, "probs")
\par \hich\af4\dbch\af31505\loch\f4     #print(head(inputdata$regpredprob ))
\par \hich\af4\dbch\af31505\loch\f4     coeff_out <-data.frame(inputdata$regpredprob);
\par \hich\af4\dbch\af31505\loch\f4     #print(head(coeff_out))
\par \hich\af4\dbch\af31505\loch\f4     outputdata <- cbind(row.names(coeff_out),coeff_out);'
\par \hich\af4\dbch\af31505\loch\f4     , @input_data_1 = N'select * from Medicare.dbo.IN_aim1_modeldt_br7_sm'
\par \hich\af4\dbch\af31505\loch\f4     , @input_data_1_name = N'inputdata'
\par \hich\af4\dbch\af31505\loch\f4     , @output_data_1_name = N'outputdata'
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 **************** get data for stage 2 model ******************;
\par \hich\af4\dbch\af31505\loch\f4     Drop table Medicare.dbo.IN_aim1_model_br7_s2 
\par \hich\af4\dbch\af31505\loch\f4     Create table Medicare.dbo.IN_aim1_model_br7_s2 (
\par \hich\af4\dbch\af31505\loch\f4             BENE_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL,trtreg int,cancer_scen varchar(200),
\par \hich\af4\dbch\af31505\loch\f4 total_physician_m\hich\af4\dbch\af31505\loch\f4 argin_hm float,  total_physician_margin_hm_100d float, 
\par \hich\af4\dbch\af31505\loch\f4 total_physician_margin_lm float,  total_physician_margin_lm_100d float,
\par \hich\af4\dbch\af31505\loch\f4 guideline_dt date null, guideline_dt2 date null, regimen_type int, preferred int,   
\par \hich\af4\dbch\af31505\loch\f4 ESQC int, wtd_esqc1 float, wtd_esqc2 float, wtd_esqc3 float, wtd_esqc4 float,   
\par \hich\af4\dbch\af31505\loch\f4 rank int,   total_trt int,   fr_rank float, fr_rank_revrs float, 
\par \hich\af4\dbch\af31505\loch\f4 --trtgiven 
\par \hich\af4\dbch\af31505\loch\f4 choice bit,trtinit_dt date null,  regprob float, st_wts float, wins_st_wts float--, quar_prob int
\par \hich\af4\dbch\af31505\loch\f4 );
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX \hich\af4\dbch\af31505\loch\f4 pchars ON IN_aim1_model_br7_s2;
\par 
\par \hich\af4\dbch\af31505\loch\f4 --select distinct trtreg, count(distinct bene_ID) as benes from IN_aim1_modeldt_br7_sm group by trtreg order by trtreg
\par \hich\af4\dbch\af31505\loch\f4 with mrgd as (select distinct a.*, 
\par \hich\af4\dbch\af31505\loch\f4 [14001],    [14002],    [14003],    [14004],    [14005],    [14006],    [14007],    [14010],    
\par \hich\af4\dbch\af31505\loch\f4 [14112],    [14113] from
\par \hich\af4\dbch\af31505\loch\f4 IN_aim1_modeldt_br7_sm a left join IN_aim1_modeldt_br7_sm_4s2 b on a.bene_ID = b.BENE_ID)
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,regspec as (
\par \hich\af4\dbch\af31505\loch\f4 select distinct bene_ID, trtreg, [14001] as regprob, 14001 as reg from mrgd union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [14002] as regprob, 14002 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [14003] as regprob, 14003 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [\hich\af4\dbch\af31505\loch\f4 14004] as regprob, 14004 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [14005] as regprob, 14005 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [14006] as regprob, 14006 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [14007] as regprob, 14007 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [14010] as regprob, 14010 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [14112] as regprob, 14112 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [14113] a\hich\af4\dbch\af31505\loch\f4 s regprob, 14113 as reg from mrgd))   
\par 
\par \hich\af4\dbch\af31505\loch\f4 , regsspec_f as (select distinct bene_ID, reg, regprob from regspec) --where trtreg = reg)
\par \hich\af4\dbch\af31505\loch\f4 --select top 50 * from regsspec_f order by bene_id
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,br7 as (select distinct BENE_ID, trtreg, cancer_scen, total_physician_margin_hm, (total_physician_margin_hm/100) as total_physician_margin_hm_100d , 
\par \hich\af4\dbch\af31505\loch\f4     total_physician_margin_lm, (total_physician_margin_lm/100) as total_physician_margin_lm_100d , guideline_dt, guideline_dt2, regimen_type, preferred, ESQC, wtd_esqc1, wtd_esqc\hich\af4\dbch\af31505\loch\f4 
2, wtd_esqc3, wtd_esqc4,   
\par \hich\af4\dbch\af31505\loch\f4     rank, total_trt, fr_rank, fr_rank_revrs, choice,trtinit_dt from 
\par \hich\af4\dbch\af31505\loch\f4 IN_aim1_modeldt where cancer_scen = 'br7' ) 
\par 
\par \hich\af4\dbch\af31505\loch\f4 , br7_f as (select distinct a.*, b.regprob from 
\par \hich\af4\dbch\af31505\loch\f4 br7 a inner join regsspec_f b on a.bene_ID = b.bene_ID and a.trtreg = b.reg) 
\par 
\par \hich\af4\dbch\af31505\loch\f4 , br7_f2 as (select distinct *, 
\par \hich\af4\dbch\af31505\loch\f4 (case when trtreg = 14001  then (0.139 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 14002  then (0.282 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 14003  then (0.3 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 14004  then (0.026 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 14005  then (0.061 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 14006  then (0.023 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 14007  then (0.072 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 14010  then (0.016 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 14112  then (0.055 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtr\hich\af4\dbch\af31505\loch\f4 eg = 14113  then (0.025 /regprob) end) as st_wts
\par \hich\af4\dbch\af31505\loch\f4 from br7_f)
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,prcnls as (SELECT trtreg--trtreg, st_wts, PERCENT_RANK() OVER(PARTITION BY trtreg ORDER BY st_wts) AS Pctst_wts,
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.05) WITHIN GROUP (ORDER BY st_wts) OVER (PARTITION BY trtreg) as p5
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.94) WITHIN GROUP (ORDER BY st_wts) OVER (PARTITION BY trtreg) as p94
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.95) WITHIN GROUP (ORDER BY st_wts) OVER (PARTITION BY trtreg) as p95
\par \hich\af4\dbch\af31505\loch\f4   FROM br7_f2)
\par \hich\af4\dbch\af31505\loch\f4 -- select distinct trt\hich\af4\dbch\af31505\loch\f4 reg, p5, p94, p95 from prcnls 
\par \hich\af4\dbch\af31505\loch\f4 ,br7_f3 as (select distinct a.*, b.p5, b.p95 from
\par \hich\af4\dbch\af31505\loch\f4               br7_f2 a left join prcnls b on a.trtreg = b.trtreg)
\par \hich\af4\dbch\af31505\loch\f4 -- select top 50 * from br7_f3 order by bene_ID
\par \hich\af4\dbch\af31505\loch\f4 ,br7_f4 as (select *, (case when st_wts >= p95 then p95
\par \hich\af4\dbch\af31505\loch\f4                             when st_wts <= p5  then p5
\par \hich\af4\dbch\af31505\loch\f4                             else st_wts end) as wins_st_wts from br7_f3)
\par \hich\af4\dbch\af31505\loch\f4 --select count(*) from br7_f4
\par \hich\af4\dbch\af31505\loch\f4 insert into IN_aim1_model_br7_s2
\par \hich\af4\dbch\af31505\loch\f4 select top 13182 BENE_ID, trtreg, cancer_scen, total_physician_margin_hm, total_physician_margin_hm_100d , 
\par \hich\af4\dbch\af31505\loch\f4     total_physician_margin_lm, total_physician_margin_lm_100d , guideline_dt, guideline_dt2, regimen_type, preferred, ESQC, wtd_esqc1, wtd_esqc2, wtd_esqc3, wtd_esqc4,   
\par \hich\af4\dbch\af31505\loch\f4     rank, total_trt, fr_rank, fr_rank_revr\hich\af4\dbch\af31505\loch\f4 s, choice,trtinit_dt, regprob, st_wts, wins_st_wts 
\par \hich\af4\dbch\af31505\loch\f4     from br7_f4 order by BENE_ID
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 *****************************************************************;
\par \hich\af4\dbch\af31505\loch\f4 *************************  S2 model *****************************;
\par \hich\af4\dbch\af31505\loch\f4 *****************************************************************;
\par 
\par \hich\af4\dbch\af31505\loch\f4 EXEC sp_execute_external_script
\par \hich\af4\dbch\af31505\loch\f4 @language =N'R',
\par \hich\af4\dbch\af31505\loch\f4 @script=N'
\par \hich\af4\dbch\af31505\loch\f4     library(mlogit)
\par \hich\af4\dbch\af31505\loch\f4     library(dplyr)
\par \hich\af4\dbch\af31505\loch\f4     library(Formula)
\par \hich\af4\dbch\af31505\loch\f4     TM <- dfidx(inputdata, idx=c("BENE_ID","trtreg"), alt.var = "trtreg", pkg = "mlogit")
\par \hich\af4\dbch\af31505\loch\f4     m1 <- mlo\hich\af4\dbch\af31505\loch\f4 git(choice ~ total_physician_margin_hm_100d + fr_rank_revrs| 1 , weights = wins_st_wts, TM)
\par \hich\af4\dbch\af31505\loch\f4     print( summary(m1)) 
\par \hich\af4\dbch\af31505\loch\f4     print(confint(m1));'
\par \hich\af4\dbch\af31505\loch\f4         , @input_data_1 = N'select * from Medicare.dbo.IN_aim1_model_br7_s2'
\par \hich\af4\dbch\af31505\loch\f4         , @input_data_1_name = N'inputdata';
\par 
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 *******************************;
\par \hich\af4\dbch\af31505\loch\f4 *************br8 **************;
\par \hich\af4\dbch\af31505\loch\f4 *******************************;
\par 
\par \hich\af4\dbch\af31505\loch\f4 ********* get table for stage1 - can call disease risk group modeling;
\par \hich\af4\dbch\af31505\loch\f4 drop table IN_aim1_modeldt_br8_sm
\par \hich\af4\dbch\af31505\loch\f4 Create table Medicare.dbo.IN_aim1_modeldt_br8_sm (
\par \hich\af4\dbch\af31505\loch\f4             BENE_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL, year_diag varchar(4), geo varchar(10), metro varchar(1), 
\par \hich\af4\dbch\af31505\loch\f4             trtreg int, guideline_dt date, choice bit,  total_physician_mar\hich\af4\dbch\af31505\loch\f4 gin_hm int, nci_index float, frail_score float, 
\par \hich\af4\dbch\af31505\loch\f4             age int,  BENE_RACE_CD int, --RTI_RACE_CD int, 
\par \hich\af4\dbch\af31505\loch\f4             race_4cat varchar(15),  SEX_IDENT_CD varchar(1), LIS_status varchar(25), med_cats varchar(16), pov_cat varchar(30),
\par \hich\af4\dbch\af31505\loch\f4             spec varchar (200), QUARTILE_pnpi varchar(1), npigndr varchar (1), npigrd_yr int, npi_cats varchar(14),
\par \hich\af4\dbch\af31505\loch\f4             spec_2cat varchar (200), LIS_status_2cat varchar(25), SNo int,
\par 
\par \hich\af4\dbch\af31505\loch\f4 );
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX pcharsml ON IN_aim1_modeldt_br8_sm;
\par 
\par \hich\af4\dbch\af31505\loch\f4 with\hich\af4\dbch\af31505\loch\f4  reg_benes as (select distinct trtreg, count (distinct bene_ID) as benes from IN_aim1_modeldt 
\par \hich\af4\dbch\af31505\loch\f4                    where cancer_scen = 'br8' and choice = 1 group by trtreg)
\par \hich\af4\dbch\af31505\loch\f4     ,foreligreg as (select distinct a.*, b.benes from
\par \hich\af4\dbch\af31505\loch\f4                    IN_aim1_modeldt a inner join reg_benes b on a.trtreg = b.trtreg where a.cancer_scen = 'br8')
\par \hich\af4\dbch\af31505\loch\f4     ,elig_reg as (select * from foreligreg where benes >20)
\par \hich\af4\dbch\af31505\loch\f4     ,fl as (select distinct bene_ID, count(distinct choice) as fl from elig_reg group by bene_ID)
\par \hich\af4\dbch\af31505\loch\f4     ,foreligbene as (select distinct a.*, b.fl from
\par \hich\af4\dbch\af31505\loch\f4                       elig_reg a left join fl b on a.BENE_ID = b.bene_ID)               
\par \hich\af4\dbch\af31505\loch\f4 --select count(*), count(distinct bene_ID) as benes from foreligbene where fl =2
\par \hich\af4\dbch\af31505\loch\f4     insert into IN_aim1_modeldt_br8_sm --IN_aim1 as (
\par \hich\af4\dbch\af31505\loch\f4         select BENE_ID, year_diag, geo, metro, trtreg, guideline_dt, choice, total_physician_margin_hm, 
\par \hich\af4\dbch\af31505\loch\f4         nci_index, frail_score, a\hich\af4\dbch\af31505\loch\f4 ge, bene_race_cd, --RTI_RACE_CD, 
\par \hich\af4\dbch\af31505\loch\f4         race_4cat, SEX_IDENT_CD, LIS_status, med_cats, pov_cat, spec, QUARTILE_pnpi, npigndr, npigrd_yr, npi_cats,
\par \hich\af4\dbch\af31505\loch\f4         spec_2cat, LIS_status_2cat,
\par \hich\af4\dbch\af31505\loch\f4         ROW_NUMBER() OVER(ORDER BY (bene_ID)) AS SNo from foreligbene where fl = 2 and choice = 1
\par \hich\af4\dbch\af31505\loch\f4 --select count(distinct bene_ID), count(distinct trtreg) from IN_aim1_modeldt_br8_sm
\par 
\par \hich\af4\dbch\af31505\loch\f4 --select distinct trtreg from IN_aim1_modeldt_br8_sm order by trtreg
\par \hich\af4\dbch\af31505\loch\f4 drop table IN_aim1_modeldt_br8_sm_4s2
\par \hich\af4\dbch\af31505\loch\f4 Create table Medicare.dbo.IN_aim1_mo\hich\af4\dbch\af31505\loch\f4 deldt_br8_sm_4s2 (
\par \hich\af4\dbch\af31505\loch\f4             BENE_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL,
\par \hich\af4\dbch\af31505\loch\f4 [14034] float,  [14035] float,  [14036] float,  [14040] float);
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX pcharsml ON IN_aim1_modeldt_br8_sm_4s2;
\par 
\par \hich\af4\dbch\af31505\loch\f4 insert into IN_aim1_modeldt_br8_sm_4s2
\par \hich\af4\dbch\af31505\loch\f4 --select distinct bene_ID from IN_aim1_modeldt_br8_sm
\par \hich\af4\dbch\af31505\loch\f4 EXEC sp_execute_external_script
\par \hich\af4\dbch\af31505\loch\f4 @language =N'R',
\par \hich\af4\dbch\af31505\loch\f4 @script=N'
\par \hich\af4\dbch\af31505\loch\f4     library(nnet)
\par \hich\af4\dbch\af31505\loch\f4     library(stats)
\par \hich\af4\dbch\af31505\loch\f4     rownames(inputdata) <- inputdata$BENE_ID
\par \hich\af4\dbch\af31505\loch\f4     test <- multinom(trtreg ~ year_diag + race_4cat + LIS_status_2cat + metro +  med_cats + pov_cat + geo + 
\par \hich\af4\dbch\af31505\loch\f4                                age + frail_score + nci_index + spec_2cat + QUARTILE_pnpi + npigndr + npi_cats, data = inputdata)    
\par \hich\af4\dbch\af31505\loch\f4     inputdata$regpredprob <- predict(test, newdata = inputdata, "probs")
\par \hich\af4\dbch\af31505\loch\f4     #print(head(inputdata$regpredprob ))
\par \hich\af4\dbch\af31505\loch\f4     coeff_out <-data.frame(inputdata$regpredprob);
\par \hich\af4\dbch\af31505\loch\f4     #print(head(coeff_out))
\par \hich\af4\dbch\af31505\loch\f4     outputdata <- cbind(row.name\hich\af4\dbch\af31505\loch\f4 s(coeff_out),coeff_out);'
\par \hich\af4\dbch\af31505\loch\f4     , @input_data_1 = N'select * from Medicare.dbo.IN_aim1_modeldt_br8_sm'
\par \hich\af4\dbch\af31505\loch\f4     , @input_data_1_name = N'inputdata'
\par \hich\af4\dbch\af31505\loch\f4     , @output_data_1_name = N'outputdata'
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 **************** get data for stage 2 model ******************;
\par \hich\af4\dbch\af31505\loch\f4     Drop table Medicare.dbo.IN_aim1_model_br8_s2 
\par \hich\af4\dbch\af31505\loch\f4     Create table Medicare.dbo.IN_aim1_model_br8_s2 (
\par \hich\af4\dbch\af31505\loch\f4             BENE_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL,trtreg int,cancer_scen varchar(200),
\par \hich\af4\dbch\af31505\loch\f4 total_physician_margin_hm float,  total_physician\hich\af4\dbch\af31505\loch\f4 _margin_hm_100d float, 
\par \hich\af4\dbch\af31505\loch\f4 total_physician_margin_lm float,  total_physician_margin_lm_100d float,
\par \hich\af4\dbch\af31505\loch\f4 guideline_dt date null, guideline_dt2 date null, regimen_type int, preferred int,   
\par \hich\af4\dbch\af31505\loch\f4 ESQC int, wtd_esqc1 float, wtd_esqc2 float, wtd_esqc3 float, wtd_esqc4 float,   
\par \hich\af4\dbch\af31505\loch\f4 rank int,   total_trt int,   fr_rank float, fr_rank_revrs float, 
\par \hich\af4\dbch\af31505\loch\f4 --trtgiven 
\par \hich\af4\dbch\af31505\loch\f4 choice bit,trtinit_dt date null,  regprob float, st_wts float, wins_st_wts float--, quar_prob int
\par \hich\af4\dbch\af31505\loch\f4 );
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX pchars ON IN_aim1_model_br8_s2;
\par 
\par \hich\af4\dbch\af31505\loch\f4 --select distinct trtreg, count(distinct bene_ID) as benes from IN_aim1_modeldt_br8_sm group by trtreg order by trtreg
\par \hich\af4\dbch\af31505\loch\f4 with mrgd as (select distinct a.*, [14034], [14035], [14036],  [14040] from
\par \hich\af4\dbch\af31505\loch\f4 IN_aim1_modeldt_br8_sm a left join IN_aim1_modeldt_br8_sm_4s2 b on a.bene_ID = b.BENE_ID)
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,regspec as (
\par \hich\af4\dbch\af31505\loch\f4 select distinct bene_ID, trtreg, [14034\hich\af4\dbch\af31505\loch\f4 ] as regprob, 14034 as reg from mrgd union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [14035] as regprob, 14035 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [14036] as regprob, 14036 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [14040] as regprob, 14040 as reg from mrgd))   
\par 
\par \hich\af4\dbch\af31505\loch\f4 , regsspec_f as (select distinct bene_ID, reg, regprob from regspec) --where trtreg = reg)
\par \hich\af4\dbch\af31505\loch\f4 --select top 50 * from regsspec_f order by bene_id
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,br8 as (select distinct BENE_ID, trtreg, cancer_scen, total_physician_marg\hich\af4\dbch\af31505\loch\f4 in_hm, (total_physician_margin_hm/100) as total_physician_margin_hm_100d , 
\par \hich\af4\dbch\af31505\loch\f4     total_physician_margin_lm, (total_physician_margin_lm/100) as total_physician_margin_lm_100d , guideline_dt, guideline_dt2, regimen_type, preferred, ESQC, wtd_esqc1, wtd_esqc2, wtd_esqc3, wtd_esqc4,   
\par \hich\af4\dbch\af31505\loch\f4     rank, total_trt, fr_rank, fr_rank_revrs, choice,trtinit_dt from 
\par \hich\af4\dbch\af31505\loch\f4 IN_aim1_modeldt where cancer_scen = 'br8' ) 
\par 
\par \hich\af4\dbch\af31505\loch\f4 , br8_f as (select distinct a.*, b.regprob from 
\par \hich\af4\dbch\af31505\loch\f4 br8 a inner join regsspec_f b on a.bene_ID = b.bene_ID and a.trtre\hich\af4\dbch\af31505\loch\f4 g = b.reg) 
\par 
\par \hich\af4\dbch\af31505\loch\f4 , br8_f2 as (select distinct *, 
\par \hich\af4\dbch\af31505\loch\f4 (case when trtreg = 14034  then (0.614 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 14035  then (0.235 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 14036  then (0.129 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 14040  then (0.022 /regprob) end) as st_wts
\par \hich\af4\dbch\af31505\loch\f4 from br8_f)
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,prcnls as (SELECT trtreg--trtreg, st_wts, PERCENT_RANK() OVER(PARTITION BY trtreg ORDER BY st_wts) AS Pctst_wts,
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.05) WITHIN GROUP (ORDER BY st_wts) OVER (PARTITION BY trtreg) as p5
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.94) WITHIN GROUP (ORDER BY st_wts) OVER (PARTITION BY trtreg) as p94
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.95) WITHIN GROUP (ORDER BY st_wts) OVER (PARTITION BY trtreg) as p95
\par \hich\af4\dbch\af31505\loch\f4   FROM br8_f2)
\par \hich\af4\dbch\af31505\loch\f4 -- select dis\hich\af4\dbch\af31505\loch\f4 tinct trtreg, p5, p94, p95 from prcnls 
\par \hich\af4\dbch\af31505\loch\f4 ,br8_f3 as (select distinct a.*, b.p5, b.p95 from
\par \hich\af4\dbch\af31505\loch\f4               br8_f2 a left join prcnls b on a.trtreg = b.trtreg)
\par \hich\af4\dbch\af31505\loch\f4 -- select top 50 * from br8_f3 order by bene_ID
\par \hich\af4\dbch\af31505\loch\f4 ,br8_f4 as (select *, (case when st_wts >= p95 then p95
\par \hich\af4\dbch\af31505\loch\f4                             when st_wts <= p5  then p5
\par \hich\af4\dbch\af31505\loch\f4                             else st_wts end) as wins_st_wts from br8_f3)
\par \hich\af4\dbch\af31505\loch\f4 --select count(*) from br8_f4
\par \hich\af4\dbch\af31505\loch\f4 insert into IN_aim1_model_br8_s2
\par \hich\af4\dbch\af31505\loch\f4 select top 7000 BENE_ID, trtreg, cancer_scen, total_physician\hich\af4\dbch\af31505\loch\f4 _margin_hm, total_physician_margin_hm_100d , 
\par \hich\af4\dbch\af31505\loch\f4     total_physician_margin_lm, total_physician_margin_lm_100d , guideline_dt, guideline_dt2, regimen_type, preferred, ESQC, wtd_esqc1, wtd_esqc2, wtd_esqc3, wtd_esqc4,   
\par \hich\af4\dbch\af31505\loch\f4     rank, total_trt, fr_rank, fr_rank_revrs, choice,trtinit_dt, regprob, st_wts, wins_st_wts 
\par \hich\af4\dbch\af31505\loch\f4     from br8_f4 order by BENE_ID
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 *****************************************************************;
\par \hich\af4\dbch\af31505\loch\f4 *************************  S2 model *****************************;
\par \hich\af4\dbch\af31505\loch\f4 *****************************************************************;
\par 
\par \hich\af4\dbch\af31505\loch\f4 EXEC sp_execute_external_script
\par \hich\af4\dbch\af31505\loch\f4 @language =N'R',
\par \hich\af4\dbch\af31505\loch\f4 @script=N'
\par \hich\af4\dbch\af31505\loch\f4     library(mlogit)
\par \hich\af4\dbch\af31505\loch\f4     library(dplyr)
\par \hich\af4\dbch\af31505\loch\f4     library(Formula)
\par \hich\af4\dbch\af31505\loch\f4     TM <- dfidx(inputdata, idx=c("BENE_ID","trtreg"), alt.var = "trtreg", pkg = "mlogit")
\par \hich\af4\dbch\af31505\loch\f4     m1 <- mlogit(choice ~ total_physician_margin_hm_100d + fr_rank_revrs| 1 , weights = wins_st_wts, TM)
\par \hich\af4\dbch\af31505\loch\f4     print( summary(m1)) 
\par \hich\af4\dbch\af31505\loch\f4     print(confint(m1));'
\par \hich\af4\dbch\af31505\loch\f4         , @i\hich\af4\dbch\af31505\loch\f4 nput_data_1 = N'select * from Medicare.dbo.IN_aim1_model_br8_s2'
\par \hich\af4\dbch\af31505\loch\f4         , @input_data_1_name = N'inputdata';
\par 
\par 
\par 
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 *******************************;
\par \hich\af4\dbch\af31505\loch\f4 *************rectum2 **********;
\par \hich\af4\dbch\af31505\loch\f4 *******************************;
\par 
\par \hich\af4\dbch\af31505\loch\f4 ********* get table for stage1 - can call disease risk group modeling;
\par \hich\af4\dbch\af31505\loch\f4 drop table IN_aim1_modeldt_rectum2_sm
\par \hich\af4\dbch\af31505\loch\f4 Create table Medicare.dbo.IN_aim1_modeldt_rectum2_sm (
\par \hich\af4\dbch\af31505\loch\f4             BENE_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL, year_diag varchar(4), geo varchar(10), metro varchar(1), 
\par \hich\af4\dbch\af31505\loch\f4             trtreg int, guideline_dt date, choice bit,  total_physician_margin_hm int, nci_index float, frail_score float, 
\par \hich\af4\dbch\af31505\loch\f4             age int,  BENE_RACE_CD int, --RTI_RACE_CD int, 
\par \hich\af4\dbch\af31505\loch\f4             race_4cat varchar(1\hich\af4\dbch\af31505\loch\f4 5),  SEX_IDENT_CD varchar(1), LIS_status varchar(25), med_cats varchar(16), pov_cat varchar(30),
\par \hich\af4\dbch\af31505\loch\f4             spec varchar (200), QUARTILE_pnpi varchar(1), npigndr varchar (1), npigrd_yr int, npi_cats varchar(14),
\par \hich\af4\dbch\af31505\loch\f4             spec_2cat varchar (200), LIS_status_2cat varchar(25), SNo int,
\par 
\par \hich\af4\dbch\af31505\loch\f4 );
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX pcharsml ON IN_aim1_modeldt_rectum2_sm;
\par 
\par \hich\af4\dbch\af31505\loch\f4 with reg_benes as (select distinct trtreg, count (distinct bene_ID) as benes from IN_aim1_modeldt 
\par \hich\af4\dbch\af31505\loch\f4                    where cancer_scen = 'r\hich\af4\dbch\af31505\loch\f4 ectum2' and choice = 1 group by trtreg)
\par \hich\af4\dbch\af31505\loch\f4     ,foreligreg as (select distinct a.*, b.benes from
\par \hich\af4\dbch\af31505\loch\f4                    IN_aim1_modeldt a inner join reg_benes b on a.trtreg = b.trtreg where a.cancer_scen = 'rectum2')
\par \hich\af4\dbch\af31505\loch\f4     ,elig_reg as (select * from foreligreg where benes >20)
\par \hich\af4\dbch\af31505\loch\f4     ,fl as (select distinct bene_ID, count(distinct choice) as fl from elig_reg group by bene_ID)
\par \hich\af4\dbch\af31505\loch\f4     ,foreligbene as (select distinct a.*, b.fl from
\par \hich\af4\dbch\af31505\loch\f4                       elig_reg a left join fl b on a.BENE_ID = b.bene_ID)               
\par \hich\af4\dbch\af31505\loch\f4 --s\hich\af4\dbch\af31505\loch\f4 elect count(*), count(distinct bene_ID) as benes from foreligbene where fl =2
\par \hich\af4\dbch\af31505\loch\f4     insert into IN_aim1_modeldt_rectum2_sm --IN_aim1 as (
\par \hich\af4\dbch\af31505\loch\f4         select BENE_ID, year_diag, geo, metro, trtreg, guideline_dt, choice, total_physician_margin_hm, 
\par \hich\af4\dbch\af31505\loch\f4         nci_index, frail_score, age, bene_race_cd, --RTI_RACE_CD, 
\par \hich\af4\dbch\af31505\loch\f4         race_4cat, SEX_IDENT_CD, LIS_status, med_cats, pov_cat, spec, QUARTILE_pnpi, npigndr, npigrd_yr, npi_cats,
\par \hich\af4\dbch\af31505\loch\f4         spec_2cat, LIS_status_2cat,
\par \hich\af4\dbch\af31505\loch\f4         ROW_NUMBER() OVER(ORDER BY (bene_ID)) AS SNo from foreligbene where fl = 2 and choice = 1
\par \hich\af4\dbch\af31505\loch\f4 --select count(distinct bene_ID), count(distinct trtreg) from IN_aim1_modeldt_rectum2_sm
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 --select distinct trtreg from IN_aim1_modeldt_rectum2_sm order by trtreg
\par \hich\af4\dbch\af31505\loch\f4 drop table IN_aim1_modeldt_rectum2_sm_4s2
\par \hich\af4\dbch\af31505\loch\f4 Create table Medicare.dbo.IN_aim1_modeldt_rectum2_sm_4s2 (
\par \hich\af4\dbch\af31505\loch\f4             BENE_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL,
\par \hich\af4\dbch\af31505\loch\f4 [32022] float,  [32023] float,  [32024] float,  [32025] float,  [32026] float,  [32027] float,  [32029] float);
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX pcharsml ON IN_aim1_modeldt_rectum2_sm_4s2;
\par 
\par \hich\af4\dbch\af31505\loch\f4 insert into IN_aim1_modeldt_rectum2_sm_4s2
\par \hich\af4\dbch\af31505\loch\f4 --select distinct bene_I\hich\af4\dbch\af31505\loch\f4 D from IN_aim1_modeldt_rectum2_sm
\par \hich\af4\dbch\af31505\loch\f4 EXEC sp_execute_external_script
\par \hich\af4\dbch\af31505\loch\f4 @language =N'R',
\par \hich\af4\dbch\af31505\loch\f4 @script=N'
\par \hich\af4\dbch\af31505\loch\f4     library(nnet)
\par \hich\af4\dbch\af31505\loch\f4     library(stats)
\par \hich\af4\dbch\af31505\loch\f4     rownames(inputdata) <- inputdata$BENE_ID
\par \hich\af4\dbch\af31505\loch\f4     test <- multinom(trtreg ~ year_diag + SEX_IDENT_CD + race_4cat + LIS_status_2cat + metro +  med_cats + pov_cat + geo + 
\par \hich\af4\dbch\af31505\loch\f4                                age + frail_score + nci_index + spec_2cat + QUARTILE_pnpi + npigndr + npi_cats, data = inputdata)    
\par \hich\af4\dbch\af31505\loch\f4     inputdata$regpredprob <- predict(test, newdata = inputdata, "probs")
\par \hich\af4\dbch\af31505\loch\f4     #print(head(inputdata$regpredprob ))
\par \hich\af4\dbch\af31505\loch\f4     coeff_out <-data.frame(inputdata$regpredprob);
\par \hich\af4\dbch\af31505\loch\f4     #print(head(coeff_out))
\par \hich\af4\dbch\af31505\loch\f4     outputdata <- cbind(row.names(coeff_out),coeff_out);'
\par \hich\af4\dbch\af31505\loch\f4     , @input_data_1 = N'select * from Medicare.dbo.IN_aim1_modeldt_rectum2_sm'
\par \hich\af4\dbch\af31505\loch\f4     , @input_data_1_name = N'inputdata'
\par \hich\af4\dbch\af31505\loch\f4     , @output_data_1_name = N'outputdata'
\par 
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 **************** get data for stage 2 model ******************;
\par \hich\af4\dbch\af31505\loch\f4     Drop table Medicare.dbo.IN_ai\hich\af4\dbch\af31505\loch\f4 m1_model_rectum2_s2 
\par \hich\af4\dbch\af31505\loch\f4     Create table Medicare.dbo.IN_aim1_model_rectum2_s2 (
\par \hich\af4\dbch\af31505\loch\f4             BENE_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL,trtreg int,cancer_scen varchar(200),
\par \hich\af4\dbch\af31505\loch\f4 total_physician_margin_hm float,  total_physician_margin_hm_100d float, 
\par \hich\af4\dbch\af31505\loch\f4 total_physician_margin_lm float,  total_physician_margin_lm_100d float,
\par \hich\af4\dbch\af31505\loch\f4 guideline_dt date null, guideline_dt2 date null, regimen_type int, preferred int,   
\par \hich\af4\dbch\af31505\loch\f4 ESQC int, wtd_esqc1 float, wtd_esqc2 float, wtd_esqc3 float, wtd_esqc4 float,   
\par \hich\af4\dbch\af31505\loch\f4 rank int,   \hich\af4\dbch\af31505\loch\f4 total_trt int,   fr_rank float, fr_rank_revrs float, 
\par \hich\af4\dbch\af31505\loch\f4 --trtgiven 
\par \hich\af4\dbch\af31505\loch\f4 choice bit,trtinit_dt date null,  regprob float, st_wts float, wins_st_wts float--, quar_prob int
\par \hich\af4\dbch\af31505\loch\f4 );
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX pchars ON IN_aim1_model_rectum2_s2;
\par 
\par \hich\af4\dbch\af31505\loch\f4 --select distinct trtreg, count(distinct bene_ID) as benes from IN_aim1_modeldt_rectum2_sm group by trtreg order by trtreg
\par \hich\af4\dbch\af31505\loch\f4 with mrgd as (select distinct a.*, 
\par \hich\af4\dbch\af31505\loch\f4     [32022],    [32023],    [32024],    [32025],    [32026],    [32027],    [32029] from
\par \hich\af4\dbch\af31505\loch\f4 IN_aim1_modeldt_rectum2_sm a left join IN_aim1_modeldt_rectum2_sm_4s2 b on a.bene_ID = b.BENE_ID)
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,regspec as (
\par \hich\af4\dbch\af31505\loch\f4 select distinct bene_ID, trtreg, [32022] as regprob, 32022 as reg from mrgd union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [32023] as regprob, 32023 as reg fr\hich\af4\dbch\af31505\loch\f4 om mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [32024] as regprob, 32024 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [32025] as regprob, 32025 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [32026] as regprob, 32026 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [32027] as regprob, 32027 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [32029] as regprob, 32029 as reg from mrgd))   
\par 
\par \hich\af4\dbch\af31505\loch\f4 , regsspec_f as (select distinct bene_ID, reg, regprob from regspec) --where t\hich\af4\dbch\af31505\loch\f4 rtreg = reg)
\par \hich\af4\dbch\af31505\loch\f4 --select top 50 * from regsspec_f order by bene_id
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,rectum2 as (select distinct BENE_ID, trtreg, cancer_scen, total_physician_margin_hm, (total_physician_margin_hm/100) as total_physician_margin_hm_100d , 
\par \hich\af4\dbch\af31505\loch\f4     total_physician_margin_lm, (total_physician_margin_lm/100) as total_physician_margin_lm_100d , guideline_dt, guideline_dt2, regimen_type, preferred, ESQC, wtd_esqc1, wtd_esqc2, wtd_esqc3, wtd_esqc4,   
\par \hich\af4\dbch\af31505\loch\f4     rank, total_trt, fr_rank, fr_rank_revrs, choice,trtinit_dt from 
\par \hich\af4\dbch\af31505\loch\f4 IN_aim1_modeldt w\hich\af4\dbch\af31505\loch\f4 here cancer_scen = 'rectum2' ) 
\par 
\par \hich\af4\dbch\af31505\loch\f4 , rectum2_f as (select distinct a.*, b.regprob from 
\par \hich\af4\dbch\af31505\loch\f4 rectum2 a inner join regsspec_f b on a.bene_ID = b.bene_ID and a.trtreg = b.reg) 
\par 
\par \hich\af4\dbch\af31505\loch\f4 , rectum2_f2 as (select distinct *, 
\par \hich\af4\dbch\af31505\loch\f4 (case when trtreg = 32022  then (0.575 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 32023  then (0.156 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 32024  then (0.1 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 32025  then (0.035 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 32026  then (0.107 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 32027  then (0.013 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 32029  then (0.014 /regprob) end) as st_wts
\par \hich\af4\dbch\af31505\loch\f4 from rectum2_f)
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,prcnls as (SELECT trtreg--trtreg, st_wts, PERCENT_RANK() OVER(PARTITION BY trtreg ORDER BY st_wts) AS Pctst_wts,
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.05) WITHIN GROUP (ORDER BY st_\hich\af4\dbch\af31505\loch\f4 wts) OVER (PARTITION BY trtreg) as p5
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.94) WITHIN GROUP (ORDER BY st_wts) OVER (PARTITION BY trtreg) as p94
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.95) WITHIN GROUP (ORDER BY st_wts) OVER (PARTITION BY trtreg) as p95
\par \hich\af4\dbch\af31505\loch\f4   FROM rectum2_f2)
\par \hich\af4\dbch\af31505\loch\f4 -- select distinct trtreg, p5, p94, p95 from prcnls 
\par \hich\af4\dbch\af31505\loch\f4 ,rectum2_f3 as (select distinct a.*, b.p5, b.p95 from
\par \hich\af4\dbch\af31505\loch\f4               rectum2_f2 a left join prcnls b on a.trtreg = b.trtreg)
\par \hich\af4\dbch\af31505\loch\f4 -- select top 50 * from rectum2_f3 order by bene_ID
\par \hich\af4\dbch\af31505\loch\f4 ,rectum2_f4 as (select *, \hich\af4\dbch\af31505\loch\f4 (case when st_wts >= p95 then p95
\par \hich\af4\dbch\af31505\loch\f4                             when st_wts <= p5  then p5
\par \hich\af4\dbch\af31505\loch\f4                             else st_wts end) as wins_st_wts from rectum2_f3)
\par \hich\af4\dbch\af31505\loch\f4 --select count(*) from rectum2_f4
\par \hich\af4\dbch\af31505\loch\f4 insert into IN_aim1_model_rectum2_s2
\par \hich\af4\dbch\af31505\loch\f4 select top 16998 BENE_ID, trtreg, cancer_scen, total_physician_margin_hm, total_physician_margin_hm_100d , 
\par \hich\af4\dbch\af31505\loch\f4     total_physician_margin_lm, total_physician_margin_lm_100d , guideline_dt, guideline_dt2, regimen_type, preferred, ESQC, wtd_esqc1, wtd_esqc2, wtd_esqc3, wtd_esqc4,   
\par \hich\af4\dbch\af31505\loch\f4     rank, total_trt, fr_rank, fr_rank_revrs, choice,trtinit_dt, regprob, st_wts, wins_st_wts 
\par \hich\af4\dbch\af31505\loch\f4     from rectum2_f4 order by BENE_ID
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 *****************************************************************;
\par \hich\af4\dbch\af31505\loch\f4 *************************  S2 model *****************************;
\par \hich\af4\dbch\af31505\loch\f4 *****************************************************************;
\par 
\par \hich\af4\dbch\af31505\loch\f4 EXEC s\hich\af4\dbch\af31505\loch\f4 p_execute_external_script
\par \hich\af4\dbch\af31505\loch\f4 @language =N'R',
\par \hich\af4\dbch\af31505\loch\f4 @script=N'
\par \hich\af4\dbch\af31505\loch\f4     library(mlogit)
\par \hich\af4\dbch\af31505\loch\f4     library(dplyr)
\par \hich\af4\dbch\af31505\loch\f4     library(Formula)
\par \hich\af4\dbch\af31505\loch\f4     TM <- dfidx(inputdata, idx=c("BENE_ID","trtreg"), alt.var = "trtreg", pkg = "mlogit")
\par \hich\af4\dbch\af31505\loch\f4     m1 <- mlogit(choice ~ total_physician_margin_hm_100d + fr_rank_revrs| 1 , weights = wins_st_wts, TM)
\par \hich\af4\dbch\af31505\loch\f4     print( summary(m1)) 
\par \hich\af4\dbch\af31505\loch\f4     print(confint(m1));'
\par \hich\af4\dbch\af31505\loch\f4         , @input_data_1 = N'select * from Medicare.dbo.IN_aim1_model_rectum2_s2'
\par \hich\af4\dbch\af31505\loch\f4         , @input_data_1_name = N'inputdata';
\par 
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 ************************\hich\af4\dbch\af31505\loch\f4 *******;
\par \hich\af4\dbch\af31505\loch\f4 ************* mm1 *************;
\par \hich\af4\dbch\af31505\loch\f4 *******************************;
\par 
\par \hich\af4\dbch\af31505\loch\f4 ********* get table for stage1 - can call disease risk group modeling;
\par \hich\af4\dbch\af31505\loch\f4 drop table IN_aim1_modeldt_mm1_sm
\par \hich\af4\dbch\af31505\loch\f4 Create table Medicare.dbo.IN_aim1_modeldt_mm1_sm (
\par \hich\af4\dbch\af31505\loch\f4             BENE_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL, year_diag varchar(4), geo varchar(10), metro varchar(1), 
\par \hich\af4\dbch\af31505\loch\f4             trtreg int, guideline_dt date, choice bit,  total_physician_margin_hm int, nci_index float, frail_score float, 
\par \hich\af4\dbch\af31505\loch\f4             age int,  BENE_RACE_CD int, --RTI_RACE_CD int, 
\par \hich\af4\dbch\af31505\loch\f4             race_4cat varchar(15),  SEX_IDENT_CD varchar(1), LIS_status varchar(25), med_cats varchar(16), pov_cat varchar(30),
\par \hich\af4\dbch\af31505\loch\f4             spec\hich\af4\dbch\af31505\loch\f4  varchar (200), QUARTILE_pnpi varchar(1), npigndr varchar (1), npigrd_yr int, npi_cats varchar(14),
\par \hich\af4\dbch\af31505\loch\f4             spec_2cat varchar (200), LIS_status_2cat varchar(25), SNo int,
\par 
\par \hich\af4\dbch\af31505\loch\f4 );
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX pcharsml ON IN_aim1_modeldt_mm1_sm;
\par 
\par \hich\af4\dbch\af31505\loch\f4 with reg_benes as (select distinct trtreg, count (distinct bene_ID) as benes from IN_aim1_modeldt 
\par \hich\af4\dbch\af31505\loch\f4                    where cancer_scen = 'mm1' and choice = 1 group by trtreg)
\par \hich\af4\dbch\af31505\loch\f4     ,foreligreg as (select distinct a.*, b.benes from
\par \hich\af4\dbch\af31505\loch\f4                    IN_aim1_\hich\af4\dbch\af31505\loch\f4 modeldt a inner join reg_benes b on a.trtreg = b.trtreg where a.cancer_scen = 'mm1')
\par \hich\af4\dbch\af31505\loch\f4     ,elig_reg as (select * from foreligreg where benes >20)
\par \hich\af4\dbch\af31505\loch\f4     ,fl as (select distinct bene_ID, count(distinct choice) as fl from elig_reg group by bene_ID)
\par \hich\af4\dbch\af31505\loch\f4     ,foreligbene as (select distinct a.*, b.fl from
\par \hich\af4\dbch\af31505\loch\f4                       elig_reg a left join fl b on a.BENE_ID = b.bene_ID)               
\par \hich\af4\dbch\af31505\loch\f4 --select count(*), count(distinct bene_ID) as benes from foreligbene where fl =2
\par \hich\af4\dbch\af31505\loch\f4     insert into IN_aim1_modeldt_mm1_sm --IN_aim1 as (
\par \hich\af4\dbch\af31505\loch\f4         select BENE_ID, year_diag, geo, metro, trtreg, guideline_dt, choice, total_physician_margin_hm, 
\par \hich\af4\dbch\af31505\loch\f4         nci_index, frail_score, age, bene_race_cd, --RTI_RACE_CD, 
\par \hich\af4\dbch\af31505\loch\f4         race_4cat, SEX_IDENT_CD, LIS_status, med_cats, pov_cat, spec, QUARTILE_pnpi, npigndr, npigrd_yr, npi_cats,
\par \hich\af4\dbch\af31505\loch\f4         spec_2cat, LIS_status_2cat,
\par \hich\af4\dbch\af31505\loch\f4         ROW_NUMBER() OVER(ORDER BY (bene_ID)) AS SNo from foreligbene where fl = 2 and choice = 1
\par \hich\af4\dbch\af31505\loch\f4 --select count(distinct bene_ID), cou\hich\af4\dbch\af31505\loch\f4 nt(distinct trtreg) from IN_aim1_modeldt_mm1_sm
\par 
\par \hich\af4\dbch\af31505\loch\f4 --select distinct trtreg from IN_aim1_modeldt_mm1_sm order by trtreg
\par \hich\af4\dbch\af31505\loch\f4 drop table IN_aim1_modeldt_mm1_sm_4s2
\par \hich\af4\dbch\af31505\loch\f4 Create table Medicare.dbo.IN_aim1_modeldt_mm1_sm_4s2 (
\par \hich\af4\dbch\af31505\loch\f4             BENE_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL,
\par \hich\af4\dbch\af31505\loch\f4 [27001] float,  [27002] float,  [27004] float,  [27006] float,  [27009] float,  [27082] float);
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX pcharsml ON IN_aim1_modeldt_mm1_sm_4s2;
\par 
\par \hich\af4\dbch\af31505\loch\f4 insert into IN_aim1_modeldt_mm1_sm_4s2
\par \hich\af4\dbch\af31505\loch\f4 --select di\hich\af4\dbch\af31505\loch\f4 stinct bene_ID from IN_aim1_modeldt_mm1_sm
\par \hich\af4\dbch\af31505\loch\f4 EXEC sp_execute_external_script
\par \hich\af4\dbch\af31505\loch\f4 @language =N'R',
\par \hich\af4\dbch\af31505\loch\f4 @script=N'
\par \hich\af4\dbch\af31505\loch\f4     library(nnet)
\par \hich\af4\dbch\af31505\loch\f4     library(stats)
\par \hich\af4\dbch\af31505\loch\f4     rownames(inputdata) <- inputdata$BENE_ID
\par \hich\af4\dbch\af31505\loch\f4     test <- multinom(trtreg ~ year_diag + SEX_IDENT_CD + race_4cat + LIS_status_2cat + metro +  med_cats + pov_cat + geo + 
\par \hich\af4\dbch\af31505\loch\f4                                age + frail_score + nci_index + spec_2cat + QUARTILE_pnpi + npigndr + npi_cats, data = inputdata)    
\par \hich\af4\dbch\af31505\loch\f4     inputdata$regpredprob <- predict(test, newdata = inputdata, "probs")
\par \hich\af4\dbch\af31505\loch\f4     #print(head(inputdata$regpredprob ))
\par \hich\af4\dbch\af31505\loch\f4     coeff_out <-data.frame(inputdata$regpredprob);
\par \hich\af4\dbch\af31505\loch\f4     #print(head(coeff_out))
\par \hich\af4\dbch\af31505\loch\f4     outputdata <- cbind(row.names(coeff_out),coeff_out);'
\par \hich\af4\dbch\af31505\loch\f4     , @input_data_1 = N'select * from Medicare.dbo.IN_aim1_modeldt_mm1_sm'
\par \hich\af4\dbch\af31505\loch\f4     , @input_data_1_name = N'inputdata'
\par \hich\af4\dbch\af31505\loch\f4     , @output_data_1_name = N'outputdata'
\par 
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 **************** get data for stage 2 model ******************;
\par \hich\af4\dbch\af31505\loch\f4     Drop table Medicare.dbo.IN_aim1_m\hich\af4\dbch\af31505\loch\f4 odel_mm1_s2 
\par \hich\af4\dbch\af31505\loch\f4     Create table Medicare.dbo.IN_aim1_model_mm1_s2 (
\par \hich\af4\dbch\af31505\loch\f4             BENE_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL,trtreg int,cancer_scen varchar(200),
\par \hich\af4\dbch\af31505\loch\f4 total_physician_margin_hm float,  total_physician_margin_hm_100d float, 
\par \hich\af4\dbch\af31505\loch\f4 total_physician_margin_lm float,  total_physician_margin_lm_100d float,
\par \hich\af4\dbch\af31505\loch\f4 guideline_dt date null, guideline_dt2 date null, regimen_type int, preferred int,   
\par \hich\af4\dbch\af31505\loch\f4 ESQC int, wtd_esqc1 float, wtd_esqc2 float, wtd_esqc3 float, wtd_esqc4 float,   
\par \hich\af4\dbch\af31505\loch\f4 rank int,   total_trt in\hich\af4\dbch\af31505\loch\f4 t,   fr_rank float, fr_rank_revrs float, 
\par \hich\af4\dbch\af31505\loch\f4 --trtgiven 
\par \hich\af4\dbch\af31505\loch\f4 choice bit,trtinit_dt date null,  regprob float, st_wts float, wins_st_wts float--, quar_prob int
\par \hich\af4\dbch\af31505\loch\f4 );
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX pchars ON IN_aim1_model_mm1_s2;
\par 
\par \hich\af4\dbch\af31505\loch\f4 --select distinct trtreg, count(distinct bene_ID) as benes from IN_aim1_modeldt_mm1_sm group by trtreg order by trtreg
\par \hich\af4\dbch\af31505\loch\f4 with mrgd as (select distinct a.*, 
\par \hich\af4\dbch\af31505\loch\f4 [27001],    [27002],    [27004],    [27006],    [27009],    [27082] from
\par \hich\af4\dbch\af31505\loch\f4 IN_aim1_modeldt_mm1_sm a left join IN_aim1_modeldt_mm1_sm_4s2 b on a.bene_ID = b.BENE_ID)
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,regspec as (
\par \hich\af4\dbch\af31505\loch\f4 select distinct bene_ID, trtreg, [27001] as regprob, 27001 as reg from mrgd union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [27002] as regprob, 27002 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select disti\hich\af4\dbch\af31505\loch\f4 nct bene_ID, trtreg, [27004] as regprob, 27004 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [27006] as regprob, 27006 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [27009] as regprob, 27009 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [27082] as regprob, 27082 as reg from mrgd))   
\par 
\par \hich\af4\dbch\af31505\loch\f4 , regsspec_f as (select distinct bene_ID, reg, regprob from regspec) --where trtreg = reg)
\par \hich\af4\dbch\af31505\loch\f4 --select top 50 * from regsspec_f order by bene_id
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,mm1 as (select distinct BENE_ID, trtreg, cance\hich\af4\dbch\af31505\loch\f4 r_scen, total_physician_margin_hm, (total_physician_margin_hm/100) as total_physician_margin_hm_100d , 
\par \hich\af4\dbch\af31505\loch\f4     total_physician_margin_lm, (total_physician_margin_lm/100) as total_physician_margin_lm_100d , guideline_dt, guideline_dt2, regimen_type, preferred, ESQC, wtd_esqc1, wtd_esqc2, wtd_esqc3, wtd_esqc4,   
\par \hich\af4\dbch\af31505\loch\f4     rank, total_trt, fr_rank, fr_rank_revrs, choice,trtinit_dt from 
\par \hich\af4\dbch\af31505\loch\f4 IN_aim1_modeldt where cancer_scen = 'mm1' ) 
\par 
\par \hich\af4\dbch\af31505\loch\f4 , mm1_f as (select distinct a.*, b.regprob from 
\par \hich\af4\dbch\af31505\loch\f4 mm1 a inner join regsspec_f b on a.ben\hich\af4\dbch\af31505\loch\f4 e_ID = b.bene_ID and a.trtreg = b.reg) 
\par 
\par \hich\af4\dbch\af31505\loch\f4 , mm1_f2 as (select distinct *, 
\par \hich\af4\dbch\af31505\loch\f4 (case when trtreg = 27001  then (0.55 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 27002  then (0.165 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 27004  then (0.032 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 27006  then (0.122 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 27009  then (0.072 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 27082  then (0.058 /regprob) end) as st_wts
\par \hich\af4\dbch\af31505\loch\f4 from mm1_f)
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,prcnls as (SELECT trtreg--trtreg, st_wts, PERCENT_RANK() OVER(PARTITION BY trtreg ORDER BY st_wts) AS Pctst_wts,
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.05) WITHIN GROUP (ORDER BY st_wts) OVER (PARTITION BY trtreg) as p5
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.94) WITHIN GROUP (ORDER BY st_wts) OVER (PARTITION BY trtreg) as p94
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.95) WITHIN \hich\af4\dbch\af31505\loch\f4 GROUP (ORDER BY st_wts) OVER (PARTITION BY trtreg) as p95
\par \hich\af4\dbch\af31505\loch\f4   FROM mm1_f2)
\par \hich\af4\dbch\af31505\loch\f4 -- select distinct trtreg, p5, p94, p95 from prcnls 
\par \hich\af4\dbch\af31505\loch\f4 ,mm1_f3 as (select distinct a.*, b.p5, b.p95 from
\par \hich\af4\dbch\af31505\loch\f4               mm1_f2 a left join prcnls b on a.trtreg = b.trtreg)
\par \hich\af4\dbch\af31505\loch\f4 -- select top 50 * from mm1_f3 order by bene_ID
\par \hich\af4\dbch\af31505\loch\f4 ,mm1_f4 as (select *, (case when st_wts >= p95 then p95
\par \hich\af4\dbch\af31505\loch\f4                             when st_wts <= p5  then p5
\par \hich\af4\dbch\af31505\loch\f4                             else st_wts end) as wins_st_wts from mm1_f3)
\par \hich\af4\dbch\af31505\loch\f4 --select count(*) from mm1_f4
\par \hich\af4\dbch\af31505\loch\f4 insert i\hich\af4\dbch\af31505\loch\f4 nto IN_aim1_model_mm1_s2
\par \hich\af4\dbch\af31505\loch\f4 select top 17819 BENE_ID, trtreg, cancer_scen, total_physician_margin_hm, total_physician_margin_hm_100d , 
\par \hich\af4\dbch\af31505\loch\f4     total_physician_margin_lm, total_physician_margin_lm_100d , guideline_dt, guideline_dt2, regimen_type, preferred, ESQC, wtd_esqc1, wtd_esqc2, wtd_esqc3, wtd_esqc4,   
\par \hich\af4\dbch\af31505\loch\f4     rank, total_trt, fr_rank, fr_rank_revrs, choice,trtinit_dt, regprob, st_wts, wins_st_wts 
\par \hich\af4\dbch\af31505\loch\f4     from mm1_f4 order by BENE_ID
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 *****************************************************************;
\par \hich\af4\dbch\af31505\loch\f4 *************************  S2 model *****************************;
\par \hich\af4\dbch\af31505\loch\f4 *****************************************************************;
\par 
\par \hich\af4\dbch\af31505\loch\f4 EXEC sp_execute_external_script
\par \hich\af4\dbch\af31505\loch\f4 @language =N'R',
\par \hich\af4\dbch\af31505\loch\f4 @script=N'
\par \hich\af4\dbch\af31505\loch\f4     library(mlogit)
\par \hich\af4\dbch\af31505\loch\f4     library(dplyr)
\par \hich\af4\dbch\af31505\loch\f4     library(Formula)
\par \hich\af4\dbch\af31505\loch\f4     TM <- dfidx(inputdata, idx=c("BENE_ID","trtreg"), alt.var = "trtreg", pkg = "mlogit")
\par \hich\af4\dbch\af31505\loch\f4     m1 <- mlogit(choice ~ total_physician_margin_hm_100d + fr_rank_revrs| 1 , weights = wins_st_wts,\hich\af4\dbch\af31505\loch\f4  TM)
\par \hich\af4\dbch\af31505\loch\f4     print( summary(m1)) 
\par \hich\af4\dbch\af31505\loch\f4     print(confint(m1));'
\par \hich\af4\dbch\af31505\loch\f4         , @input_data_1 = N'select * from Medicare.dbo.IN_aim1_model_mm1_s2'
\par \hich\af4\dbch\af31505\loch\f4         , @input_data_1_name = N'inputdata';
\par 
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 *******************************;
\par \hich\af4\dbch\af31505\loch\f4 ************* mm2 *************;
\par \hich\af4\dbch\af31505\loch\f4 *******************************;
\par 
\par \hich\af4\dbch\af31505\loch\f4 ********* get table for stage1 - can call disease risk group modeling;
\par \hich\af4\dbch\af31505\loch\f4 drop table IN_aim1_modeldt_mm2_sm
\par \hich\af4\dbch\af31505\loch\f4 Create table Medicare.dbo.IN_aim1_modeldt_mm2_sm (
\par \hich\af4\dbch\af31505\loch\f4             BENE_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL, year_diag varchar(4), geo varchar(10), metro varchar(1), 
\par \hich\af4\dbch\af31505\loch\f4             trtreg int, guideline_dt date, choice bit,  total_physician_margin_hm int, nci_index float, frail_score float, 
\par \hich\af4\dbch\af31505\loch\f4             age int,  BENE_RACE_CD int, --RTI_RACE_CD int, 
\par \hich\af4\dbch\af31505\loch\f4             race_4cat varchar(15),  SEX_IDENT_CD varchar(1), LIS_status varchar(25), med_cats varchar(16), pov_cat varchar(30),
\par \hich\af4\dbch\af31505\loch\f4             spec varchar (200), QUARTILE_pnpi varchar(1), npigndr v\hich\af4\dbch\af31505\loch\f4 archar (1), npigrd_yr int, npi_cats varchar(14),
\par \hich\af4\dbch\af31505\loch\f4             spec_2cat varchar (200), LIS_status_2cat varchar(25), SNo int,
\par 
\par \hich\af4\dbch\af31505\loch\f4 );
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX pcharsml ON IN_aim1_modeldt_mm2_sm;
\par 
\par \hich\af4\dbch\af31505\loch\f4 with reg_benes as (select distinct trtreg, count (distinct bene_ID) as benes from IN_aim1_modeldt 
\par \hich\af4\dbch\af31505\loch\f4                    where cancer_scen = 'mm2' and choice = 1 group by trtreg)
\par \hich\af4\dbch\af31505\loch\f4     ,foreligreg as (select distinct a.*, b.benes from
\par \hich\af4\dbch\af31505\loch\f4                    IN_aim1_modeldt a inner join reg_benes b on a.trtreg = b.tr\hich\af4\dbch\af31505\loch\f4 treg where a.cancer_scen = 'mm2')
\par \hich\af4\dbch\af31505\loch\f4     ,elig_reg as (select * from foreligreg where benes >20)
\par \hich\af4\dbch\af31505\loch\f4     ,fl as (select distinct bene_ID, count(distinct choice) as fl from elig_reg group by bene_ID)
\par \hich\af4\dbch\af31505\loch\f4     ,foreligbene as (select distinct a.*, b.fl from
\par \hich\af4\dbch\af31505\loch\f4                       elig_reg a left join fl b on a.BENE_ID = b.bene_ID)               
\par \hich\af4\dbch\af31505\loch\f4 --select count(*), count(distinct bene_ID) as benes from foreligbene where fl =2
\par \hich\af4\dbch\af31505\loch\f4     insert into IN_aim1_modeldt_mm2_sm --IN_aim1 as (
\par \hich\af4\dbch\af31505\loch\f4         select BENE_ID, year_diag, geo, metr\hich\af4\dbch\af31505\loch\f4 o, trtreg, guideline_dt, choice, total_physician_margin_hm, 
\par \hich\af4\dbch\af31505\loch\f4         nci_index, frail_score, age, bene_race_cd, --RTI_RACE_CD, 
\par \hich\af4\dbch\af31505\loch\f4         race_4cat, SEX_IDENT_CD, LIS_status, med_cats, pov_cat, spec, QUARTILE_pnpi, npigndr, npigrd_yr, npi_cats,
\par \hich\af4\dbch\af31505\loch\f4         spec_2cat, LIS_status_2cat,
\par \hich\af4\dbch\af31505\loch\f4         ROW_NUMBER() OVER(ORDER BY (bene_ID)) AS SNo from foreligbene where fl = 2 and choice = 1
\par \hich\af4\dbch\af31505\loch\f4 --select count(distinct bene_ID), count(distinct trtreg) from IN_aim1_modeldt_mm2_sm
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 --select distinct trtreg from IN_aim1_modeldt_mm2_sm order by trtreg
\par \hich\af4\dbch\af31505\loch\f4 drop table IN_aim1_modeldt_mm2_sm_4s2
\par \hich\af4\dbch\af31505\loch\f4 Create table Medicare.dbo.IN_aim1_modeldt_mm2_sm_4s2 (
\par \hich\af4\dbch\af31505\loch\f4             BE\hich\af4\dbch\af31505\loch\f4 NE_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL,
\par \hich\af4\dbch\af31505\loch\f4 [27011] float,  [27012] float,  [27013] float,  [27015] float,  [27017] float,  [27018] float,  [27088] float);
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX pcharsml ON IN_aim1_modeldt_mm2_sm_4s2;
\par 
\par \hich\af4\dbch\af31505\loch\f4 insert into IN_aim1_modeldt_mm2_sm_4s2
\par \hich\af4\dbch\af31505\loch\f4 --select distinct bene_ID from IN_aim1_modeldt_mm2_sm
\par \hich\af4\dbch\af31505\loch\f4 EXEC sp_execute_external_script
\par \hich\af4\dbch\af31505\loch\f4 @language =N'R',
\par \hich\af4\dbch\af31505\loch\f4 @script=N'
\par \hich\af4\dbch\af31505\loch\f4     library(nnet)
\par \hich\af4\dbch\af31505\loch\f4     library(stats)
\par \hich\af4\dbch\af31505\loch\f4     rownames(inputdata) <- inputdata$BENE_ID
\par \hich\af4\dbch\af31505\loch\f4     test <- multinom(trt\hich\af4\dbch\af31505\loch\f4 reg ~ year_diag + SEX_IDENT_CD + race_4cat + LIS_status_2cat + metro +  med_cats + pov_cat + geo + 
\par \hich\af4\dbch\af31505\loch\f4                                age + frail_score + nci_index + spec_2cat + QUARTILE_pnpi + npigndr + npi_cats, data = inputdata)    
\par \hich\af4\dbch\af31505\loch\f4     inputdata$regpredprob <- predict(test, newdata = inputdata, "probs")
\par \hich\af4\dbch\af31505\loch\f4     #print(head(inputdata$regpredprob ))
\par \hich\af4\dbch\af31505\loch\f4     coeff_out <-data.frame(inputdata$regpredprob);
\par \hich\af4\dbch\af31505\loch\f4     #print(head(coeff_out))
\par \hich\af4\dbch\af31505\loch\f4     outputdata <- cbind(row.names(coeff_out),coeff_out);'
\par \hich\af4\dbch\af31505\loch\f4     , @input_data_1 = N'select * from Medicare.dbo.IN_aim1_modeldt_mm2_sm'
\par \hich\af4\dbch\af31505\loch\f4     , @input_data_1_name = N'inputdata'
\par \hich\af4\dbch\af31505\loch\f4     , @output_data_1_name = N'outputdata'
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 **************** get data for stage 2 model ******************;
\par \hich\af4\dbch\af31505\loch\f4     Drop table Medicare.dbo.IN_aim1_model_mm2_s2 
\par \hich\af4\dbch\af31505\loch\f4     Create table Medicare.dbo.IN_aim1_model_mm2_s2 (
\par \hich\af4\dbch\af31505\loch\f4             BENE_ID varchar(15) COLLATE SQL_Latin1_General_CP1_CS_AS NULL,trtreg int,cancer_scen varchar(200),
\par \hich\af4\dbch\af31505\loch\f4 total_physician_m\hich\af4\dbch\af31505\loch\f4 argin_hm float,  total_physician_margin_hm_100d float, 
\par \hich\af4\dbch\af31505\loch\f4 total_physician_margin_lm float,  total_physician_margin_lm_100d float,
\par \hich\af4\dbch\af31505\loch\f4 guideline_dt date null, guideline_dt2 date null, regimen_type int, preferred int,   
\par \hich\af4\dbch\af31505\loch\f4 ESQC int, wtd_esqc1 float, wtd_esqc2 float, wtd_esqc3 float, wtd_esqc4 float,   
\par \hich\af4\dbch\af31505\loch\f4 rank int,   total_trt int,   fr_rank float, fr_rank_revrs float, 
\par \hich\af4\dbch\af31505\loch\f4 --trtgiven 
\par \hich\af4\dbch\af31505\loch\f4 choice bit,trtinit_dt date null,  regprob float, st_wts float, wins_st_wts float--, quar_prob int
\par \hich\af4\dbch\af31505\loch\f4 );
\par \hich\af4\dbch\af31505\loch\f4     CREATE CLUSTERED COLUMNSTORE INDEX \hich\af4\dbch\af31505\loch\f4 pchars ON IN_aim1_model_mm2_s2;
\par 
\par \hich\af4\dbch\af31505\loch\f4 --select distinct trtreg, count(distinct bene_ID) as benes from IN_aim1_modeldt_mm2_sm group by trtreg order by trtreg
\par \hich\af4\dbch\af31505\loch\f4 with mrgd as (select distinct a.*, 
\par \hich\af4\dbch\af31505\loch\f4 [27011],    [27012],    [27013],    [27015],    [27017],    [27018],    [27088] from
\par \hich\af4\dbch\af31505\loch\f4 IN_aim1_modeldt_mm2_sm a left join IN_aim1_modeldt_mm2_sm_4s2 b on a.bene_ID = b.BENE_ID)
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,regspec as (
\par \hich\af4\dbch\af31505\loch\f4 select distinct bene_ID, trtreg, [27011] as regprob, 27011 as reg from mrgd union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [27012] as regprob, 27012 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [27013] as regprob, 27013 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [27015] as regprob, 27015 as reg from \hich\af4\dbch\af31505\loch\f4 mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [27017] as regprob, 27017 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [27018] as regprob, 27018 as reg from mrgd) union
\par \hich\af4\dbch\af31505\loch\f4 (select distinct bene_ID, trtreg, [27088] as regprob, 27088 as reg from mrgd))   
\par 
\par \hich\af4\dbch\af31505\loch\f4 , regsspec_f as (select distinct bene_ID, reg, regprob from regspec) --where trtreg = reg)
\par \hich\af4\dbch\af31505\loch\f4 --select top 50 * from regsspec_f order by bene_id
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,mm2 as (select distinct BENE_ID, trtreg, cancer_scen, total_physician_margin_hm, (total_physician_margin_\hich\af4\dbch\af31505\loch\f4 hm/100) as total_physician_margin_hm_100d , 
\par \hich\af4\dbch\af31505\loch\f4     total_physician_margin_lm, (total_physician_margin_lm/100) as total_physician_margin_lm_100d , guideline_dt, guideline_dt2, regimen_type, preferred, ESQC, wtd_esqc1, wtd_esqc2, wtd_esqc3, wtd_esqc4,   
\par \hich\af4\dbch\af31505\loch\f4     rank, total_trt, fr_rank, fr_rank_revrs, choice,trtinit_dt from 
\par \hich\af4\dbch\af31505\loch\f4 IN_aim1_modeldt where cancer_scen = 'mm2' ) 
\par 
\par \hich\af4\dbch\af31505\loch\f4 , mm2_f as (select distinct a.*, b.regprob from 
\par \hich\af4\dbch\af31505\loch\f4 mm2 a inner join regsspec_f b on a.bene_ID = b.bene_ID and a.trtreg = b.reg) 
\par 
\par \hich\af4\dbch\af31505\loch\f4 , mm2_f2 as (selec\hich\af4\dbch\af31505\loch\f4 t distinct *, 
\par \hich\af4\dbch\af31505\loch\f4 (case when trtreg = 27011  then (0.337 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 27012  then (0.193 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 27013  then (0.119 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 27015  then (0.006 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 27017  then (0.007 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 27018  then (0.25 /regprob)
\par \hich\af4\dbch\af31505\loch\f4 when trtreg = 27088  then (0.088 /regprob) end) as st_wts
\par \hich\af4\dbch\af31505\loch\f4 from mm2_f)
\par 
\par \hich\af4\dbch\af31505\loch\f4 ,prcnls as (SELECT trtreg--trtreg, st_wts, PERCENT_RANK() OVER(PARTITION BY trtreg ORDER BY st_wts) AS Pctst_wts,
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.05) WITHIN GROUP (ORDER BY st_wts) OVER (PARTITION BY trtreg) as p5
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.94) WITHIN GROUP (ORDER BY st_wts) OVER (PARTITION BY trtreg) as p94
\par \hich\af4\dbch\af31505\loch\f4             ,PERCENTILE_CONT(0.95) WITHIN G\hich\af4\dbch\af31505\loch\f4 ROUP (ORDER BY st_wts) OVER (PARTITION BY trtreg) as p95
\par \hich\af4\dbch\af31505\loch\f4   FROM mm2_f2)
\par \hich\af4\dbch\af31505\loch\f4 -- select distinct trtreg, p5, p94, p95 from prcnls 
\par \hich\af4\dbch\af31505\loch\f4 ,mm2_f3 as (select distinct a.*, b.p5, b.p95 from
\par \hich\af4\dbch\af31505\loch\f4               mm2_f2 a left join prcnls b on a.trtreg = b.trtreg)
\par \hich\af4\dbch\af31505\loch\f4 -- select top 50 * from mm2_f3 order by bene_ID
\par \hich\af4\dbch\af31505\loch\f4 ,mm2_f4 as (select *, (case when st_wts >= p95 then p95
\par \hich\af4\dbch\af31505\loch\f4                             when st_wts <= p5  then p5
\par \hich\af4\dbch\af31505\loch\f4                             else st_wts end) as wins_st_wts from mm2_f3)
\par \hich\af4\dbch\af31505\loch\f4 --select count(*) from mm2_f4
\par \hich\af4\dbch\af31505\loch\f4 insert in\hich\af4\dbch\af31505\loch\f4 to IN_aim1_model_mm2_s2
\par \hich\af4\dbch\af31505\loch\f4 select top 20578 BENE_ID, trtreg, cancer_scen, total_physician_margin_hm, total_physician_margin_hm_100d , 
\par \hich\af4\dbch\af31505\loch\f4     total_physician_margin_lm, total_physician_margin_lm_100d , guideline_dt, guideline_dt2, regimen_type, preferred, ESQC, wtd_esqc1, wtd_esqc2, wtd_esqc3, wtd_esqc4,   
\par \hich\af4\dbch\af31505\loch\f4     rank, total_trt, fr_rank, fr_rank_revrs, choice,trtinit_dt, regprob, st_wts, wins_st_wts 
\par \hich\af4\dbch\af31505\loch\f4     from mm2_f4 order by BENE_ID
\par 
\par 
\par \hich\af4\dbch\af31505\loch\f4 *****************************************************************;
\par \hich\af4\dbch\af31505\loch\f4 *************************  S2 model *****************************;
\par \hich\af4\dbch\af31505\loch\f4 *****************************************************************;
\par 
\par \hich\af4\dbch\af31505\loch\f4 EXEC sp_execute_external_script
\par \hich\af4\dbch\af31505\loch\f4 @language =N'R',
\par \hich\af4\dbch\af31505\loch\f4 @script=N'
\par \hich\af4\dbch\af31505\loch\f4     library(mlogit)
\par \hich\af4\dbch\af31505\loch\f4     library(dplyr)
\par \hich\af4\dbch\af31505\loch\f4     library(Formula)
\par \hich\af4\dbch\af31505\loch\f4     TM <- dfidx(inputdata, idx=c("BENE_ID","trtreg"), alt.var = "trtreg", pkg = "mlogit")
\par \hich\af4\dbch\af31505\loch\f4     m1 <- mlogit(choice ~ total_physician_margin_hm_100d + fr_rank_revrs| 1 , weights = wins_st_wts,\hich\af4\dbch\af31505\loch\f4  TM)
\par \hich\af4\dbch\af31505\loch\f4     print( summary(m1)) 
\par \hich\af4\dbch\af31505\loch\f4     print(confint(m1));'
\par \hich\af4\dbch\af31505\loch\f4         , @input_data_1 = N'select * from Medicare.dbo.IN_aim1_model_mm2_s2'
\par \hich\af4\dbch\af31505\loch\f4         , @input_data_1_name = N'inputdata';}{\rtlch\fcs1 \af4 \ltrch\fcs0 \f4\kerning0\insrsid6620941 
\par }{\*\themedata 504b030414000600080000002100e9de0fbfff0000001c020000130000005b436f6e74656e745f54797065735d2e786d6cac91cb4ec3301045f748fc83e52d4a
9cb2400825e982c78ec7a27cc0c8992416c9d8b2a755fbf74cd25442a820166c2cd933f79e3be372bd1f07b5c3989ca74aaff2422b24eb1b475da5df374fd9ad
5689811a183c61a50f98f4babebc2837878049899a52a57be670674cb23d8e90721f90a4d2fa3802cb35762680fd800ecd7551dc18eb899138e3c943d7e503b6
b01d583deee5f99824e290b4ba3f364eac4a430883b3c092d4eca8f946c916422ecab927f52ea42b89a1cd59c254f919b0e85e6535d135a8de20f20b8c12c3b0
0c895fcf6720192de6bf3b9e89ecdbd6596cbcdd8eb28e7c365ecc4ec1ff1460f53fe813d3cc7f5b7f020000ffff0300504b030414000600080000002100a5d6
a7e7c0000000360100000b0000005f72656c732f2e72656c73848fcf6ac3300c87ef85bd83d17d51d2c31825762fa590432fa37d00e1287f68221bdb1bebdb4f
c7060abb0884a4eff7a93dfeae8bf9e194e720169aaa06c3e2433fcb68e1763dbf7f82c985a4a725085b787086a37bdbb55fbc50d1a33ccd311ba548b6309512
0f88d94fbc52ae4264d1c910d24a45db3462247fa791715fd71f989e19e0364cd3f51652d73760ae8fa8c9ffb3c330cc9e4fc17faf2ce545046e37944c69e462
a1a82fe353bd90a865aad41ed0b5b8f9d6fd010000ffff0300504b0304140006000800000021006b799616830000008a0000001c0000007468656d652f746865
6d652f7468656d654d616e616765722e786d6c0ccc4d0ac3201040e17da17790d93763bb284562b2cbaebbf600439c1a41c7a0d29fdbd7e5e38337cedf14d59b
4b0d592c9c070d8a65cd2e88b7f07c2ca71ba8da481cc52c6ce1c715e6e97818c9b48d13df49c873517d23d59085adb5dd20d6b52bd521ef2cdd5eb9246a3d8b
4757e8d3f729e245eb2b260a0238fd010000ffff0300504b03041400060008000000210094a9528694070000c7200000160000007468656d652f7468656d652f
7468656d65312e786d6cec595f8b1bc9117f0fe43b0cf32e6b66248da4c5f2a1bfdeb3776d63c90ef7d82bb566dadb333d4cb7762d8e83e07bca4b207077e421
0779cb430839c8418ebce4c3186c92cb874875cf68d42db5bc7f30c184dd7dd1b47e55fd9baaeaaa52f5fdcf5e27d4b9c039272cedb9fe3dcf75703a670b9246
3df7c56c52ebb80e17285d20ca52dc73d798bb9f3df8e52feea32311e3043b209ff223d4736321b2a37a9dcf6119f17b2cc3297cb7647982043ce6517d91a34b
d09bd07ae079613d4124759d1425a0f6e97249e6d8994995ee838df23185c75470b930a7f954aac68684c22ece7d89e06b3ea4b9738168cf857d16ec72865f0b
d7a1880bf8a2e77aeacfad3fb85f4747a51015076435b989fa2be54a81c579a0f6cca3b36a536f1c749a7ea55f01a8d8c78d3bf2bfd2a700683e87372db8e83a
fd56e8758212ab818a8f16ddddb6df30f19afec61e67bf1b0e82a6a15f810afdcd3dbc37e98e472d03af4005beb587ef7bc1a0db30f00a54e0c33d7c73dc6f07
6303af403125e9f93e3a6c773a6189ae204b468fadf06e187aed5109dfa2201aaae8925b2c592a0ec55a825eb17c020009a44890d411eb0c2fd11ca2b89f09c6
9d11e119456bd7c950ca382c7b81ef43e835bda0fa571647471869d2921730e17b4b928fc3e739c944cf7d045a5d0df2eea79fdebef9f1ed9bbfbffdfaebb76f
feea9c902816852a43ee18a5912ef7f39f7ef79fef7fedfcfb6f7ffcf99b6fed78aee3dfffe537effff1cf0fa987a3b635c5bbef7e78ffe30fef7effdb7ffdf9
1b8bf67e8ece74f88c24983b4ff0a5f39c25f082ca14267f7c96df4c621623a24bf4d388a314c95d2cfac72236d04fd688220b6e804d3bbecc21d5d8800f57af
0cc2d3385f0962d1f8384e0ce0296374c072ab151ecbbd3433cf566964df3c5fe9b8e7085dd8f61ea2d4f0f27895418e253695c3181b349f51940a14e1140b47
7ec7ce31b6bcdd178418763d25f39c71b614ce17c419206235c98c9c19d1b4153a2609f8656d2308fe366c73fad219306a7beb11be3091703610b5909f616a98
f1215a0994d854ce504275839f2011db484ed7f95cc78db9004f47983267bcc09cdb649ee6f0be9ad31f23c86e56b79fd27562227341ce6d3a4f10633a72c4ce
87314a321b764ad258c77ececf214491f38c091bfc949927443e831f507ad0dd2f0936dc7d75367801594ea7b40d10f9cd2ab7f8f2216646fc4ed77489b02dd5
f4f3c448b1fd9c58a363b08a8cd03ec198a24bb4c0d879f1b985c1806586cdb7a41fc590558eb12db01e213356e5738a39f44ab2b9d9cf9327841b213bc5113b
c0e774bd9378d6284d507e48f313f0ba6ef3f1590e87d142e1299d9febc027047a408817ab519e72d0a105f741adcf62641430f9ccedf1bace0dff5de78cc1b9
7c65d0b8c6b904197c631948ecbacc076d3343d4d8601b3033449c135bba0511c3fd5b11595c95d8ca2ab7340fedd60dd01d194d4f42d22b3aa0ff5de703fdc5
bb3f7c6f09c18fd3edd8151ba9ea867dcea15472bcd3dd1cc2edf63443962fc8a7dfd28cd02a7d86a18aece7abbb8ee6aea371ffef3b9a43e7f9ae8f39d46ddc
f5312ef417777d4c395af9387dccb67581ae468e178a318f1afa2407673e4b42e954ac293ee16aecc3e1d7cc62028b524ecd3b713503cc62f828cb1c6c60e0a2
1c29192767e25744c4d31865301bf25da924e2a5ea883b19e3303252cb56dd124f57c9295b14a34e355bf28acaca91d8ae7b2d183a15eb30a612053a6c978b92
9f9aa7025fc5365263d60d01297b1312da6626898685447bb37805093935fb382cba16161da97ee3aa3d5300b5ca2bf073db811fe93db7d594846046cee7d09a
2fa49f0a576fbcab9cf9313d7dc8984604c058b1781318ca579eee4aae075f4fbe5d116ad7f0b4414239a5082b9384b28c6af0780c3f82cbe894abd7a171535f
77b72e35e84953a8fd20beb734da9d0fb1b8adaf416e3737d054cf1434752e7b6ed86841c8cc51d673973032868f4906b1c3e52f2e4423b877998bbc38f0b7c9
2c59cec508f1b830b84a3a857b122270ee5092f45cf9fa951b68aa7288e2e60790103e59725d482b9f1a3970bae964bc5ce2b9d0ddaead484b178f90e18b5c61
fd5689df1e2c25d90adc3d8d1797ce195de5cf118458abed4b032e08879b03bfb0e682c0555895c8b6f1b75398cae4afdf45a9182ad611cd625456143d991770
554f2a3aeaa9b281f654be33185433495908cf22596075a31ad5b42a5d05878355f76a2169392d696e6ba6915564d5b4673163874d19d8b1e5ed8abcc66a6362
c8697a852f52f76ecaed6e72dd4e9f505509307865bfdb957e8dda7633839a64bc9f8665ce2e57cddab179c12ba85da74868593fdca8ddb15b5523acdbc1e2ad
2a3fc8ed462d2c2d377da5b2b4ba33d7afb5d9d92b481e23e872575470e54a98ebe608bab2a9ea498ab40147e4b5288f067c725639e9b95f7aad7e7318b48635
afd31ad79a8da657ebb4fa8d5abfd56af8e396ef8d06c1575058449cf8ade2be7e02d717745ddedaabf5bd9bfb647343736fce923a5337f375455cdddcfbc1e1
9b7b8740d2f93218fbcda01f0c6bc3911fd69ac128ac75da8d7e6d1884a3a00f293d9cf4bf729d0b05f607a3d164d20a6ae110704dafdfaaf5078d612dec8c07
c1c41f37471e80cbccf91afa6fb0e9c616f051f17af05f000000ffff0300504b0304140006000800000021000dd1909fb60000001b010000270000007468656d
652f7468656d652f5f72656c732f7468656d654d616e616765722e786d6c2e72656c73848f4d0ac2301484f78277086f6fd3ba109126dd88d0add40384e4350d
363f2451eced0dae2c082e8761be9969bb979dc9136332de3168aa1a083ae995719ac16db8ec8e4052164e89d93b64b060828e6f37ed1567914b284d26245228
2e3198720e274a939cd08a54f980ae38a38f56e422a3a641c8bbd048f7757da0f19b017cc524bd62107bd5001996509affb3fd381a89672f1f165dfe514173d9
850528a2c6cce0239baa4c04ca5bbabac4df000000ffff0300504b01022d0014000600080000002100e9de0fbfff0000001c0200001300000000000000000000
000000000000005b436f6e74656e745f54797065735d2e786d6c504b01022d0014000600080000002100a5d6a7e7c0000000360100000b000000000000000000
00000000300100005f72656c732f2e72656c73504b01022d00140006000800000021006b799616830000008a0000001c00000000000000000000000000190200
007468656d652f7468656d652f7468656d654d616e616765722e786d6c504b01022d001400060008000000210094a9528694070000c720000016000000000000
00000000000000d60200007468656d652f7468656d652f7468656d65312e786d6c504b01022d00140006000800000021000dd1909fb60000001b010000270000
00000000000000000000009e0a00007468656d652f7468656d652f5f72656c732f7468656d654d616e616765722e786d6c2e72656c73504b050600000000050005005d010000990b00000000}
{\*\colorschememapping 3c3f786d6c2076657273696f6e3d22312e302220656e636f64696e673d225554462d3822207374616e64616c6f6e653d22796573223f3e0d0a3c613a636c724d
617020786d6c6e733a613d22687474703a2f2f736368656d61732e6f70656e786d6c666f726d6174732e6f72672f64726177696e676d6c2f323030362f6d6169
6e22206267313d226c743122207478313d22646b3122206267323d226c743222207478323d22646b322220616363656e74313d22616363656e74312220616363
656e74323d22616363656e74322220616363656e74333d22616363656e74332220616363656e74343d22616363656e74342220616363656e74353d22616363656e74352220616363656e74363d22616363656e74362220686c696e6b3d22686c696e6b2220666f6c486c696e6b3d22666f6c486c696e6b222f3e}
{\*\latentstyles\lsdstimax376\lsdlockeddef0\lsdsemihiddendef0\lsdunhideuseddef0\lsdqformatdef0\lsdprioritydef99{\lsdlockedexcept \lsdqformat1 \lsdpriority0 \lsdlocked0 Normal;\lsdqformat1 \lsdpriority9 \lsdlocked0 heading 1;
\lsdsemihidden1 \lsdunhideused1 \lsdqformat1 \lsdpriority9 \lsdlocked0 heading 2;\lsdsemihidden1 \lsdunhideused1 \lsdqformat1 \lsdpriority9 \lsdlocked0 heading 3;\lsdsemihidden1 \lsdunhideused1 \lsdqformat1 \lsdpriority9 \lsdlocked0 heading 4;
\lsdsemihidden1 \lsdunhideused1 \lsdqformat1 \lsdpriority9 \lsdlocked0 heading 5;\lsdsemihidden1 \lsdunhideused1 \lsdqformat1 \lsdpriority9 \lsdlocked0 heading 6;\lsdsemihidden1 \lsdunhideused1 \lsdqformat1 \lsdpriority9 \lsdlocked0 heading 7;
\lsdsemihidden1 \lsdunhideused1 \lsdqformat1 \lsdpriority9 \lsdlocked0 heading 8;\lsdsemihidden1 \lsdunhideused1 \lsdqformat1 \lsdpriority9 \lsdlocked0 heading 9;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 index 1;
\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 index 2;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 index 3;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 index 4;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 index 5;
\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 index 6;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 index 7;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 index 8;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 index 9;
\lsdsemihidden1 \lsdunhideused1 \lsdpriority39 \lsdlocked0 toc 1;\lsdsemihidden1 \lsdunhideused1 \lsdpriority39 \lsdlocked0 toc 2;\lsdsemihidden1 \lsdunhideused1 \lsdpriority39 \lsdlocked0 toc 3;
\lsdsemihidden1 \lsdunhideused1 \lsdpriority39 \lsdlocked0 toc 4;\lsdsemihidden1 \lsdunhideused1 \lsdpriority39 \lsdlocked0 toc 5;\lsdsemihidden1 \lsdunhideused1 \lsdpriority39 \lsdlocked0 toc 6;
\lsdsemihidden1 \lsdunhideused1 \lsdpriority39 \lsdlocked0 toc 7;\lsdsemihidden1 \lsdunhideused1 \lsdpriority39 \lsdlocked0 toc 8;\lsdsemihidden1 \lsdunhideused1 \lsdpriority39 \lsdlocked0 toc 9;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Normal Indent;
\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 footnote text;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 annotation text;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 header;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 footer;
\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 index heading;\lsdsemihidden1 \lsdunhideused1 \lsdqformat1 \lsdpriority35 \lsdlocked0 caption;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 table of figures;
\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 envelope address;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 envelope return;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 footnote reference;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 annotation reference;
\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 line number;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 page number;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 endnote reference;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 endnote text;
\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 table of authorities;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 macro;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 toa heading;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 List;
\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 List Bullet;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 List Number;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 List 2;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 List 3;
\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 List 4;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 List 5;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 List Bullet 2;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 List Bullet 3;
\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 List Bullet 4;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 List Bullet 5;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 List Number 2;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 List Number 3;
\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 List Number 4;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 List Number 5;\lsdqformat1 \lsdpriority10 \lsdlocked0 Title;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Closing;
\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Signature;\lsdsemihidden1 \lsdunhideused1 \lsdpriority1 \lsdlocked0 Default Paragraph Font;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Body Text;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Body Text Indent;
\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 List Continue;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 List Continue 2;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 List Continue 3;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 List Continue 4;
\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 List Continue 5;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Message Header;\lsdqformat1 \lsdpriority11 \lsdlocked0 Subtitle;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Salutation;
\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Date;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Body Text First Indent;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Body Text First Indent 2;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Note Heading;
\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Body Text 2;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Body Text 3;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Body Text Indent 2;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Body Text Indent 3;
\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Block Text;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Hyperlink;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 FollowedHyperlink;\lsdqformat1 \lsdpriority22 \lsdlocked0 Strong;
\lsdqformat1 \lsdpriority20 \lsdlocked0 Emphasis;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Document Map;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Plain Text;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 E-mail Signature;
\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 HTML Top of Form;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 HTML Bottom of Form;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Normal (Web);\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 HTML Acronym;
\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 HTML Address;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 HTML Cite;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 HTML Code;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 HTML Definition;
\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 HTML Keyboard;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 HTML Preformatted;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 HTML Sample;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 HTML Typewriter;
\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 HTML Variable;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Normal Table;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 annotation subject;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 No List;
\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Outline List 1;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Outline List 2;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Outline List 3;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table Simple 1;
\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table Simple 2;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table Simple 3;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table Classic 1;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table Classic 2;
\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table Classic 3;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table Classic 4;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table Colorful 1;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table Colorful 2;
\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table Colorful 3;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table Columns 1;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table Columns 2;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table Columns 3;
\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table Columns 4;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table Columns 5;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table Grid 1;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table Grid 2;
\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table Grid 3;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table Grid 4;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table Grid 5;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table Grid 6;
\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table Grid 7;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table Grid 8;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table List 1;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table List 2;
\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table List 3;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table List 4;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table List 5;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table List 6;
\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table List 7;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table List 8;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table 3D effects 1;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table 3D effects 2;
\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table 3D effects 3;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table Contemporary;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table Elegant;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table Professional;
\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table Subtle 1;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table Subtle 2;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table Web 1;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table Web 2;
\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table Web 3;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Balloon Text;\lsdpriority39 \lsdlocked0 Table Grid;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Table Theme;\lsdsemihidden1 \lsdlocked0 Placeholder Text;
\lsdqformat1 \lsdpriority1 \lsdlocked0 No Spacing;\lsdpriority60 \lsdlocked0 Light Shading;\lsdpriority61 \lsdlocked0 Light List;\lsdpriority62 \lsdlocked0 Light Grid;\lsdpriority63 \lsdlocked0 Medium Shading 1;\lsdpriority64 \lsdlocked0 Medium Shading 2;
\lsdpriority65 \lsdlocked0 Medium List 1;\lsdpriority66 \lsdlocked0 Medium List 2;\lsdpriority67 \lsdlocked0 Medium Grid 1;\lsdpriority68 \lsdlocked0 Medium Grid 2;\lsdpriority69 \lsdlocked0 Medium Grid 3;\lsdpriority70 \lsdlocked0 Dark List;
\lsdpriority71 \lsdlocked0 Colorful Shading;\lsdpriority72 \lsdlocked0 Colorful List;\lsdpriority73 \lsdlocked0 Colorful Grid;\lsdpriority60 \lsdlocked0 Light Shading Accent 1;\lsdpriority61 \lsdlocked0 Light List Accent 1;
\lsdpriority62 \lsdlocked0 Light Grid Accent 1;\lsdpriority63 \lsdlocked0 Medium Shading 1 Accent 1;\lsdpriority64 \lsdlocked0 Medium Shading 2 Accent 1;\lsdpriority65 \lsdlocked0 Medium List 1 Accent 1;\lsdsemihidden1 \lsdlocked0 Revision;
\lsdqformat1 \lsdpriority34 \lsdlocked0 List Paragraph;\lsdqformat1 \lsdpriority29 \lsdlocked0 Quote;\lsdqformat1 \lsdpriority30 \lsdlocked0 Intense Quote;\lsdpriority66 \lsdlocked0 Medium List 2 Accent 1;\lsdpriority67 \lsdlocked0 Medium Grid 1 Accent 1;
\lsdpriority68 \lsdlocked0 Medium Grid 2 Accent 1;\lsdpriority69 \lsdlocked0 Medium Grid 3 Accent 1;\lsdpriority70 \lsdlocked0 Dark List Accent 1;\lsdpriority71 \lsdlocked0 Colorful Shading Accent 1;\lsdpriority72 \lsdlocked0 Colorful List Accent 1;
\lsdpriority73 \lsdlocked0 Colorful Grid Accent 1;\lsdpriority60 \lsdlocked0 Light Shading Accent 2;\lsdpriority61 \lsdlocked0 Light List Accent 2;\lsdpriority62 \lsdlocked0 Light Grid Accent 2;\lsdpriority63 \lsdlocked0 Medium Shading 1 Accent 2;
\lsdpriority64 \lsdlocked0 Medium Shading 2 Accent 2;\lsdpriority65 \lsdlocked0 Medium List 1 Accent 2;\lsdpriority66 \lsdlocked0 Medium List 2 Accent 2;\lsdpriority67 \lsdlocked0 Medium Grid 1 Accent 2;\lsdpriority68 \lsdlocked0 Medium Grid 2 Accent 2;
\lsdpriority69 \lsdlocked0 Medium Grid 3 Accent 2;\lsdpriority70 \lsdlocked0 Dark List Accent 2;\lsdpriority71 \lsdlocked0 Colorful Shading Accent 2;\lsdpriority72 \lsdlocked0 Colorful List Accent 2;\lsdpriority73 \lsdlocked0 Colorful Grid Accent 2;
\lsdpriority60 \lsdlocked0 Light Shading Accent 3;\lsdpriority61 \lsdlocked0 Light List Accent 3;\lsdpriority62 \lsdlocked0 Light Grid Accent 3;\lsdpriority63 \lsdlocked0 Medium Shading 1 Accent 3;\lsdpriority64 \lsdlocked0 Medium Shading 2 Accent 3;
\lsdpriority65 \lsdlocked0 Medium List 1 Accent 3;\lsdpriority66 \lsdlocked0 Medium List 2 Accent 3;\lsdpriority67 \lsdlocked0 Medium Grid 1 Accent 3;\lsdpriority68 \lsdlocked0 Medium Grid 2 Accent 3;\lsdpriority69 \lsdlocked0 Medium Grid 3 Accent 3;
\lsdpriority70 \lsdlocked0 Dark List Accent 3;\lsdpriority71 \lsdlocked0 Colorful Shading Accent 3;\lsdpriority72 \lsdlocked0 Colorful List Accent 3;\lsdpriority73 \lsdlocked0 Colorful Grid Accent 3;\lsdpriority60 \lsdlocked0 Light Shading Accent 4;
\lsdpriority61 \lsdlocked0 Light List Accent 4;\lsdpriority62 \lsdlocked0 Light Grid Accent 4;\lsdpriority63 \lsdlocked0 Medium Shading 1 Accent 4;\lsdpriority64 \lsdlocked0 Medium Shading 2 Accent 4;\lsdpriority65 \lsdlocked0 Medium List 1 Accent 4;
\lsdpriority66 \lsdlocked0 Medium List 2 Accent 4;\lsdpriority67 \lsdlocked0 Medium Grid 1 Accent 4;\lsdpriority68 \lsdlocked0 Medium Grid 2 Accent 4;\lsdpriority69 \lsdlocked0 Medium Grid 3 Accent 4;\lsdpriority70 \lsdlocked0 Dark List Accent 4;
\lsdpriority71 \lsdlocked0 Colorful Shading Accent 4;\lsdpriority72 \lsdlocked0 Colorful List Accent 4;\lsdpriority73 \lsdlocked0 Colorful Grid Accent 4;\lsdpriority60 \lsdlocked0 Light Shading Accent 5;\lsdpriority61 \lsdlocked0 Light List Accent 5;
\lsdpriority62 \lsdlocked0 Light Grid Accent 5;\lsdpriority63 \lsdlocked0 Medium Shading 1 Accent 5;\lsdpriority64 \lsdlocked0 Medium Shading 2 Accent 5;\lsdpriority65 \lsdlocked0 Medium List 1 Accent 5;\lsdpriority66 \lsdlocked0 Medium List 2 Accent 5;
\lsdpriority67 \lsdlocked0 Medium Grid 1 Accent 5;\lsdpriority68 \lsdlocked0 Medium Grid 2 Accent 5;\lsdpriority69 \lsdlocked0 Medium Grid 3 Accent 5;\lsdpriority70 \lsdlocked0 Dark List Accent 5;\lsdpriority71 \lsdlocked0 Colorful Shading Accent 5;
\lsdpriority72 \lsdlocked0 Colorful List Accent 5;\lsdpriority73 \lsdlocked0 Colorful Grid Accent 5;\lsdpriority60 \lsdlocked0 Light Shading Accent 6;\lsdpriority61 \lsdlocked0 Light List Accent 6;\lsdpriority62 \lsdlocked0 Light Grid Accent 6;
\lsdpriority63 \lsdlocked0 Medium Shading 1 Accent 6;\lsdpriority64 \lsdlocked0 Medium Shading 2 Accent 6;\lsdpriority65 \lsdlocked0 Medium List 1 Accent 6;\lsdpriority66 \lsdlocked0 Medium List 2 Accent 6;
\lsdpriority67 \lsdlocked0 Medium Grid 1 Accent 6;\lsdpriority68 \lsdlocked0 Medium Grid 2 Accent 6;\lsdpriority69 \lsdlocked0 Medium Grid 3 Accent 6;\lsdpriority70 \lsdlocked0 Dark List Accent 6;\lsdpriority71 \lsdlocked0 Colorful Shading Accent 6;
\lsdpriority72 \lsdlocked0 Colorful List Accent 6;\lsdpriority73 \lsdlocked0 Colorful Grid Accent 6;\lsdqformat1 \lsdpriority19 \lsdlocked0 Subtle Emphasis;\lsdqformat1 \lsdpriority21 \lsdlocked0 Intense Emphasis;
\lsdqformat1 \lsdpriority31 \lsdlocked0 Subtle Reference;\lsdqformat1 \lsdpriority32 \lsdlocked0 Intense Reference;\lsdqformat1 \lsdpriority33 \lsdlocked0 Book Title;\lsdsemihidden1 \lsdunhideused1 \lsdpriority37 \lsdlocked0 Bibliography;
\lsdsemihidden1 \lsdunhideused1 \lsdqformat1 \lsdpriority39 \lsdlocked0 TOC Heading;\lsdpriority41 \lsdlocked0 Plain Table 1;\lsdpriority42 \lsdlocked0 Plain Table 2;\lsdpriority43 \lsdlocked0 Plain Table 3;\lsdpriority44 \lsdlocked0 Plain Table 4;
\lsdpriority45 \lsdlocked0 Plain Table 5;\lsdpriority40 \lsdlocked0 Grid Table Light;\lsdpriority46 \lsdlocked0 Grid Table 1 Light;\lsdpriority47 \lsdlocked0 Grid Table 2;\lsdpriority48 \lsdlocked0 Grid Table 3;\lsdpriority49 \lsdlocked0 Grid Table 4;
\lsdpriority50 \lsdlocked0 Grid Table 5 Dark;\lsdpriority51 \lsdlocked0 Grid Table 6 Colorful;\lsdpriority52 \lsdlocked0 Grid Table 7 Colorful;\lsdpriority46 \lsdlocked0 Grid Table 1 Light Accent 1;\lsdpriority47 \lsdlocked0 Grid Table 2 Accent 1;
\lsdpriority48 \lsdlocked0 Grid Table 3 Accent 1;\lsdpriority49 \lsdlocked0 Grid Table 4 Accent 1;\lsdpriority50 \lsdlocked0 Grid Table 5 Dark Accent 1;\lsdpriority51 \lsdlocked0 Grid Table 6 Colorful Accent 1;
\lsdpriority52 \lsdlocked0 Grid Table 7 Colorful Accent 1;\lsdpriority46 \lsdlocked0 Grid Table 1 Light Accent 2;\lsdpriority47 \lsdlocked0 Grid Table 2 Accent 2;\lsdpriority48 \lsdlocked0 Grid Table 3 Accent 2;
\lsdpriority49 \lsdlocked0 Grid Table 4 Accent 2;\lsdpriority50 \lsdlocked0 Grid Table 5 Dark Accent 2;\lsdpriority51 \lsdlocked0 Grid Table 6 Colorful Accent 2;\lsdpriority52 \lsdlocked0 Grid Table 7 Colorful Accent 2;
\lsdpriority46 \lsdlocked0 Grid Table 1 Light Accent 3;\lsdpriority47 \lsdlocked0 Grid Table 2 Accent 3;\lsdpriority48 \lsdlocked0 Grid Table 3 Accent 3;\lsdpriority49 \lsdlocked0 Grid Table 4 Accent 3;
\lsdpriority50 \lsdlocked0 Grid Table 5 Dark Accent 3;\lsdpriority51 \lsdlocked0 Grid Table 6 Colorful Accent 3;\lsdpriority52 \lsdlocked0 Grid Table 7 Colorful Accent 3;\lsdpriority46 \lsdlocked0 Grid Table 1 Light Accent 4;
\lsdpriority47 \lsdlocked0 Grid Table 2 Accent 4;\lsdpriority48 \lsdlocked0 Grid Table 3 Accent 4;\lsdpriority49 \lsdlocked0 Grid Table 4 Accent 4;\lsdpriority50 \lsdlocked0 Grid Table 5 Dark Accent 4;
\lsdpriority51 \lsdlocked0 Grid Table 6 Colorful Accent 4;\lsdpriority52 \lsdlocked0 Grid Table 7 Colorful Accent 4;\lsdpriority46 \lsdlocked0 Grid Table 1 Light Accent 5;\lsdpriority47 \lsdlocked0 Grid Table 2 Accent 5;
\lsdpriority48 \lsdlocked0 Grid Table 3 Accent 5;\lsdpriority49 \lsdlocked0 Grid Table 4 Accent 5;\lsdpriority50 \lsdlocked0 Grid Table 5 Dark Accent 5;\lsdpriority51 \lsdlocked0 Grid Table 6 Colorful Accent 5;
\lsdpriority52 \lsdlocked0 Grid Table 7 Colorful Accent 5;\lsdpriority46 \lsdlocked0 Grid Table 1 Light Accent 6;\lsdpriority47 \lsdlocked0 Grid Table 2 Accent 6;\lsdpriority48 \lsdlocked0 Grid Table 3 Accent 6;
\lsdpriority49 \lsdlocked0 Grid Table 4 Accent 6;\lsdpriority50 \lsdlocked0 Grid Table 5 Dark Accent 6;\lsdpriority51 \lsdlocked0 Grid Table 6 Colorful Accent 6;\lsdpriority52 \lsdlocked0 Grid Table 7 Colorful Accent 6;
\lsdpriority46 \lsdlocked0 List Table 1 Light;\lsdpriority47 \lsdlocked0 List Table 2;\lsdpriority48 \lsdlocked0 List Table 3;\lsdpriority49 \lsdlocked0 List Table 4;\lsdpriority50 \lsdlocked0 List Table 5 Dark;
\lsdpriority51 \lsdlocked0 List Table 6 Colorful;\lsdpriority52 \lsdlocked0 List Table 7 Colorful;\lsdpriority46 \lsdlocked0 List Table 1 Light Accent 1;\lsdpriority47 \lsdlocked0 List Table 2 Accent 1;\lsdpriority48 \lsdlocked0 List Table 3 Accent 1;
\lsdpriority49 \lsdlocked0 List Table 4 Accent 1;\lsdpriority50 \lsdlocked0 List Table 5 Dark Accent 1;\lsdpriority51 \lsdlocked0 List Table 6 Colorful Accent 1;\lsdpriority52 \lsdlocked0 List Table 7 Colorful Accent 1;
\lsdpriority46 \lsdlocked0 List Table 1 Light Accent 2;\lsdpriority47 \lsdlocked0 List Table 2 Accent 2;\lsdpriority48 \lsdlocked0 List Table 3 Accent 2;\lsdpriority49 \lsdlocked0 List Table 4 Accent 2;
\lsdpriority50 \lsdlocked0 List Table 5 Dark Accent 2;\lsdpriority51 \lsdlocked0 List Table 6 Colorful Accent 2;\lsdpriority52 \lsdlocked0 List Table 7 Colorful Accent 2;\lsdpriority46 \lsdlocked0 List Table 1 Light Accent 3;
\lsdpriority47 \lsdlocked0 List Table 2 Accent 3;\lsdpriority48 \lsdlocked0 List Table 3 Accent 3;\lsdpriority49 \lsdlocked0 List Table 4 Accent 3;\lsdpriority50 \lsdlocked0 List Table 5 Dark Accent 3;
\lsdpriority51 \lsdlocked0 List Table 6 Colorful Accent 3;\lsdpriority52 \lsdlocked0 List Table 7 Colorful Accent 3;\lsdpriority46 \lsdlocked0 List Table 1 Light Accent 4;\lsdpriority47 \lsdlocked0 List Table 2 Accent 4;
\lsdpriority48 \lsdlocked0 List Table 3 Accent 4;\lsdpriority49 \lsdlocked0 List Table 4 Accent 4;\lsdpriority50 \lsdlocked0 List Table 5 Dark Accent 4;\lsdpriority51 \lsdlocked0 List Table 6 Colorful Accent 4;
\lsdpriority52 \lsdlocked0 List Table 7 Colorful Accent 4;\lsdpriority46 \lsdlocked0 List Table 1 Light Accent 5;\lsdpriority47 \lsdlocked0 List Table 2 Accent 5;\lsdpriority48 \lsdlocked0 List Table 3 Accent 5;
\lsdpriority49 \lsdlocked0 List Table 4 Accent 5;\lsdpriority50 \lsdlocked0 List Table 5 Dark Accent 5;\lsdpriority51 \lsdlocked0 List Table 6 Colorful Accent 5;\lsdpriority52 \lsdlocked0 List Table 7 Colorful Accent 5;
\lsdpriority46 \lsdlocked0 List Table 1 Light Accent 6;\lsdpriority47 \lsdlocked0 List Table 2 Accent 6;\lsdpriority48 \lsdlocked0 List Table 3 Accent 6;\lsdpriority49 \lsdlocked0 List Table 4 Accent 6;
\lsdpriority50 \lsdlocked0 List Table 5 Dark Accent 6;\lsdpriority51 \lsdlocked0 List Table 6 Colorful Accent 6;\lsdpriority52 \lsdlocked0 List Table 7 Colorful Accent 6;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Mention;
\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Smart Hyperlink;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Hashtag;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Unresolved Mention;\lsdsemihidden1 \lsdunhideused1 \lsdlocked0 Smart Link;}}{\*\datastore 01050000
02000000180000004d73786d6c322e534158584d4c5265616465722e362e3000000000000000000000060000
d0cf11e0a1b11ae1000000000000000000000000000000003e000300feff090006000000000000000000000001000000010000000000000000100000feffffff00000000feffffff0000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
fffffffffffffffffdfffffffeffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
ffffffffffffffffffffffffffffffff52006f006f007400200045006e00740072007900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000016000500ffffffffffffffffffffffff0c6ad98892f1d411a65f0040963251e500000000000000000000000030b2
65dc0e03dc01feffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffff00000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffff000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000105000000000000}}